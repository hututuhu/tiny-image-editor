(self.webpackChunktiny_image_editor=self.webpackChunktiny_image_editor||[]).push([[433],{72511:function(Xr,Xe,b){"use strict";b.r(Xe),b.d(Xe,{default:function(){return Br}});var g=b(67294),rt=b(38416),R=b.n(rt),ge,me,pe,Ce,xe,Re,we,Me,ye,_e,je,Te,Se,ke,be,Ee,Ie,V,Pe,De,Ne,Oe,ze,Ae,oe,ce={OBJECT_ACTIVATED:"objectActivated",OBJECT_MOVED:"objectMoved",OBJECT_SCALED:"objectScaled",OBJECT_CREATED:"objectCreated",TEXT_EDITING:"textEditing",TEXT_CHANGED:"textChanged",ICON_CREATE_RESIZE:"iconCreateResize",ICON_CREATE_END:"iconCreateEnd",ADD_TEXT:"addText",ADD_OBJECT:"addObject",ADD_OBJECT_AFTER:"addObjectAfter",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove",REDO_STACK_CHANGED:"redoStackChanged",UNDO_STACK_CHANGED:"undoStackChanged",SELECTION_CLEARED:"selectionCleared",SELECTION_CREATED:"selectionCreated"},c=function(d){return d.crop="crop",d.history="history",d.download="download",d.draw="draw",d.flip="flip",d.reset="reset",d.rotate="rotate",d.rect="rect",d.circle="circle",d.text="text",d.upload="upload",d.drag="drag",d.scale="scale",d.arrow="arrow",d.mosaic="mosaic",d.undo="undo",d.redo="redo",d.default="",d}({}),y=function(d){return d.zh="zh",d.en="en",d}({}),K=(V={},R()(V,c.crop,(ge={},R()(ge,y.zh,"\u88C1\u526A"),R()(ge,y.en,c.crop),ge)),R()(V,c.history,(me={},R()(me,y.zh,"\u5386\u53F2\u8BB0\u5F55"),R()(me,y.en,c.history),me)),R()(V,c.download,(pe={},R()(pe,y.zh,"\u4E0B\u8F7D"),R()(pe,y.en,c.download),pe)),R()(V,c.draw,(Ce={},R()(Ce,y.zh,"\u753B\u7B14"),R()(Ce,y.en,c.draw),Ce)),R()(V,c.flip,(xe={},R()(xe,y.zh,"\u7FFB\u8F6C"),R()(xe,y.en,c.flip),xe)),R()(V,c.reset,(Re={},R()(Re,y.zh,"\u91CD\u7F6E"),R()(Re,y.en,c.reset),Re)),R()(V,c.rotate,(we={},R()(we,y.zh,"\u65CB\u8F6C"),R()(we,y.en,c.rotate),we)),R()(V,c.rect,(Me={},R()(Me,y.zh,"\u77E9\u5F62"),R()(Me,y.en,c.rect),Me)),R()(V,c.circle,(ye={},R()(ye,y.zh,"\u5706\u5F62"),R()(ye,y.en,c.circle),ye)),R()(V,c.text,(_e={},R()(_e,y.zh,"\u6587\u672C"),R()(_e,y.en,c.text),_e)),R()(V,c.upload,(je={},R()(je,y.zh,"\u4E0A\u4F20"),R()(je,y.en,c.upload),je)),R()(V,c.drag,(Te={},R()(Te,y.zh,"\u62D6\u62FD"),R()(Te,y.en,c.drag),Te)),R()(V,c.scale,(Se={},R()(Se,y.zh,"\u7F29\u653E"),R()(Se,y.en,c.scale),Se)),R()(V,c.arrow,(ke={},R()(ke,y.zh,"\u7BAD\u5934"),R()(ke,y.en,c.arrow),ke)),R()(V,c.mosaic,(be={},R()(be,y.zh,"\u9A6C\u8D5B\u514B"),R()(be,y.en,c.mosaic),be)),R()(V,c.redo,(Ee={},R()(Ee,y.zh,"\u524D\u8FDB"),R()(Ee,y.en,c.redo),Ee)),R()(V,c.undo,(Ie={},R()(Ie,y.zh,"\u540E\u9000"),R()(Ie,y.en,c.undo),Ie)),V),le=function(d){return d.default="default",d.crosshair="crosshair",d.pointer="pointer",d.move="move",d.grab="grab",d.grabbing="grabbing",d.zoomIn="zoom-in",d.zoomOut="zoom-out",d}({}),U=function(d){return d.add="add",d.modified="modified",d.delete="delete",d}({}),ue=(oe={},R()(oe,U.add,(Pe={},R()(Pe,y.zh,"\u6DFB\u52A0"),R()(Pe,y.en,U.add),Pe)),R()(oe,U.modified,(De={},R()(De,y.zh,"\u4FEE\u6539"),R()(De,y.en,U.modified),De)),R()(oe,U.delete,(Ne={},R()(Ne,y.zh,"\u5220\u9664"),R()(Ne,y.en,U.delete),Ne)),R()(oe,"placeholder",(Oe={},R()(Oe,y.zh,"\u6682\u65E0\u5386\u53F2"),R()(Oe,y.en,"no logging"),Oe)),R()(oe,"init",(ze={},R()(ze,y.zh,"\u521D\u59CB\u5316"),R()(ze,y.en,"init"),ze)),R()(oe,"title",(Ae={},R()(Ae,y.zh,"\u5386\u53F2"),R()(Ae,y.en,"history"),Ae)),oe),Fe=function(d){return d.flipX="flipX",d.flipY="flipY",d}({}),Le="workspace",se=function(d){return d.size="size",d.color="color",d}({}),X={sizes:[5,10,20],colors:["red","orange","yellow","green","blue","white"],fontSizes:[30,60,90],rotates:[0,45,90,135,180,225,270,315,360],mosaicSizes:[10,20,30]},He={Z:90,Y:89,SHIFT:16,BACKSPACE:8,DEL:46},Je="tie_image_editor",Jr=8,Be=["id","gradientAngle","selectable","hasControls","source","editable"],nt=30,at="",it=[],ot=["onChange","loadData","onClick","onSelect","options","name","value","defaultValue","values","defaultValues","placeholder","large","small","iconRender","icon","activeIndex","swipeAble","fixedArrows","error","onVisibleChange"],I=g.createContext({canvasInstanceRef:{current:null},wrapperInstanceRef:{current:null},currentMenuRef:{current:c.default},currentMenu:c.default,setCurrentMenu:function(){},canvasIsRender:!1,canvasEl:{current:null},initCanvasJson:{current:null},unSaveHistory:{current:null},historyRef:{current:function(){}},initBackGroundImage:function(){},zoom:1,setZoom:function(){}}),st=function(){return!!(window.File&&window.FileList&&window.FileReader)},ct=function(e){var t=/data:(image\/.+);base64,/,r="",n,i,a;n=e.replace(t,function(v,f){return r=f,""}),n=atob(n);var u=n.length;for(i=new Uint8Array(u),a=0;a<u;a+=1)i[a]=n.charCodeAt(a);return new Blob([i],{type:r})},te=function(e,t,r){if(t>r){var n=[r,t];t=n[0],r=n[1]}return Math.max(t,Math.min(e,r))},lt=function(e,t){var r=Object.assign({},e);return t.forEach(function(n){delete r[n]}),r};function ut(d){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e=e.concat(ot),lt(d,e)}var Vr=function(){if(navigator){var e=navigator.userAgent,t=e.indexOf("Trident")>-1&&e.indexOf("rv:11.0")>-1;if(t)return 11;var r=navigator.appVersion.split(";")[1];if(!r)return;var n=r.replace(/[ ]/g,""),i=/MSIE(\d+)\./.exec(n);if(i)return parseInt(i[1])}},dt=b(94184),z=b.n(dt),ft=b(42122),W=b.n(ft),vt=b(861),ht=b.n(vt),gt=b(70215),mt=b.n(gt),pt=b(27424),ae=b.n(pt),Ct=b(70614),xt=b(81385),Rt=b(63351),wt=b(56690),Mt=b.n(wt),yt=b(89728),_t=b.n(yt),jt=b(66115),Ve=b.n(jt),Tt=b(61655),St=b.n(Tt),kt=b(26389),bt=b.n(kt),Et=b(73935),It=function(d){St()(t,d);var e=bt()(t);function t(r){var n;return Mt()(this,t),n=e.call(this,r),R()(Ve()(n),"container",null),n.container=null,n.getContainer=n.getContainer.bind(Ve()(n)),n}return _t()(t,[{key:"componentDidMount",value:function(){var n=this;this.container=this.props.container||document.body,this.forceUpdate(function(){n.props.onRendered&&n.props.onRendered()})}},{key:"componentDidUpdate",value:function(n){n.container!==this.props.container&&(this.container=this.props.container||null)}},{key:"getContainer",value:function(){return this.container}},{key:"render",value:function(){var n=this.props.children;return this.container&&n?Et.createPortal(n,this.container):null}}]),t}(g.Component),o=b(85893),Pt=["className","style","children","trigger","visible","popoverClassName","popoverStyle","showArrow","content","placement","usePortal","portalContainer","positionFixed","modifiers","outlineColor","backgroundColor","scheduleUpdate","onOpenChange","maskClosable"],Dt=function(e){return(0,o.jsx)("div",{className:"popper__arrow",style:R()({},"border"+(((e==null?void 0:e.arrowPlacement[0])||"").toLocaleUpperCase()+(e.arrowPlacement||"").substring(1))+"Color",e.backgroundColor),children:e.children})},Ke=function(e){var t=(0,g.useRef)(null),r=(0,g.useRef)(null),n=(0,g.useState)(e.open),i=ae()(n,2),a=i[0],u=i[1],v=e.className,f=e.style,l=e.children,h=e.trigger,m=e.visible,p=e.popoverClassName,w=e.popoverStyle,x=e.showArrow,s=e.content,C=e.placement,M=e.usePortal,S=e.portalContainer,A=e.positionFixed,T=e.modifiers,N=e.outlineColor,F=e.backgroundColor,J=e.scheduleUpdate,G=e.onOpenChange,_=e.maskClosable,j=_===void 0?!0:_,k=mt()(e,Pt),O=ut(k,["popoverClassName","popoverStyle","showArrow","content","usePortal","positionFixed","outlineColor","backgroundColor","getPopoverRef","onOpenChange"]),E=function(L){G&&G(L),e.open!==void 0?u(e.open):u(L)},D=function(L){var ee,ie;!t||!r||(ee=t.current)!==null&&ee!==void 0&&ee.contains(L.target)||(ie=r.current)!==null&&ie!==void 0&&ie.contains(L.target)||j&&E(!1)},B=function(){var L=e.open,ee=e.onOpenChange;L!==void 0&&ee===void 0||h==="hover"&&E(!0)},Z=function(){var L=e.open,ee=e.onOpenChange;L!==void 0&&ee===void 0||h==="hover"&&E(!1)},$=function(L){if(L.nativeEvent.stopImmediatePropagation(),h==="click"){E(!a);return}h==="focus"&&E(!0)};(0,g.useEffect)(function(){e.getPopoverRef&&e.getPopoverRef(t)},[]),(0,g.useEffect)(function(){return(h==="click"||h==="focus")&&document.body.addEventListener("click",D,!1),function(){document.body.removeEventListener("click",D,!1)}},[j,e.open]),(0,g.useEffect)(function(){e.open!==void 0&&E(e.open)},[e.open]);var re=function(){var L=A?"fixed":"absolute",ee=[{name:"computeStyles",options:{gpuAcceleration:!1}},{name:"offset",options:{offset:[0,10]}}],ie=function(ne){if(ne)return ne.split("-")[0].toString().replace(/^\S/,function(Ye){return Ye.toUpperCase()})},Q=function(ne){if(ne==="content"&&N)return{borderColor:N};if(ne==="arrow"&&N)return R()({},"border".concat(ie(C),"Color"),N)},ve=function(){if(F)return{color:"#fff",background:F}},he=C.split("-")[0],et=a&&(0,o.jsx)(Ct.r,{placement:C,modifiers:[].concat(ee,ht()(T||[])),strategy:L,children:function(ne){var Ye=ne.ref,Ur=ne.style,$r=ne.placement,tt=ne.arrowProps,Yr=ne.update;return(0,g.useEffect)(function(){a&&Yr()},[J]),(0,o.jsx)("div",{className:z()("tie-popover__popper",p,{"tie-popover__popper-background":F}),style:W()(W()(W()(W()({},Ur),w),Q("content")),ve()),ref:Ye,"x-placement":$r,onMouseEnter:B,onMouseLeave:Z,children:(0,o.jsxs)("div",{ref:t,children:[a&&(0,o.jsx)("div",{className:"tie-popover__content",children:(0,o.jsx)("span",{children:s})}),x&&(0,o.jsx)(Dt,{arrowPlacement:he,backgroundColor:F,children:(0,o.jsx)("div",{"data-popper-arrow":!0,className:"tie-popper__arrow popper__arrow","x-arrow":"true",style:W()(W()({},tt.style),Q("arrow")),ref:tt.ref})})]})})}});return M?(0,o.jsx)(It,{container:S,children:et}):et},q=function(L){if(L.type.__BRICKS_BUTTON&&L.props.disabled){var ee=L.props.style&&L.props.style.display?L.props.style.display:"inline-block",ie=g.cloneElement(L,{style:W()(W()({},L.props.style),{},{pointerEvents:"none"})});return(0,o.jsx)("span",{style:{display:ee,cursor:"not-allowed"},children:ie})}return L};return(0,o.jsx)(o.Fragment,{children:m?(0,o.jsx)("div",W()(W()({className:z()("tie-popover",v)},O),{},{style:f,children:(0,o.jsxs)(xt.dK,{children:[(0,o.jsx)(Rt.s,{children:function(L){var ee=L.ref;return(0,o.jsx)("div",{ref:r,className:"tie-popover__target",children:(0,o.jsx)("div",{ref:ee,children:g.Children.map(l,function(ie){var Q=ie;return Q=q(Q),h==="click"?g.cloneElement(Q,{onClick:function(he){$(he),Q.props.onClick&&Q.props.onClick()}}):h==="focus"?g.cloneElement(Q,{onFocus:function(he){$(he),Q.props.onFocus&&Q.props.onFocus()}}):h==="hover"?g.cloneElement(Q,{onMouseEnter:function(){B(),Q.props.onMouseEnter&&Q.props.onMouseEnter()},onMouseLeave:function(){Z(),Q.props.onMouseLeave&&Q.props.onMouseLeave()}}):Q})})})}}),re()]})})):l})};Ke.defaultProps={visible:!0,trigger:"hover",placement:"bottom",showArrow:!0,usePortal:!0,modifiers:[]};var H=Ke,Nt=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,i=e.type,a=e.onChange,u=function(f,l){a&&a(f,l)};return(0,o.jsx)(H,{content:(0,o.jsxs)("div",{className:"tie-image-editor_tool-paint-content",children:[(0,o.jsx)("div",{className:"tie-image-editor_tool-paint-size-wrapper",children:(i===c.text?X.fontSizes:X.sizes).map(function(v,f){return(0,o.jsx)("div",{onClick:function(){return u(se.size,v)},className:"tie-image-editor_tool-paint-size",style:{width:10+f*5,height:10+f*5}},v)})}),(0,o.jsx)("div",{className:"tie-image-editor_tool-paint-color-wrapper",children:X.colors.map(function(v){return(0,o.jsx)("div",{onClick:function(){return u(se.color,v)},className:"tie-image-editor_tool-paint-color",style:{background:v}},v)})})]}),placement:"bottom",open:n,children:(0,o.jsx)("div",{children:t})})},de=Nt,P=b(32777),Ge=P.fabric.util.createClass(P.fabric.Line,{type:"arrow",superType:"drawing",initialize:function(e,t){if(!e){var r=t,n=r.x1,i=r.x2,a=r.y1,u=r.y2;e=[n,a,i,u]}t=t||{},this.callSuper("initialize",e,t)},_render:function(e){this.callSuper("_render",e),e.save();var t=this.x2-this.x1,r=this.y2-this.y1,n=Math.atan2(r,t);e.translate((this.x2-this.x1)/2,(this.y2-this.y1)/2),e.rotate(n),e.beginPath(),e.moveTo(this.strokeWidth*2,0),e.lineTo(-this.strokeWidth*2,this.strokeWidth*2),e.lineTo(-this.strokeWidth*2,-this.strokeWidth*2),e.closePath(),e.fillStyle=this.stroke,e.fill(),e.restore()}});Ge.fromObject=function(d,e){var t=d.x1,r=d.x2,n=d.y1,i=d.y2;return e(new P.fabric.Arrow([t,n,r,i],d))};var Ot=Ge,zt=function(){var e=(0,g.useContext)(I),t=e.currentMenu,r=e.setCurrentMenu,n=e.canvasInstanceRef,i=e.canvasIsRender,a=e.currentMenuRef,u=e.historyRef,v=(0,g.useRef)(!1),f=(0,g.useRef)({x:0,y:0}),l=(0,g.useRef)([]),h=(0,g.useRef)(null),m=(0,g.useRef)({color:X.colors[0],size:X.sizes[0]}),p=function(){var C=n.current;C&&(C.on("mouse:down",function(M){if(!(C.getActiveObject()||a.current!==c.arrow)){C.discardActiveObject(),C.getObjects().forEach(function(A){A.selectable=!1,A.hasControls=!1}),C.requestRenderAll(),v.current=!0,f.current=C.getPointer(M.e),l.current=[f.current.x,f.current.y,f.current.x,f.current.y];var S=new Ot(l.current,{strokeWidth:m.current.size,stroke:m.current.color,id:new Date().valueOf()+"_"+Math.random()*4});S.strokeUniform=!0,h.current=S,C.add(S)}}),C.on("mouse:move",function(M){if(!C.getActiveObject()&&a.current===c.rect&&C.setCursor(le.crosshair),C.getActiveObject()||a.current!==c.arrow||!v.current||!h.current){C.renderAll();return}if(f.current=C.getPointer(M.e),M.e.shiftKey){var S=l.current[0],A=l.current[1],T=f.current.x-S,N=f.current.y-A,F=Math.sqrt(T*T+N*N),J=Math.atan2(N,T)/Math.PI*180;J=parseInt(""+(J+7.5)%360/15)*15;var G=F*Math.cos(J*Math.PI/180),_=F*Math.sin(J*Math.PI/180);h.current.set({x2:G+S,y2:_+A})}else{if(!h.current)return;h.current.set({x2:f.current.x,y2:f.current.y})}C.renderAll()}),C.on("mouse:up",function(){a.current!==c.arrow||!h.current||!v.current||(h.current.setCoords(),v.current=!1,f.current.x===l.current[0]&&f.current.y===l.current[1]?(C.remove(h.current),C.requestRenderAll(),u.current.updateCanvasState(U.add,!0,!1)):(C.setActiveObject(h.current),u.current.updateCanvasState(U.add,!0,!0)))}))};(0,g.useEffect)(function(){n.current&&i&&p()},[n,i]);var w=function(){r(t===c.arrow?c.default:c.arrow)},x=function(C,M){if(n.current){var S=n.current,A=S.getActiveObjects()[0];C===se.color?(m.current.color=M,A&&A.set("stroke",M)):(m.current.size=M,A&&A.set("strokeWidth",M)),S.renderAll()}};return{handleArrowTrigger:w,handlePaintChange:x,currentMenu:t}},At=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=zt(),i=n.handleArrowTrigger,a=n.handlePaintChange,u=n.currentMenu;return(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-arrow",R()({},"tie-image-editor_tool-item--checked",u===c.arrow)),children:(0,o.jsx)(de,{open:u===c.arrow,onChange:a,children:(0,o.jsx)(H,{content:K.arrow[r],placement:"top",children:(0,o.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:i})})})})},Ft=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,i=e.canvasIsRender,a=e.currentMenu,u=e.historyRef,v=(0,g.useRef)(!1),f=(0,g.useRef)({x:9,y:0}),l=(0,g.useRef)(null),h=(0,g.useRef)({color:X.colors[0],size:X.sizes[0]}),m=function(){var s=t.current;s&&(s.on("mouse:down",function(C){if(!(s.getActiveObject()||r.current!==c.circle)){v.current=!0;var M=s.getPointer(C.e);f.current.x=M.x,f.current.y=M.y,l.current=new P.fabric.Circle({left:f.current.x,top:f.current.y,originX:"left",originY:"top",radius:M.x-f.current.x,angle:0,fill:"",stroke:h.current.color,strokeWidth:h.current.size}),s.add(l.current)}}),s.on("mouse:move",function(C){if(!s.getActiveObject()&&r.current===c.circle&&s.setCursor(le.crosshair),!v.current||r.current!==c.circle){s.renderAll();return}var M=s.getPointer(C.e),S=Math.max(Math.abs(f.current.y-M.y),Math.abs(f.current.x-M.x))/2;S>l.current.strokeWidth&&(S-=l.current.strokeWidth/2),l.current.set({radius:S}),f.current.x>M.x?l.current.set({originX:"right"}):l.current.set({originX:"left"}),f.current.y>M.y?l.current.set({originY:"bottom"}):l.current.set({originY:"top"}),s.renderAll()}),s.on("mouse:up",function(C){if(!(!l.current||r.current!==c.circle)){var M=s.getPointer(C.e);M.x===l.current.left&&M.y===l.current.top?(s.remove(l.current),s.requestRenderAll(),u.current.updateCanvasState(U.add,!0,!1)):(s.setActiveObject(l.current),u.current.updateCanvasState(U.add,!0,!0)),v.current=!1,l.current=null}}))};(0,g.useEffect)(function(){var x=t.current;x&&i&&m()},[t,i]);var p=function(){n(r.current===c.circle?c.default:c.circle)},w=function(s,C){if(t.current){var M=t.current,S=M.getActiveObjects()[0];s===se.color?(h.current.color=C,S&&S.set("stroke",C)):(h.current.size=C,S&&S.set("strokeWidth",C)),M.renderAll()}};return{handleDrawCircle:p,handlePaintChange:w,currentMenu:a}},Lt=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=Ft(),i=n.handleDrawCircle,a=n.handlePaintChange,u=n.currentMenu;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-circle",R()({},"tie-image-editor_tool-item--checked",u===c.circle)),children:(0,o.jsx)(de,{open:u===c.circle,onChange:a,children:(0,o.jsx)(H,{content:K.circle[r],placement:"top",children:(0,o.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:i})})})})})},Ht="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E",Wt=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.historyRef,i=function(){var u=document.createElement("img");u.src=Ht,P.fabric.Object.prototype.transparentCorners=!1,P.fabric.Object.prototype.cornerColor="blue",P.fabric.Object.prototype.cornerStyle="circle";function v(l,h){var m=h.target,p=m.canvas;return p.remove(m),p.requestRenderAll(),n.current.updateCanvasState(U.delete),!0}function f(l,h,m,p,w){var x=24;l.save(),l.translate(h,m),l.rotate(P.fabric.util.degreesToRadians(w.angle)),l.drawImage(u,-x/2,-x/2,x,x),l.restore()}P.fabric.Object.prototype.controls.deleteControl=new P.fabric.Control({x:.5,y:-.5,offsetY:16,cursorStyle:"pointer",mouseUpHandler:v,render:f})};(0,g.useEffect)(function(){t.current&&r&&i()},[t,r])},Bt=function(){return Wt(),(0,o.jsx)(o.Fragment,{})},Ut="tl",$t="tr",Yt="mt",Xt="ml",Jt="mr",Vt="mb",Kt="bl",Gt="br",Zt=[Ut,$t,Yt,Xt,Jt,Vt,Kt,Gt],Ue=function(){};function Qt(d){return Zt.indexOf(d)>=0}function We(d,e){return d>e?"width":"height"}var qt=P.fabric.util.createClass(P.fabric.Rect,{initialize:function(e,t,r){t=W()(W()({},t),r),t.type="cropzone",this.callSuper("initialize",t),this._addEventHandler(),this.canvas=e,this.options=t},canvasEventDelegation:function(e){var t="unregistered",r=this.canvasEventTrigger[e]!==Ue;return r?t="registered":[ce.OBJECT_MOVED,ce.OBJECT_SCALED].indexOf(e)<0&&(t="none"),t},canvasEventRegister:function(e,t){this.canvasEventTrigger[e]=t},_addEventHandler:function(){var e;this.canvasEventTrigger=(e={},R()(e,ce.OBJECT_MOVED,Ue),R()(e,ce.OBJECT_SCALED,Ue),e),this.on({moving:this._onMoving.bind(this),scaling:this._onScaling.bind(this)}),P.fabric.util.addListener(document,"keydown",this._onKeyDown.bind(this)),P.fabric.util.addListener(document,"keyup",this._onKeyUp.bind(this))},_renderCropzone:function(e){var t=7,r=7,n=this.flipX?-1:1,i=this.flipY?-1:1,a=n/this.scaleX,u=i/this.scaleY;e.scale(a,u),this._fillOuterRect(e,"rgba(0, 0, 0, 0.5)"),this.options.lineWidth?(this._fillInnerRect(e),this._strokeBorder(e,"rgb(255, 255, 255)",{lineWidth:this.options.lineWidth})):(this._strokeBorder(e,"rgb(0, 0, 0)",{lineDashWidth:t}),this._strokeBorder(e,"rgb(255, 255, 255)",{lineDashWidth:t,lineDashOffset:r})),e.scale(1/a,1/u)},_render:function(e){this.callSuper("_render",e),this._renderCropzone(e)},_fillOuterRect:function(e,t){var r=this._getCoordinates(),n=r.x,i=r.y;console.log("_fillOuterRect",n,i),e.save(),e.fillStyle=t,e.beginPath(),e.moveTo(n[1],i[1]),e.lineTo(n[1],i[2]),e.lineTo(n[2],i[2]),e.lineTo(n[2],i[1]),e.lineTo(n[1],i[1]),e.closePath(),e.fill(),e.restore()},_fillInnerRect:function(e){var t=this._getCoordinates(),r=t.x,n=t.y,i=this._caculateInnerPosition(r,(r[2]-r[1])/3),a=this._caculateInnerPosition(n,(n[2]-n[1])/3);e.save(),e.strokeStyle="rgba(255, 255, 255, 0.7)",e.lineWidth=this.options.lineWidth,e.beginPath(),e.moveTo(i[0],a[1]),e.lineTo(i[3],a[1]),e.moveTo(i[0],a[2]),e.lineTo(i[3],a[2]),e.moveTo(i[1],a[0]),e.lineTo(i[1],a[3]),e.moveTo(i[2],a[0]),e.lineTo(i[2],a[3]),e.stroke(),e.closePath(),e.restore()},_caculateInnerPosition:function(e,t){var r=[];return r[0]=e[1],r[1]=e[1]+t,r[2]=e[1]+t*2,r[3]=e[2],r},_getCoordinates:function(){var e=this.canvas,t=this.width,r=this.height,n=this.left,i=this.top,a=t/2,u=r/2,v=e.getHeight(),f=e.getWidth();return{x:[-(a+n),-a,a,a+(f-n-t)].map(Math.ceil),y:[-(u+i),-u,u,u+(v-i-r)].map(Math.ceil)}},_strokeBorder:function(e,t,r){var n=r.lineDashWidth,i=r.lineDashOffset,a=r.lineWidth,u=this.width/2,v=this.height/2;e.save(),e.strokeStyle=t,e.setLineDash&&e.setLineDash([n,n]),i&&(e.lineDashOffset=i),a&&(e.lineWidth=a),e.beginPath(),e.moveTo(-u,-v),e.lineTo(u,-v),e.lineTo(u,v),e.lineTo(-u,v),e.lineTo(-u,-v),e.stroke(),e.restore()},_onMoving:function(){var e=this.height,t=this.width,r=this.left,n=this.top,i=this.canvas.getWidth()-t,a=this.canvas.getHeight()-e;this.left=te(r,0,i),this.top=te(n,0,a),this.canvasEventTrigger[ce.OBJECT_MOVED](this)},_onScaling:function(e){var t=e.transform.corner,r=this.canvas.getPointer(e.e),n=this._calcScalingSizeFromPointer(r,t);this.scale(1).set(n),this.canvasEventTrigger[ce.OBJECT_SCALED](this)},_calcScalingSizeFromPointer:function(e,t){var r=Qt(t);return r&&this._resizeCropZone(e,t)},adjustRatioCropzoneSize:function(e){var t=e.width,r=e.height,n=e.leftMaker,i=e.topMaker,a=e.maxWidth,u=e.maxHeight,v=e.scaleTo;if(t=a?te(t,1,a):t,r=u?te(r,1,u):r,!this.presetRatio)return this._withShiftKey&&(t>r?r=t:r>t&&(t=r)),{width:t,height:r,left:n(t),top:i(r)};v==="width"?r=t/this.presetRatio:t=r*this.presetRatio;var f=Math.min(a/t,u/r);if(f<=1){var l=[t,r].map(function(m){return m*f}),h=ae()(l,2);t=h[0],r=h[1]}return{width:t,height:r,left:n(t),top:i(r)}},_getCropzoneRectInfo:function(){var e=this.canvas,t=e.width,r=e.height,n=this.getBoundingRect(!1,!0),i=n.top,a=n.left,u=n.width,v=n.height;return{rectTop:i,rectLeft:a,rectWidth:u,rectHeight:v,rectRight:a+u,rectBottom:i+v,canvasWidth:t,canvasHeight:r}},_resizeCropZone:function(e,t){var r=e.x,n=e.y,i=this._getCropzoneRectInfo(),a=i.rectWidth,u=i.rectHeight,v=i.rectTop,f=i.rectLeft,l=i.rectBottom,h=i.rectRight,m=i.canvasWidth,p=i.canvasHeight,w={tl:{width:h-r,height:l-n,leftMaker:function(s){return h-s},topMaker:function(s){return l-s},maxWidth:h,maxHeight:l,scaleTo:We(f-r,v-n)},tr:{width:r-f,height:l-n,leftMaker:function(){return f},topMaker:function(s){return l-s},maxWidth:m-f,maxHeight:l,scaleTo:We(r-h,v-n)},mt:{width:a,height:l-n,leftMaker:function(){return f},topMaker:function(s){return l-s},maxWidth:m-f,maxHeight:l,scaleTo:"height"},ml:{width:h-r,height:u,leftMaker:function(s){return h-s},topMaker:function(){return v},maxWidth:h,maxHeight:p-v,scaleTo:"width"},mr:{width:r-f,height:u,leftMaker:function(){return f},topMaker:function(){return v},maxWidth:m-f,maxHeight:p-v,scaleTo:"width"},mb:{width:a,height:n-v,leftMaker:function(){return f},topMaker:function(){return v},maxWidth:m-f,maxHeight:p-v,scaleTo:"height"},bl:{width:h-r,height:n-v,leftMaker:function(s){return h-s},topMaker:function(){return v},maxWidth:h,maxHeight:p-v,scaleTo:We(f-r,n-l)},br:{width:r-f,height:n-v,leftMaker:function(){return f},topMaker:function(){return v},maxWidth:m-f,maxHeight:p-v,scaleTo:We(r-h,n-l)}};return this.adjustRatioCropzoneSize(w[t])},isValid:function(){return this.left>=0&&this.top>=0&&this.width>0&&this.height>0},_onKeyDown:function(e){var t=e.keyCode;t===He.SHIFT&&(this._withShiftKey=!0)},_onKeyUp:function(e){var t=e.keyCode;t===He.SHIFT&&(this._withShiftKey=!1)}}),er=qt,tr=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,i=e.onChange,a=function(v){i&&i(v)};return(0,o.jsx)(H,{content:(0,o.jsxs)("div",{className:"tie-image-editor_tool-crop-pop",children:[(0,o.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-done",children:(0,o.jsx)("i",{className:"tie-image-editor_icon",onClick:function(){return a(!0)}})}),(0,o.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-clear",children:(0,o.jsx)("i",{className:"tie-image-editor_icon",onClick:function(){return a(!1)}})})]}),placement:"bottom",open:n,children:(0,o.jsx)("div",{children:t})})},rr=tr,nr=10,ar=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,i=e.canvasIsRender,a=e.currentMenu,u=e.wrapperInstanceRef,v=e.historyRef,f=e.unSaveHistory,l=(0,g.useRef)(null),h=(0,g.useRef)(0),m=(0,g.useRef)(0),p=(0,g.useRef)(!1),w=(0,g.useCallback)(function(_,j){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,O=t.current;if(O){var E=O.getWidth(),D=O.getHeight(),B=h.current,Z=m.current,$=te(_,0,B),re=te(j,0,Z),q=te(_,B,E)-$,Y=te(j,Z,D)-re;return p.current&&!k?(q>Y?Y=q:Y>q&&(q=Y),B>=_&&($=B-q),Z>=j&&(re=Z-Y)):k&&(Y=q/k,B>=_&&($=te(B-q,0,E)),Z>=j&&(re=te(Z-Y,0,D)),re+Y>D&&(Y=D-re,q=Y*k,B>=_&&($=te(B-q,0,E)),Z>=j&&(re=te(Z-Y,0,D)))),{left:$,top:re,width:q,height:Y}}},[]),x=(0,g.useCallback)(function(_){r.current===c.crop&&_.keyCode===He.SHIFT&&(p.current=!0)},[]),s=(0,g.useCallback)(function(_){r.current===c.crop&&_.keyCode===He.SHIFT&&(p.current=!1)},[]),C=(0,g.useCallback)(function(_){var j=t.current;if(j&&r.current===c.crop){var k=j.getPointer(_.e),O=k.x,E=k.y,D=l.current;D&&Math.abs(O-h.current)+Math.abs(E-m.current)>nr&&(j.remove(D),D.set(w(O,E,D.presetRatio)),j.add(D),j.setActiveObject(D))}},[i]),M=(0,g.useCallback)(function(){var _=t.current;if(_&&r.current===c.crop){var j=l.current;_.setActiveObject(j),_.off("mouse:move",C),_.off("mouse:up",M)}},[i]),S=(0,g.useCallback)(function(_){if(!_.target){var j=t.current;if(j&&r.current===c.crop){j.selection=!1;var k=j.getPointer(_.e);h.current=k.x,m.current=k.y,j.on("mouse:move",C),j.on("mouse:up",M)}}},[i]),A=(0,g.useCallback)(function(){var _=t.current;!_||!i||l.current||(f.current=!0,_.getObjects().forEach(function(j){j.evented=!1}),l.current=new er(t.current,{left:0,top:0,width:.5,height:.5,strokeWidth:0,cornerSize:16,cornerColor:"blue",fill:"transparent",hasRotatingPoint:!1,hasBorders:!1,lockScalingFlip:!0,lockRotation:!0,lockSkewingX:!0,lockSkewingY:!0,cornerStyle:"circle",cornerStrokeColor:"blue",transparentCorners:!1,lineWidth:2,borderColor:"blue"}),_.discardActiveObject(),_.add(l.current),_.on("mouse:down",S),_.selection=!1,_.defaultCursor="crosshair",P.fabric.util.addListener(document,"keydown",x),P.fabric.util.addListener(document,"keyup",s))},[i]),T=(0,g.useCallback)(function(){var _=t.current;if(_){var j=l.current;j&&(_.remove(j),_.selection=!0,_.defaultCursor="default",_.off("mouse:down",S),_.off("mouse:move",C),_.off("mouse:up",M),_.forEachObject(function(k){k.evented=!0}),l.current=null,P.fabric.util.removeListener(document,"keydown",x),P.fabric.util.removeListener(document,"keyup",s),f.current=!1)}},[i]),N=function(){r.current!==c.crop?A():T(),n(r.current!==c.crop?c.crop:c.default)},F=function(){var j=l.current;return!j||!j.isValid()?null:{left:j.left,top:j.top,width:j.width,height:j.height}},J=function(){var j=t.current;if(j){var k=j.contains(l.current),O=F();if(!O)return null;k&&j.remove(l.current);var E={imageName:Je,url:j.toDataURL(O)};return k&&j.add(l.current),E}},G=function(j){var k=t.current;if(k)if(!j)T(),A();else{var O=J();if(!O||!O.url.includes("base64"))return;k.clear(),k.setBackgroundImage(O.url,function(){var E=k.backgroundImage,D=u.current.getBoundingClientRect(),B=D.height,Z=k.getCenter(),$=E.height;E.scale(B/$),E.set({left:Z.left-E.width*(B/$)/2,top:Z.top-E.height*(B/$)/2}),E.selectable=!1,E.id=Le,k.renderAll(),T(),v.current.updateCanvasState(U.add),A()})}};return(0,g.useEffect)(function(){a!==c.crop&&l.current&&T()},[a]),{handleCropTrigger:N,handleCropChange:G,currentMenu:a}},ir=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=ar(),i=n.handleCropTrigger,a=n.handleCropChange,u=n.currentMenu;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-crop",R()({},"tie-image-editor_tool-item--checked",u===c.crop)),children:(0,o.jsx)(rr,{open:u===c.crop,onChange:a,children:(0,o.jsx)(H,{content:K.crop[r],placement:"top",children:(0,o.jsx)("i",{className:"tie-image-editor_icon",onClick:i})})})})})},or=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasEl,n=e.onDownLoad,i=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;console.log("heheh");var v=t.current;if(!v||!r.current)return Promise.reject();var f=v.toDataURL(),l=Date.now()+Je,h,m;if(n)return n({downLoadUrl:f}),Promise.resolve({downLoadUrl:f});if(!u)return Promise.resolve({downLoadUrl:f});if(st()&&window.saveAs)h=ct(f),m=h.type.split("/")[1],l.split(".").pop()!==m&&(l+=".".concat(m)),window.saveAs(h,l);else{l.split(".").pop()!==m&&(l+=".png");var p=document.createElement("a");p.href=f,p.download=l,document.body.appendChild(p),p.click(),p.remove()}return Promise.resolve({downLoadUrl:f})};return{handleDownload:i}},Ze=(0,g.forwardRef)(function(d,e){var t=(0,g.useContext)(I),r=t.lang,n=r===void 0?y.en:r,i=or(),a=i.handleDownload;return(0,g.useImperativeHandle)(e,function(){return{download:a}},[a]),(0,o.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-download",children:(0,o.jsx)(H,{content:K.download[n],placement:"top",children:(0,o.jsx)("i",{className:"tie-image-editor_icon",onClick:function(){return a(!0)}})})})});Ze.displayName="Download";var sr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.wrapperInstanceRef,n=e.canvasIsRender,i=e.currentMenu,a=e.setCurrentMenu,u=(0,g.useRef)(!1);(0,g.useEffect)(function(){u.current=i===c.drag},[a,i]);var v=function(){var s=t.current;s&&(s.selection=!1,s.defaultCursor="grab",s.getObjects().forEach(function(C){C.selectable=!1}),s.requestRenderAll())},f=function(){var s=t.current;s&&(console.log("startDring"),a(c.drag),s.defaultCursor="grab",s.renderAll())},l=function(){var s=t.current;s&&(a(c.default),s.defaultCursor="default",s.isDragging=!1,s.selection=!1,s.renderAll())},h=function(){var s=t.current;s&&(s.on("mouse:down",function(C){var M=C.e;(M.altKey||u.current)&&(s.defaultCursor="grabbing",s.discardActiveObject(),v(),s.selection=!1,s.isDragging=!0,s.lastPosX=M.clientX,s.lastPosY=M.clientY,s.requestRenderAll())}),s.on("mouse:move",function(C){if(s.isDragging){s.discardActiveObject(),s.defaultCursor="grabbing";var M=C.e;if(!s.viewportTransform)return;var S=s.viewportTransform;S[4]+=M.clientX-s.lastPosX,S[5]+=M.clientY-s.lastPosY,s.lastPosX=M.clientX,s.lastPosY=M.clientY,s.requestRenderAll()}}),s.on("mouse:up",function(){!s.viewportTransform||!u.current||(s.setViewportTransform(this.viewportTransform),s.isDragging=!1,s.selection=!0,s.getObjects().forEach(function(C){C.id!==Le&&C.hasControls&&(C.selectable=!0)}),s.defaultCursor="default",s.requestRenderAll())}))},m=function(s){var C=t.current;s.keyCode===32&&C&&!u.current&&f(),s.preventDefault()},p=function(s){var C=t.current;s.keyCode===32&&C&&l()};(0,g.useEffect)(function(){return t.current&&n&&(h(),r.current.tabIndex=1e3,r.current.addEventListener("keydown",m,!1),r.current.addEventListener("keyup",p,!1)),function(){var x=t.current;if(x&&r.current){var s,C;(s=r.current)===null||s===void 0||s.removeEventListener("keydown",m,!1),(C=r.current)===null||C===void 0||C.removeEventListener("keyup",p,!1)}}},[t,n]);var w=function(){a(i!==c.drag?c.drag:c.default)};return{handleMoving:w,currentMenu:i}},cr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=sr(),i=n.handleMoving,a=n.currentMenu;return(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-hand",R()({},"tie-image-editor_tool-item--checked",a===c.drag)),children:(0,o.jsx)(H,{content:K.drag[r],placement:"top",children:(0,o.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:i})})})},lr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,i=e.currentMenu,a=(0,g.useRef)({color:X.colors[0],size:X.sizes[0]}),u=function(){var h=t.current;if(h){h.freeDrawingBrush=new P.fabric.PencilBrush(h);var m=h.freeDrawingBrush;m.color=a.current.color,m.getPatternSrc&&(m.source=m.getPatternSrc.call(m)),m.width=a.current.size,m.shadow=new P.fabric.Shadow({blur:a.current.size,offsetX:0,offsetY:0,affectStroke:!0,color:"#333"})}},v=function(){var h=t.current;h&&(r.current!==c.draw?(h.isDrawingMode=!0,u()):h.isDrawingMode=!1,n(r.current!==c.draw?c.draw:c.default))},f=function(h,m){if(t.current){var p=t.current,w=p.getActiveObjects()[0];h===se.color?(a.current.color=m,w&&w.set("fill",m)):(a.current.size=m,w&&w.set("width",m)),p.renderAll(),u()}};return{handleDrawTrigger:v,handlePaintChange:f,currentMenu:i}},ur=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=lr(),i=n.handleDrawTrigger,a=n.handlePaintChange,u=n.currentMenu;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-draw",R()({},"tie-image-editor_tool-item--checked",u===c.draw)),children:(0,o.jsx)(de,{open:u===c.draw,onChange:a,children:(0,o.jsx)(H,{content:K.draw[r],placement:"top",children:(0,o.jsx)("i",{className:"tie-image-editor_icon",onClick:i})})})})})},dr=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,i=e.onChange,a=(0,g.useState)(!1),u=ae()(a,2),v=u[0],f=u[1],l=(0,g.useState)(!1),h=ae()(l,2),m=h[0],p=h[1],w=function(s,C){s===Fe.flipX?f(C):p(C),i&&i(s,C)};return(0,o.jsx)(H,{content:(0,o.jsxs)("div",{className:"tie-image-editor_tool-flip-pop",children:[(0,o.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-flipX",onClick:function(){return w(Fe.flipX,!v)},children:(0,o.jsx)("i",{className:"tie-image-editor_icon"})}),(0,o.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-flipY",onClick:function(){return w(Fe.flipY,!m)},children:(0,o.jsx)("i",{className:"tie-image-editor_icon"})})]}),placement:"bottom",open:n,children:(0,o.jsx)("div",{children:t})})},fr=dr,vr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,i=e.canvasIsRender,a=e.currentMenu,u=e.historyRef;(0,g.useEffect)(function(){var l=t.current},[i]);var v=function(){n(r.current!==c.flip?c.flip:c.default)},f=function(h,m){var p=t.current;if(p){p.getObjects().forEach(function(s){s.originalPoint=s.originalPoint||{left:s.left,top:s.top};var C=R()({},h,m);h===Fe.flipX?m?C=W()(W()({},C),{},{left:p.width-s.originalPoint.left-s.width}):C=W()(W()({},C),{},{left:s.originalPoint.left}):m?C=W()(W()({},C),{},{top:p.height-s.originalPoint.top-s.height}):C=W()(W()({},C),{},{top:s.originalPoint.top}),s.set(C).rotate(parseFloat((s.angle*-1).toString())).setCoords()});var w=p.backgroundImage,x=w.angle;m&&(x*=-1),w.set(R()({},h,m)),w.rotate(parseFloat(x)).setCoords(),w.setCoords(),p.renderAll(),u.current.updateCanvasState(U.add)}};return{handleFlipTrigger:v,handleFlipChange:f,currentMenu:a}},hr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=vr(),i=n.handleFlipTrigger,a=n.handleFlipChange,u=n.currentMenu;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-flip",R()({},"tie-image-editor_tool-item--checked",u===c.flip)),children:(0,o.jsx)(fr,{open:u===c.flip,onChange:a,children:(0,o.jsx)(H,{content:K.flip[r],placement:"top",children:(0,o.jsx)("i",{className:"tie-image-editor_icon",onClick:i})})})})})},gr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.currentMenuRef,i=e.initCanvasJson,a=e.unSaveHistory,u=(0,g.useState)([]),v=ae()(u,2),f=v[0],l=v[1],h=(0,g.useState)(""),m=ae()(h,2),p=m[0],w=m[1],x=(0,g.useCallback)(function(T){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!(!t.current||a.current)){var J=t.current;try{var G=J.toJSON(Be),_=JSON.stringify(G),j=Date.now()+"_"+Math.floor(Math.random()*1e4),k=f.findIndex(function(E){var D=E.id,B=D===void 0?"":D;return B===p}),O=f.slice(0,k+1-+N).concat(F||!N&&!F?[{id:j,data:_,type:T!==U.delete?n.current:c.default,action:T}]:[]);l(O.slice(Math.max(0,f.length-nt))),w(j)}catch(E){console.error(E)}}},[f,p]),s=(0,g.useCallback)(function(T){T.target.id===Le||T.action===void 0&&T.e||x(U.modified)},[x]),C=(0,g.useCallback)(function(T){T.action===void 0&&T.e||x(U.add)},[x]);(0,g.useEffect)(function(){var T=t.current;if(T)return T&&r&&(T.on("object:modified",s),T.on("object:added",C)),function(){T.off("object:modified",s),T.off("object:added",C)}},[t,r,s,C]);var M=(0,g.useCallback)(function(){var T,N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",F=t.current;if(F&&N!==p){var J=((T=f.find(function(G){var _=G.id;return _===N}))===null||T===void 0?void 0:T.data)||i.current;a.current=!0,F.loadFromJSON(J,function(){F.renderAll(),a.current=!1}),w(N)}},[p,f]),S=(0,g.useCallback)(function(){if(!(!t.current||!f.length)){var T="";if(p)f.forEach(function(F,J){var G=F.id;if(G===p){var _;T=(_=f[J+1])===null||_===void 0?void 0:_.id}});else{var N;T=(N=f[0])===null||N===void 0?void 0:N.id}M(T)}},[p,f]),A=(0,g.useCallback)(function(){if(!(!t.current||!f.length)){var T="";f.forEach(function(N,F){var J=N.id;if(J===p){var G;T=(G=f[F-1])===null||G===void 0?void 0:G.id}}),M(T)}},[p,f]);return{history:f,currentId:p,renderNewCanvas:M,handleRedo:S,handleUndo:A,updateCanvasState:x}},Qe=(0,g.forwardRef)(function(d,e){var t,r,n=(0,g.useContext)(I),i=n.lang,a=i===void 0?y.en:i,u=gr(),v=u.history,f=u.currentId,l=u.renderNewCanvas,h=u.handleRedo,m=u.handleUndo,p=u.updateCanvasState;return(0,g.useImperativeHandle)(e,function(){return{updateCanvasState:p}}),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-history",{"tie-image-editor_tool-item--disabled":!v.length}),children:(0,o.jsx)(H,{content:(0,o.jsxs)("div",{className:"tie-image-editor-history_pop",children:[!!v.length&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"tie-image-editor-history_pop-title",children:[ue.title[a],(0,o.jsxs)("span",{className:"tie-image-editor-history_pop-len",children:["\uFF08",v.length,"\uFF09"]})]}),(0,o.jsxs)("div",{onClick:function(){return l("")},className:z()("tie-image-editor-history_pop-item",{"tie-image-editor-history_pop-item--checked":!f}),children:[(0,o.jsx)("span",{className:"tie-image-editor-history_pop-item-num",children:"1."}),ue.init[a],!f&&(0,o.jsx)("i",{className:"tie-image-editor-history_pop-item-icon"})]})]}),!v.length&&(0,o.jsx)("span",{children:ue.placeholder[a]}),v.map(function(w,x){var s=w.action,C=s===void 0?"":s,M=w.id,S=w.type;return(0,o.jsxs)("div",{onClick:function(){return l(M)},className:z()("tie-image-editor-history_pop-item",{"tie-image-editor-history_pop-item--checked":M===f}),children:[(0,o.jsxs)("span",{className:"tie-image-editor-history_pop-item-num",children:[x+2,"."]}),!!ue[C]&&ue[C][a]," ",!!K[S]&&K[S][a],M===f&&(0,o.jsx)("i",{className:"tie-image-editor-history_pop-item-icon"})]},M)})]}),placement:"bottom",className:"tie-image-editor-history_target",children:(0,o.jsx)("i",{className:z()("tie-image-editor_icon")})})}),(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-redo",{"tie-image-editor_tool-item--disabled":!v.length||f===((t=v[v.length-1])===null||t===void 0?void 0:t.id)}),children:(0,o.jsx)(H,{content:K.redo[a],placement:"top",children:(0,o.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:!v.length||f===((r=v[v.length-1])===null||r===void 0?void 0:r.id)?void 0:h})})}),(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-undo",{"tie-image-editor_tool-item--disabled":!v.length||!f}),children:(0,o.jsx)(H,{content:K.undo[a],placement:"top",children:(0,o.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:!v.length||!f?void 0:m})})})]})});Qe.displayName="History";var mr=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,i=e.onChange,a=function(v){i&&i(v)};return(0,o.jsx)(H,{content:(0,o.jsx)("div",{className:"tie-image-editor_tool-crop-pop",children:(0,o.jsx)("div",{className:"tie-image-editor_tool-paint-size-wrapper",children:X.mosaicSizes.map(function(u,v){return(0,o.jsx)("div",{onClick:function(){return a(u)},className:"tie-image-editor_tool-paint-size",style:{width:10+v*5,height:10+v*5}},u)})})}),placement:"bottom",open:n,children:(0,o.jsx)("div",{children:t})})},pr=mr,fe=X.mosaicSizes[0],Cr=function(e){var t=e.data,r=e.height,n=e.width,i,a,u,v,f,l,h,m,p,w,x;for(a=0;a<r;a+=fe)for(u=0;u<n;u+=fe)for(i=a*4*n+u*4,v=t[i],f=t[i+1],l=t[i+2],h=t[i+3],w=Math.min(a+fe,r),x=Math.min(u+fe,n),m=a;m<w;m++)for(p=u;p<x;p++)i=m*4*n+p*4,t[i]=v,t[i+1]=f,t[i+2]=l,t[i+3]=h},xr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.currentMenu,i=e.currentMenuRef,a=e.setCurrentMenu,u=(0,g.useRef)(null),v=(0,g.useCallback)(function(){var h=t.current;h&&(u.current=new P.fabric.PatternBrush(h),u.current.getPatternSrc=function(){var m={left:0,top:0,width:h.width,height:h.height},p=h.toCanvasElement(1,m),w=p.getContext("2d"),x=w.getImageData(0,0,p.width,p.height);Cr(x),w.putImageData(x,0,0);var s=P.fabric.document.createElement("canvas"),C=s.getContext("2d");return s.width=h.width||0,s.height=h.height||0,C.drawImage(p,0,0,p.width,p.height,m.left,m.top,m.width,m.height),s})},[]);(0,g.useEffect)(function(){r&&v()},[r]);var f=(0,g.useCallback)(function(){var h=t.current;if(h){if(i.current!==c.mosaic){h.isDrawingMode=!0,h.freeDrawingBrush=u.current;var m=h.freeDrawingBrush;m.getPatternSrc&&(m.source=m.getPatternSrc.call(m)),m.width=30,m.shadow=new P.fabric.Shadow({blur:0,offsetX:0,offsetY:0,affectStroke:!0})}else h.isDrawingMode=!1;a(i.current===c.mosaic?c.default:c.mosaic)}},[v]),l=function(m){var p=t.current;if(p){fe=m;var w=p.freeDrawingBrush;w.getPatternSrc&&(w.source=w.getPatternSrc.call(w))}};return{currentMenu:n,handleMosaicTrigger:f,handleSizeChange:l}},Rr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=xr(),i=n.currentMenu,a=n.handleMosaicTrigger,u=n.handleSizeChange;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-mosaic",R()({},"tie-image-editor_tool-item--checked",i===c.mosaic)),children:(0,o.jsx)(pr,{open:i===c.mosaic,onChange:u,children:(0,o.jsx)(H,{content:K.mosaic[r],placement:"top",children:(0,o.jsx)("i",{className:"tie-image-editor_icon",onClick:a})})})})})},wr=Rr,Mr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.canvasIsRender,i=e.currentMenu,a=e.historyRef,u=e.setCurrentMenu,v=(0,g.useRef)(!1),f=(0,g.useRef)({x:9,y:0}),l=(0,g.useRef)(null),h=(0,g.useRef)({color:X.colors[0],size:X.sizes[0]}),m=function(){var s=t.current;s&&(s.on("mouse:down",function(C){if(s.getActiveObject()||r.current!==c.rect)return!1;v.current=!0;var M=s.getPointer(C.e);f.current.x=M.x,f.current.y=M.y,l.current=new P.fabric.Rect({left:f.current.x,top:f.current.y,originX:"left",originY:"top",width:M.x-f.current.x,height:M.y-f.current.y,angle:0,fill:"rgba(255,0,0,0)",stroke:h.current.color,strokeWidth:h.current.size,transparentCorners:!1}),s.add(l.current)}),s.on("mouse:move",function(C){if(!s.getActiveObject()&&r.current===c.rect&&s.setCursor(le.crosshair),!v.current||!l.current||r.current!==c.rect){s.renderAll();return}var M=s.getPointer(C.e);f.current.x>M.x&&l.current.set({left:Math.abs(M.x)}),f.current.y>M.y&&l.current.set({top:Math.abs(M.y)}),l.current.set({width:Math.abs(f.current.x-M.x)}),l.current.set({height:Math.abs(f.current.y-M.y)}),s.setCursor(le.crosshair),s.renderAll()}),s.on("mouse:up",function(C){if(!(!l.current||r.current!==c.rect)){var M=s.getPointer(C.e);M.x===l.current.left&&M.y===l.current.top?(s.remove(l.current),s.requestRenderAll(),a.current.updateCanvasState(U.add,!0,!1)):(s.setActiveObject(l.current),a.current.updateCanvasState(U.add,!0,!0)),v.current=!1,l.current=null}}))};(0,g.useEffect)(function(){t.current&&n&&m()},[t,n]);var p=function(){var s=r.current===c.rect?c.default:c.rect;console.log("currentMenuRef.current",s,r.current),u(s)},w=function(s,C){if(t.current){var M=t.current,S=M.getActiveObjects()[0];s===se.color?(h.current.color=C,S&&S.set("stroke",C)):(h.current.size=C,S&&S.set("strokeWidth",C)),M.renderAll()}};return{handleDrawRect:p,handlePaintChange:w,currentMenu:i}},yr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=Mr(),i=n.handleDrawRect,a=n.handlePaintChange,u=n.currentMenu;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-rect",R()({},"tie-image-editor_tool-item--checked",u===c.rect)),children:(0,o.jsx)(de,{open:u===c.rect,onChange:a,children:(0,o.jsx)(H,{content:K.rect[r],placement:"top",children:(0,o.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:i})})})})})},_r=function(){var e=(0,g.useContext)(I),t=e.setCurrentMenu,r=e.currentMenuRef,n=e.canvasInstanceRef,i=e.historyRef,a=function(){r.current!==c.reset&&t(c.reset);var v=n.current;if(v){v.getObjects().forEach(function(h){h!==v.backgroundImage&&v.remove(h)});var f=v.getCenter();v.zoomToPoint(new P.fabric.Point(f.left,f.top),1);var l=v.viewportTransform;l[4]=0,l[5]=0,v.setViewportTransform(l),v.renderAll(),i.current.updateCanvasState(U.add)}};return{handleReset:a}},jr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=_r(),i=n.handleReset;return(0,o.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-reset",children:(0,o.jsx)(H,{content:K.reset[r],placement:"top",children:(0,o.jsx)("i",{className:"tie-image-editor_icon",onClick:i})})})},Tr=b(15560),Kr=b(39843),Sr=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,i=e.onChange,a=(0,g.useState)(X.rotates[0]),u=ae()(a,2),v=u[0],f=u[1],l=function(m){f(+m),i&&i(+m)};return(0,o.jsx)(H,{content:(0,o.jsx)("div",{className:"tie-image-editor_tool-rotate-pop-content",children:(0,o.jsx)(Tr.Z,{min:X.rotates[0],max:X.rotates[X.rotates.length-1],onChange:l,value:v,marks:X.rotates.reduce(function(h,m){return W()(W()({},h),{},R()({},m,m+"\xB0"))},{})})}),placement:"bottom-end",open:n,children:(0,o.jsx)("div",{children:t})})},kr=Sr,br=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,i=e.canvasIsRender,a=e.currentMenu,u=e.historyRef;(0,g.useEffect)(function(){var l=t.current},[i]);var v=function(){n(r.current!==c.rotate?c.rotate:c.default)},f=function(h){var m=t.current;if(m){m.getObjects().forEach(function(w){w.originalPoint=w.originalPoint||new P.fabric.Point(w.left,w.top);var x=P.fabric.util.rotatePoint(w.originalPoint,m.getVpCenter(),P.fabric.util.degreesToRadians(h));w.set({left:x.x,top:x.y,angle:h})});var p=m.backgroundImage;p.rotate(h),p.setCoords(),m.requestRenderAll(),u.current.updateCanvasState(U.add)}};return{handleRotateTrigger:v,handleRotateChange:f,currentMenu:a}},Er=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=br(),i=n.handleRotateTrigger,a=n.handleRotateChange,u=n.currentMenu;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-rotate",R()({},"tie-image-editor_tool-item--checked",u===c.rotate)),children:(0,o.jsx)(kr,{open:u===c.rotate,onChange:a,children:(0,o.jsx)(H,{content:K.rotate[r],placement:"top",children:(0,o.jsx)("i",{className:"tie-image-editor_icon",onClick:i})})})})})},Ir=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,i=e.zoom,a=i===void 0?1:i,u=e.resetText,v=u===void 0?"":u,f=e.onScaleUp,l=e.onScaleDown,h=e.onReset,m=e.onOpenChange;return(0,o.jsx)(H,{content:(0,o.jsxs)("div",{className:"tie-image-editor_tool-scale-pop-content",children:[(0,o.jsxs)("div",{className:"tie-image-editor_tool-scale-pop-zoom",children:[+(a*100).toFixed(0),"%"]}),(0,o.jsxs)("div",{className:"tie-image-editor_tool-scale-pop-icons",children:[(0,o.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-subtract",children:(0,o.jsx)("i",{className:"tie-image-editor_tool-scale-pop-icon tie-image-editor_icon",onClick:l})}),(0,o.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-add",children:(0,o.jsx)("i",{className:"tie-image-editor_tool-scale-pop-icon tie-image-editor_icon",onClick:f})})]}),(0,o.jsx)("button",{onClick:h,children:v})]}),placement:"bottom-end",open:n,showArrow:!1,trigger:"click",onOpenChange:m,children:(0,o.jsx)("div",{children:t})})},Pr=Ir,Dr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.currentMenuRef,i=e.zoom,a=e.setZoom,u=e.setCurrentMenu;(0,g.useEffect)(function(){var p=t.current;p&&r&&p.on("mouse:wheel",function(w){var x=w.e.deltaY,s=p.getZoom();s*=Math.pow(.999,x),s>20&&(s=20),s<.01&&(s=.01),a(s),p.requestRenderAll(),w.e.preventDefault(),w.e.stopPropagation()})},[t,r]),(0,g.useEffect)(function(){var p=t.current;if(p){var w=p.getCenter();p.zoomToPoint(new P.fabric.Point(w.left,w.top),i<0?.01:i),n.current!==c.scale&&u(c.scale)}},[i]);var v=function(){if(t.current){var w=t.current,x=w.getZoom();x+=.05,a(x)}},f=function(){if(t.current){var w=t.current,x=w.getZoom();x-=.05,a(x)}},l=function(){u(n.current===c.scale?c.default:c.scale)},h=function(){a(1)},m=(0,g.useCallback)(function(p){setTimeout(function(){c.scale===n.current&&u(p?c.scale:c.default)})},[]);return{zoom:i,handleScaleUp:v,handleScaleDown:f,handleScaleTrigger:l,handleReset:h,handleOpenChange:m}},Nr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=e.currentMenu,i=Dr(),a=i.zoom,u=i.handleScaleDown,v=i.handleScaleUp,f=i.handleScaleTrigger,l=i.handleReset,h=i.handleOpenChange;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-zoomIn",R()({},"tie-image-editor_tool-item--checked",n===c.scale)),children:(0,o.jsx)(Pr,{open:n===c.scale,zoom:a,onScaleDown:u,onScaleUp:v,onReset:l,onOpenChange:h,resetText:K.reset[r],children:(0,o.jsx)(H,{content:K.scale[r],placement:"top",children:(0,o.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:f})})},c.scale)})})},Or=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,i=e.canvasIsRender,a=e.currentMenu,u=(0,g.useRef)({color:X.colors[0],size:X.fontSizes[0]}),v=(0,g.useRef)(!1),f=(0,g.useCallback)(function(p){var w=t.current;if(!(!w||p.target)){if(v.current){v.current=!1;return}if(!(w.getActiveObject()||r.current!==c.text)){var x=w.getPointer(p.e),s=new P.fabric.IText("\u8F93\u5165\u5185\u5BB9",{left:x.x,top:x.y,fontSize:u.current.size,id:Math.random()*4+"_"+Date.now(),fill:u.current.color});w.add(s),w.setActiveObject(s),v.current=!0,w.renderAll()}}},[]),l=function(){var w=t.current;w&&w.on("mouse:up",f)};(0,g.useEffect)(function(){var p=t.current;if(!(!p||!i))return l(),function(){p.off("mouse:up",f)}},[i]);var h=function(){n(r.current!==c.text?c.text:c.default)},m=function(w,x){if(t.current){var s=t.current,C=s.getActiveObjects()[0];w===se.color?(u.current.color=x,C&&C.set("fill",x)):(u.current.size=x,C&&C.set("fontSize",x)),s.renderAll()}};return{handleTextTrigger:h,handlePaintChange:m,currentMenu:a}},zr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=Or(),i=n.handleTextTrigger,a=n.handlePaintChange,u=n.currentMenu;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-text",R()({},"tie-image-editor_tool-item--checked",u===c.text)),children:(0,o.jsx)(de,{open:u===c.text,onChange:a,type:c.text,children:(0,o.jsx)(H,{content:K.text[r],placement:"top",children:(0,o.jsx)("i",{className:"tie-image-editor_icon",onClick:i})})})})})},Ar=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasEl,n=e.currentMenuRef,i=e.historyRef,a=e.setCurrentMenu,u=e.initBackGroundImage,v=function(l){var h,m=t.current;if(!(!m||!r.current||!l.target.files.length||!((h=l.target.files[0])!==null&&h!==void 0&&(h=h.type)!==null&&h!==void 0&&h.includes("image")))){n.current!==c.upload&&a(c.upload);var p=new FileReader;p.onload=function(w){if(!(!w||!w.target)){var x=new Image;x.src=w.target.result,u(w.target.result,!0,function(){i.current.updateCanvasState(U.add)})}},p.readAsDataURL(l.target.files[0])}};return{handleUpload:v}},Fr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=Ar(),i=n.handleUpload;return(0,o.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-upload",children:(0,o.jsx)(H,{content:K.upload[r],placement:"top",children:(0,o.jsx)("i",{className:"tie-image-editor_icon",children:(0,o.jsx)("input",{onChange:i,type:"file",className:"tie-image-editor_tool-upload-input",accept:"image/*"})})})})},Lr=function(e){var t=e.url,r=(0,g.useRef)(null),n=(0,g.useRef)(),i=(0,g.useRef)(),a=(0,g.useRef)(null),u=(0,g.useState)(!1),v=ae()(u,2),f=v[0],l=v[1],h=(0,g.useState)(c.default),m=ae()(h,2),p=m[0],w=m[1],x=(0,g.useRef)(c.default),s=(0,g.useRef)("{}"),C=(0,g.useRef)(!1),M=(0,g.useRef)({updateCanvasState:function(){}}),S=(0,g.useRef)({downLoad:function(){return Promise.resolve({})}}),A=(0,g.useState)(1),T=ae()(A,2),N=T[0],F=T[1],J=function(k){w(k),x.current=k;var O=i.current;O&&([c.draw,c.mosaic].includes(k)||(O.isDrawingMode=!1),[c.rect,c.circle,c.arrow].includes(k)?O.setCursor(le.crosshair):[c.rect,c.circle,c.arrow].includes(x.current)&&O.setCursor(le.default),O.renderAll())},G=function(){if(a.current&&r.current)try{var k=a.current.getBoundingClientRect(),O=k.width,E=k.height,D=new P.fabric.Canvas(r.current,{containerClass:"tie-image-editor_canvas",width:O,height:E});i.current=D,l(!0);try{s.current=JSON.stringify(D.toJSON(Be))}catch(B){console.error("initCanvasJson \u521D\u59CB\u5316\u5931\u8D25")}}catch(B){console.error(B)}},_=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,E=arguments.length>2?arguments[2]:void 0,D=i.current;if(k.trim()&&D&&a.current){var B=a.current.getBoundingClientRect(),Z=B.height;n.current=P.fabric.Image.fromURL(k,function($){var re=D.getCenter(),q=$.height;if($.scale(Z/q),$.set({left:re.left-$.width*(Z/q)/2,top:re.top-$.height*(Z/q)/2}),$.selectable=!1,$.id=Le,D.setBackgroundImage($,D.renderAll.bind(D)),O){E&&E();return}try{s.current=JSON.stringify(D.toJSON(Be))}catch(Y){console.error("initCanvasJson \u521D\u59CB\u5316\u5931\u8D25")}E&&E()},{crossOrigin:"anonymous"})}};return(0,g.useEffect)(function(){G()},[r,a]),(0,g.useEffect)(function(){_(t)},[t,i,a]),{canvasEl:r,imageInstanceRef:n,canvasInstanceRef:i,wrapperInstanceRef:a,currentMenu:p,setCurrentMenu:J,currentMenuRef:x,canvasIsRender:f,initCanvasJson:s,unSaveHistory:C,historyRef:M,initBackGroundImage:_,downloadRef:S,zoom:N,setZoom:F}},qe=(0,g.forwardRef)(function(d,e){var t=d.url,r=t===void 0?at:t,n=d.style,i=d.menus,a=i===void 0?it:i,u=d.onDownLoad,v=d.lang,f=v===void 0?y.en:v,l=Lr({url:r}),h=l.canvasEl,m=l.canvasInstanceRef,p=l.wrapperInstanceRef,w=l.currentMenu,x=l.setCurrentMenu,s=l.currentMenuRef,C=l.canvasIsRender,M=l.initCanvasJson,S=l.unSaveHistory,A=l.historyRef,T=l.initBackGroundImage,N=l.downloadRef,F=l.zoom,J=l.setZoom;return(0,g.useImperativeHandle)(e,function(){return{downloadRef:N}},[]),(0,o.jsx)(I.Provider,{value:{canvasInstanceRef:m,wrapperInstanceRef:p,currentMenuRef:s,currentMenu:w,setCurrentMenu:x,canvasIsRender:C,canvasEl:h,url:r,onDownLoad:u,initCanvasJson:M,unSaveHistory:S,historyRef:A,initBackGroundImage:T,zoom:F,setZoom:J,lang:f},children:(0,o.jsxs)("div",{className:"tie-image-editor",style:n,children:[(0,o.jsx)(Bt,{}),(0,o.jsxs)("div",{className:"tie-image-editor_tool clearfix",children:[(!a.length||a.includes(c.rect))&&(0,o.jsx)(yr,{}),(!a.length||a.includes(c.circle))&&(0,o.jsx)(Lt,{}),(!a.length||a.includes(c.arrow))&&(0,o.jsx)(At,{}),(!a.length||a.includes(c.draw))&&(0,o.jsx)(ur,{}),(!a.length||a.includes(c.text))&&(0,o.jsx)(zr,{}),(!a.length||a.includes(c.mosaic))&&(0,o.jsx)(wr,{}),(!a.length||a.includes(c.crop))&&(0,o.jsx)(ir,{}),(!a.length||a.includes(c.download))&&(0,o.jsx)(Ze,{ref:N}),(!a.length||a.includes(c.upload))&&(0,o.jsx)(Fr,{}),(!a.length||a.includes(c.drag))&&(0,o.jsx)(cr,{}),(!a.length||a.includes(c.reset))&&(0,o.jsx)(jr,{}),(!a.length||a.includes(c.rotate))&&(0,o.jsx)(Er,{}),(!a.length||a.includes(c.flip))&&(0,o.jsx)(hr,{}),(!a.length||a.includes(c.scale))&&(0,o.jsx)(Nr,{}),(!a.length||a.includes(c.history))&&(0,o.jsx)(Qe,{ref:A})]}),(0,o.jsx)("div",{ref:p,className:"tie-image-editor_modal__wrapper",children:(0,o.jsx)("canvas",{ref:h})})]})})});qe.displayName="Editor";var Hr=b.p+"static/basic.1cfbd9e1.jpg",Wr=function(){return(0,o.jsx)("div",{children:(0,o.jsx)(qe,{url:Hr})})},Br=Wr},24960:function(){},26759:function(){},56272:function(){}}]);
