(self.webpackChunktiny_image_editor=self.webpackChunktiny_image_editor||[]).push([[433],{72511:function(Xr,Xe,b){"use strict";b.r(Xe),b.d(Xe,{default:function(){return Br}});var g=b(67294),rt=b(38416),w=b.n(rt),ge,me,pe,Ce,xe,Re,we,Me,ye,_e,je,Te,Se,ke,be,Ee,Ie,V,Pe,De,Ne,Oe,ze,Ae,oe,ce={OBJECT_ACTIVATED:"objectActivated",OBJECT_MOVED:"objectMoved",OBJECT_SCALED:"objectScaled",OBJECT_CREATED:"objectCreated",TEXT_EDITING:"textEditing",TEXT_CHANGED:"textChanged",ICON_CREATE_RESIZE:"iconCreateResize",ICON_CREATE_END:"iconCreateEnd",ADD_TEXT:"addText",ADD_OBJECT:"addObject",ADD_OBJECT_AFTER:"addObjectAfter",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove",REDO_STACK_CHANGED:"redoStackChanged",UNDO_STACK_CHANGED:"undoStackChanged",SELECTION_CLEARED:"selectionCleared",SELECTION_CREATED:"selectionCreated"},c=function(d){return d.crop="crop",d.history="history",d.download="download",d.draw="draw",d.flip="flip",d.reset="reset",d.rotate="rotate",d.rect="rect",d.circle="circle",d.text="text",d.upload="upload",d.drag="drag",d.scale="scale",d.arrow="arrow",d.mosaic="mosaic",d.undo="undo",d.redo="redo",d.default="",d}({}),y=function(d){return d.zh="zh",d.en="en",d}({}),K=(V={},w()(V,c.crop,(ge={},w()(ge,y.zh,"\u88C1\u526A"),w()(ge,y.en,c.crop),ge)),w()(V,c.history,(me={},w()(me,y.zh,"\u5386\u53F2\u8BB0\u5F55"),w()(me,y.en,c.history),me)),w()(V,c.download,(pe={},w()(pe,y.zh,"\u4E0B\u8F7D"),w()(pe,y.en,c.download),pe)),w()(V,c.draw,(Ce={},w()(Ce,y.zh,"\u753B\u7B14"),w()(Ce,y.en,c.draw),Ce)),w()(V,c.flip,(xe={},w()(xe,y.zh,"\u7FFB\u8F6C"),w()(xe,y.en,c.flip),xe)),w()(V,c.reset,(Re={},w()(Re,y.zh,"\u91CD\u7F6E"),w()(Re,y.en,c.reset),Re)),w()(V,c.rotate,(we={},w()(we,y.zh,"\u65CB\u8F6C"),w()(we,y.en,c.rotate),we)),w()(V,c.rect,(Me={},w()(Me,y.zh,"\u77E9\u5F62"),w()(Me,y.en,c.rect),Me)),w()(V,c.circle,(ye={},w()(ye,y.zh,"\u5706\u5F62"),w()(ye,y.en,c.circle),ye)),w()(V,c.text,(_e={},w()(_e,y.zh,"\u6587\u672C"),w()(_e,y.en,c.text),_e)),w()(V,c.upload,(je={},w()(je,y.zh,"\u4E0A\u4F20"),w()(je,y.en,c.upload),je)),w()(V,c.drag,(Te={},w()(Te,y.zh,"\u62D6\u62FD"),w()(Te,y.en,c.drag),Te)),w()(V,c.scale,(Se={},w()(Se,y.zh,"\u7F29\u653E"),w()(Se,y.en,c.scale),Se)),w()(V,c.arrow,(ke={},w()(ke,y.zh,"\u7BAD\u5934"),w()(ke,y.en,c.arrow),ke)),w()(V,c.mosaic,(be={},w()(be,y.zh,"\u9A6C\u8D5B\u514B"),w()(be,y.en,c.mosaic),be)),w()(V,c.redo,(Ee={},w()(Ee,y.zh,"\u524D\u8FDB"),w()(Ee,y.en,c.redo),Ee)),w()(V,c.undo,(Ie={},w()(Ie,y.zh,"\u540E\u9000"),w()(Ie,y.en,c.undo),Ie)),V),le=function(d){return d.default="default",d.crosshair="crosshair",d.pointer="pointer",d.move="move",d.grab="grab",d.grabbing="grabbing",d.zoomIn="zoom-in",d.zoomOut="zoom-out",d}({}),U=function(d){return d.add="add",d.modified="modified",d.delete="delete",d}({}),ue=(oe={},w()(oe,U.add,(Pe={},w()(Pe,y.zh,"\u6DFB\u52A0"),w()(Pe,y.en,U.add),Pe)),w()(oe,U.modified,(De={},w()(De,y.zh,"\u4FEE\u6539"),w()(De,y.en,U.modified),De)),w()(oe,U.delete,(Ne={},w()(Ne,y.zh,"\u5220\u9664"),w()(Ne,y.en,U.delete),Ne)),w()(oe,"placeholder",(Oe={},w()(Oe,y.zh,"\u6682\u65E0\u5386\u53F2"),w()(Oe,y.en,"no logging"),Oe)),w()(oe,"init",(ze={},w()(ze,y.zh,"\u521D\u59CB\u5316"),w()(ze,y.en,"init"),ze)),w()(oe,"title",(Ae={},w()(Ae,y.zh,"\u5386\u53F2"),w()(Ae,y.en,"history"),Ae)),oe),Fe=function(d){return d.flipX="flipX",d.flipY="flipY",d}({}),Le="workspace",se=function(d){return d.size="size",d.color="color",d}({}),X={sizes:[5,10,20],colors:["red","orange","yellow","green","blue","white"],fontSizes:[30,60,90],rotates:[0,45,90,135,180,225,270,315,360],mosaicSizes:[10,20,30]},He={Z:90,Y:89,SHIFT:16,BACKSPACE:8,DEL:46},Je="tie_image_editor",Jr=8,Be=["id","gradientAngle","selectable","hasControls","source","editable"],nt=30,at="",it=[],ot=["onChange","loadData","onClick","onSelect","options","name","value","defaultValue","values","defaultValues","placeholder","large","small","iconRender","icon","activeIndex","swipeAble","fixedArrows","error","onVisibleChange"],I=g.createContext({canvasInstanceRef:{current:null},wrapperInstanceRef:{current:null},currentMenuRef:{current:c.default},currentMenu:c.default,setCurrentMenu:function(){},canvasIsRender:!1,canvasEl:{current:null},initCanvasJson:{current:null},unSaveHistory:{current:null},historyRef:{current:function(){}},initBackGroundImage:function(){},zoom:1,setZoom:function(){}}),st=function(){return!!(window.File&&window.FileList&&window.FileReader)},ct=function(e){var t=/data:(image\/.+);base64,/,r="",n,o,a;n=e.replace(t,function(v,f){return r=f,""}),n=atob(n);var l=n.length;for(o=new Uint8Array(l),a=0;a<l;a+=1)o[a]=n.charCodeAt(a);return new Blob([o],{type:r})},te=function(e,t,r){if(t>r){var n=[r,t];t=n[0],r=n[1]}return Math.max(t,Math.min(e,r))},lt=function(e,t){var r=Object.assign({},e);return t.forEach(function(n){delete r[n]}),r};function ut(d){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e=e.concat(ot),lt(d,e)}var Vr=function(){if(navigator){var e=navigator.userAgent,t=e.indexOf("Trident")>-1&&e.indexOf("rv:11.0")>-1;if(t)return 11;var r=navigator.appVersion.split(";")[1];if(!r)return;var n=r.replace(/[ ]/g,""),o=/MSIE(\d+)\./.exec(n);if(o)return parseInt(o[1])}},dt=b(94184),z=b.n(dt),ft=b(42122),W=b.n(ft),vt=b(861),ht=b.n(vt),gt=b(70215),mt=b.n(gt),pt=b(27424),ae=b.n(pt),Ct=b(70614),xt=b(81385),Rt=b(63351),wt=b(56690),Mt=b.n(wt),yt=b(89728),_t=b.n(yt),jt=b(66115),Ve=b.n(jt),Tt=b(61655),St=b.n(Tt),kt=b(26389),bt=b.n(kt),Et=b(73935),It=function(d){St()(t,d);var e=bt()(t);function t(r){var n;return Mt()(this,t),n=e.call(this,r),w()(Ve()(n),"container",null),n.container=null,n.getContainer=n.getContainer.bind(Ve()(n)),n}return _t()(t,[{key:"componentDidMount",value:function(){var n=this;this.container=this.props.container||document.body,this.forceUpdate(function(){n.props.onRendered&&n.props.onRendered()})}},{key:"componentDidUpdate",value:function(n){n.container!==this.props.container&&(this.container=this.props.container||null)}},{key:"getContainer",value:function(){return this.container}},{key:"render",value:function(){var n=this.props.children;return this.container&&n?Et.createPortal(n,this.container):null}}]),t}(g.Component),i=b(85893),Pt=["className","style","children","trigger","visible","popoverClassName","popoverStyle","showArrow","content","placement","usePortal","portalContainer","positionFixed","modifiers","outlineColor","backgroundColor","scheduleUpdate","onOpenChange","maskClosable"],Dt=function(e){return(0,i.jsx)("div",{className:"popper__arrow",style:w()({},"border"+(((e==null?void 0:e.arrowPlacement[0])||"").toLocaleUpperCase()+(e.arrowPlacement||"").substring(1))+"Color",e.backgroundColor),children:e.children})},Ke=function(e){var t=(0,g.useRef)(null),r=(0,g.useRef)(null),n=(0,g.useState)(e.open),o=ae()(n,2),a=o[0],l=o[1],v=e.className,f=e.style,u=e.children,h=e.trigger,p=e.visible,x=e.popoverClassName,R=e.popoverStyle,C=e.showArrow,s=e.content,m=e.placement,M=e.usePortal,S=e.portalContainer,A=e.positionFixed,T=e.modifiers,N=e.outlineColor,F=e.backgroundColor,J=e.scheduleUpdate,G=e.onOpenChange,_=e.maskClosable,j=_===void 0?!0:_,k=mt()(e,Pt),O=ut(k,["popoverClassName","popoverStyle","showArrow","content","usePortal","positionFixed","outlineColor","backgroundColor","getPopoverRef","onOpenChange"]),E=function(L){G&&G(L),e.open!==void 0?l(e.open):l(L)},D=function(L){var ee,ie;!t||!r||(ee=t.current)!==null&&ee!==void 0&&ee.contains(L.target)||(ie=r.current)!==null&&ie!==void 0&&ie.contains(L.target)||j&&E(!1)},B=function(){var L=e.open,ee=e.onOpenChange;L!==void 0&&ee===void 0||h==="hover"&&E(!0)},Z=function(){var L=e.open,ee=e.onOpenChange;L!==void 0&&ee===void 0||h==="hover"&&E(!1)},$=function(L){if(L.nativeEvent.stopImmediatePropagation(),h==="click"){E(!a);return}h==="focus"&&E(!0)};(0,g.useEffect)(function(){e.getPopoverRef&&e.getPopoverRef(t)},[]),(0,g.useEffect)(function(){return(h==="click"||h==="focus")&&document.body.addEventListener("click",D,!1),function(){document.body.removeEventListener("click",D,!1)}},[j,e.open]),(0,g.useEffect)(function(){e.open!==void 0&&E(e.open)},[e.open]);var re=function(){var L=A?"fixed":"absolute",ee=[{name:"computeStyles",options:{gpuAcceleration:!1}},{name:"offset",options:{offset:[0,10]}}],ie=function(ne){if(ne)return ne.split("-")[0].toString().replace(/^\S/,function(Ye){return Ye.toUpperCase()})},Q=function(ne){if(ne==="content"&&N)return{borderColor:N};if(ne==="arrow"&&N)return w()({},"border".concat(ie(m),"Color"),N)},ve=function(){if(F)return{color:"#fff",background:F}},he=m.split("-")[0],et=a&&(0,i.jsx)(Ct.r,{placement:m,modifiers:[].concat(ee,ht()(T||[])),strategy:L,children:function(ne){var Ye=ne.ref,Ur=ne.style,$r=ne.placement,tt=ne.arrowProps,Yr=ne.update;return(0,g.useEffect)(function(){a&&Yr()},[J]),(0,i.jsx)("div",{className:z()("tie-popover__popper",x,{"tie-popover__popper-background":F}),style:W()(W()(W()(W()({},Ur),R),Q("content")),ve()),ref:Ye,"x-placement":$r,onMouseEnter:B,onMouseLeave:Z,children:(0,i.jsxs)("div",{ref:t,children:[a&&(0,i.jsx)("div",{className:"tie-popover__content",children:(0,i.jsx)("span",{children:s})}),C&&(0,i.jsx)(Dt,{arrowPlacement:he,backgroundColor:F,children:(0,i.jsx)("div",{"data-popper-arrow":!0,className:"tie-popper__arrow popper__arrow","x-arrow":"true",style:W()(W()({},tt.style),Q("arrow")),ref:tt.ref})})]})})}});return M?(0,i.jsx)(It,{container:S,children:et}):et},q=function(L){if(L.type.__BRICKS_BUTTON&&L.props.disabled){var ee=L.props.style&&L.props.style.display?L.props.style.display:"inline-block",ie=g.cloneElement(L,{style:W()(W()({},L.props.style),{},{pointerEvents:"none"})});return(0,i.jsx)("span",{style:{display:ee,cursor:"not-allowed"},children:ie})}return L};return(0,i.jsx)(i.Fragment,{children:p?(0,i.jsx)("div",W()(W()({className:z()("tie-popover",v)},O),{},{style:f,children:(0,i.jsxs)(xt.dK,{children:[(0,i.jsx)(Rt.s,{children:function(L){var ee=L.ref;return(0,i.jsx)("div",{ref:r,className:"tie-popover__target",children:(0,i.jsx)("div",{ref:ee,children:g.Children.map(u,function(ie){var Q=ie;return Q=q(Q),h==="click"?g.cloneElement(Q,{onClick:function(he){$(he),Q.props.onClick&&Q.props.onClick()}}):h==="focus"?g.cloneElement(Q,{onFocus:function(he){$(he),Q.props.onFocus&&Q.props.onFocus()}}):h==="hover"?g.cloneElement(Q,{onMouseEnter:function(){B(),Q.props.onMouseEnter&&Q.props.onMouseEnter()},onMouseLeave:function(){Z(),Q.props.onMouseLeave&&Q.props.onMouseLeave()}}):Q})})})}}),re()]})})):u})};Ke.defaultProps={visible:!0,trigger:"hover",placement:"bottom",showArrow:!0,usePortal:!0,modifiers:[]};var H=Ke,Nt=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.type,a=e.onChange,l=function(f,u){a&&a(f,u)};return(0,i.jsx)(H,{content:(0,i.jsxs)("div",{className:"tie-image-editor_tool-paint-content",children:[(0,i.jsx)("div",{className:"tie-image-editor_tool-paint-size-wrapper",children:(o===c.text?X.fontSizes:X.sizes).map(function(v,f){return(0,i.jsx)("div",{onClick:function(){return l(se.size,v)},className:"tie-image-editor_tool-paint-size",style:{width:10+f*5,height:10+f*5}},v)})}),(0,i.jsx)("div",{className:"tie-image-editor_tool-paint-color-wrapper",children:X.colors.map(function(v){return(0,i.jsx)("div",{onClick:function(){return l(se.color,v)},className:"tie-image-editor_tool-paint-color",style:{background:v}},v)})})]}),placement:"bottom",open:n,children:(0,i.jsx)("div",{children:t})})},de=Nt,P=b(32777),Ge=P.fabric.util.createClass(P.fabric.Line,{type:"arrow",superType:"drawing",initialize:function(e,t){if(!e){var r=t,n=r.x1,o=r.x2,a=r.y1,l=r.y2;e=[n,a,o,l]}t=t||{},this.callSuper("initialize",e,t)},_render:function(e){this.callSuper("_render",e),e.save();var t=this.x2-this.x1,r=this.y2-this.y1,n=Math.atan2(r,t);e.translate((this.x2-this.x1)/2,(this.y2-this.y1)/2),e.rotate(n),e.beginPath(),e.moveTo(this.strokeWidth*2,0),e.lineTo(-this.strokeWidth*2,this.strokeWidth*2),e.lineTo(-this.strokeWidth*2,-this.strokeWidth*2),e.closePath(),e.fillStyle=this.stroke,e.fill(),e.restore()}});Ge.fromObject=function(d,e){var t=d.x1,r=d.x2,n=d.y1,o=d.y2;return e(new P.fabric.Arrow([t,n,r,o],d))};var Ot=Ge,zt=function(){var e=(0,g.useContext)(I),t=e.currentMenu,r=e.setCurrentMenu,n=e.canvasInstanceRef,o=e.canvasIsRender,a=e.currentMenuRef,l=e.historyRef,v=(0,g.useRef)(!1),f=(0,g.useRef)({x:0,y:0}),u=(0,g.useRef)([]),h=(0,g.useRef)(null),p=(0,g.useRef)({color:X.colors[0],size:X.sizes[0]}),x=function(){var m=n.current;m&&(m.on("mouse:down",function(M){if(!(m.getActiveObject()||a.current!==c.arrow)){m.discardActiveObject(),m.getObjects().forEach(function(A){A.selectable=!1,A.hasControls=!1}),m.requestRenderAll(),v.current=!0,f.current=m.getPointer(M.e),u.current=[f.current.x,f.current.y,f.current.x,f.current.y];var S=new Ot(u.current,{strokeWidth:p.current.size,stroke:p.current.color,id:new Date().valueOf()+"_"+Math.random()*4});S.strokeUniform=!0,h.current=S,m.add(S)}}),m.on("mouse:move",function(M){if(!m.getActiveObject()&&a.current===c.rect&&m.setCursor(le.crosshair),m.getActiveObject()||a.current!==c.arrow||!v.current||!h.current){m.renderAll();return}if(f.current=m.getPointer(M.e),M.e.shiftKey){var S=u.current[0],A=u.current[1],T=f.current.x-S,N=f.current.y-A,F=Math.sqrt(T*T+N*N),J=Math.atan2(N,T)/Math.PI*180;J=parseInt(""+(J+7.5)%360/15)*15;var G=F*Math.cos(J*Math.PI/180),_=F*Math.sin(J*Math.PI/180);h.current.set({x2:G+S,y2:_+A})}else{if(!h.current)return;h.current.set({x2:f.current.x,y2:f.current.y})}m.renderAll()}),m.on("mouse:up",function(){a.current!==c.arrow||!h.current||!v.current||(h.current.setCoords(),v.current=!1,f.current.x===u.current[0]&&f.current.y===u.current[1]?(m.remove(h.current),m.requestRenderAll(),l.current.updateCanvasState(U.add,!0,!1)):(m.setActiveObject(h.current),l.current.updateCanvasState(U.add,!0,!0)))}))};(0,g.useEffect)(function(){n.current&&o&&x()},[n,o]);var R=function(){r(t===c.arrow?c.default:c.arrow)},C=function(m,M){if(n.current){var S=n.current,A=S.getActiveObjects()[0];m===se.color?(p.current.color=M,A&&A.set("stroke",M)):(p.current.size=M,A&&A.set("strokeWidth",M)),S.renderAll()}};return{handleArrowTrigger:R,handlePaintChange:C,currentMenu:t}},At=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=zt(),o=n.handleArrowTrigger,a=n.handlePaintChange,l=n.currentMenu;return(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-arrow",w()({},"tie-image-editor_tool-item--checked",l===c.arrow)),children:(0,i.jsx)(de,{open:l===c.arrow,onChange:a,children:(0,i.jsx)(H,{content:K.arrow[r],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:o})})})})},Ft=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.canvasIsRender,a=e.currentMenu,l=e.historyRef,v=(0,g.useRef)(!1),f=(0,g.useRef)({x:9,y:0}),u=(0,g.useRef)(null),h=(0,g.useRef)({color:X.colors[0],size:X.sizes[0]}),p=function(){var s=t.current;s&&(s.on("mouse:down",function(m){if(!(s.getActiveObject()||r.current!==c.circle)){v.current=!0;var M=s.getPointer(m.e);f.current.x=M.x,f.current.y=M.y,u.current=new P.fabric.Circle({left:f.current.x,top:f.current.y,originX:"left",originY:"top",radius:M.x-f.current.x,angle:0,fill:"",stroke:h.current.color,strokeWidth:h.current.size}),s.add(u.current)}}),s.on("mouse:move",function(m){if(!s.getActiveObject()&&r.current===c.circle&&s.setCursor(le.crosshair),!v.current||r.current!==c.circle){s.renderAll();return}var M=s.getPointer(m.e),S=Math.max(Math.abs(f.current.y-M.y),Math.abs(f.current.x-M.x))/2;S>u.current.strokeWidth&&(S-=u.current.strokeWidth/2),u.current.set({radius:S}),f.current.x>M.x?u.current.set({originX:"right"}):u.current.set({originX:"left"}),f.current.y>M.y?u.current.set({originY:"bottom"}):u.current.set({originY:"top"}),s.renderAll()}),s.on("mouse:up",function(m){if(!(!u.current||r.current!==c.circle)){var M=s.getPointer(m.e);M.x===u.current.left&&M.y===u.current.top?(s.remove(u.current),s.requestRenderAll(),l.current.updateCanvasState(U.add,!0,!1)):(s.setActiveObject(u.current),l.current.updateCanvasState(U.add,!0,!0)),v.current=!1,u.current=null}}))};(0,g.useEffect)(function(){var C=t.current;C&&o&&p()},[t,o]);var x=function(){n(r.current===c.circle?c.default:c.circle)},R=function(s,m){if(t.current){var M=t.current,S=M.getActiveObjects()[0];s===se.color?(h.current.color=m,S&&S.set("stroke",m)):(h.current.size=m,S&&S.set("strokeWidth",m)),M.renderAll()}};return{handleDrawCircle:x,handlePaintChange:R,currentMenu:a}},Lt=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=Ft(),o=n.handleDrawCircle,a=n.handlePaintChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-circle",w()({},"tie-image-editor_tool-item--checked",l===c.circle)),children:(0,i.jsx)(de,{open:l===c.circle,onChange:a,children:(0,i.jsx)(H,{content:K.circle[r],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:o})})})})})},Ht="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E",Wt=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.historyRef,o=function(){var l=document.createElement("img");l.src=Ht,P.fabric.Object.prototype.transparentCorners=!1,P.fabric.Object.prototype.cornerColor="blue",P.fabric.Object.prototype.cornerStyle="circle";function v(u,h){var p=h.target,x=p.canvas;return x.remove(p),x.requestRenderAll(),n.current.updateCanvasState(U.delete),!0}function f(u,h,p,x,R){var C=24;u.save(),u.translate(h,p),u.rotate(P.fabric.util.degreesToRadians(R.angle)),u.drawImage(l,-C/2,-C/2,C,C),u.restore()}P.fabric.Object.prototype.controls.deleteControl=new P.fabric.Control({x:.5,y:-.5,offsetY:16,cursorStyle:"pointer",mouseUpHandler:v,render:f})};(0,g.useEffect)(function(){t.current&&r&&o()},[t,r])},Bt=function(){return Wt(),(0,i.jsx)(i.Fragment,{})},Ut="tl",$t="tr",Yt="mt",Xt="ml",Jt="mr",Vt="mb",Kt="bl",Gt="br",Zt=[Ut,$t,Yt,Xt,Jt,Vt,Kt,Gt],Ue=function(){};function Qt(d){return Zt.indexOf(d)>=0}function We(d,e){return d>e?"width":"height"}var qt=P.fabric.util.createClass(P.fabric.Rect,{initialize:function(e,t,r){t=W()(W()({},t),r),t.type="cropzone",this.callSuper("initialize",t),this._addEventHandler(),this.canvas=e,this.options=t},canvasEventDelegation:function(e){var t="unregistered",r=this.canvasEventTrigger[e]!==Ue;return r?t="registered":[ce.OBJECT_MOVED,ce.OBJECT_SCALED].indexOf(e)<0&&(t="none"),t},canvasEventRegister:function(e,t){this.canvasEventTrigger[e]=t},_addEventHandler:function(){var e;this.canvasEventTrigger=(e={},w()(e,ce.OBJECT_MOVED,Ue),w()(e,ce.OBJECT_SCALED,Ue),e),this.on({moving:this._onMoving.bind(this),scaling:this._onScaling.bind(this)}),P.fabric.util.addListener(document,"keydown",this._onKeyDown.bind(this)),P.fabric.util.addListener(document,"keyup",this._onKeyUp.bind(this))},_renderCropzone:function(e){var t=7,r=7,n=this.flipX?-1:1,o=this.flipY?-1:1,a=n/this.scaleX,l=o/this.scaleY;e.scale(a,l),this._fillOuterRect(e,"rgba(0, 0, 0, 0.5)"),this.options.lineWidth?(this._fillInnerRect(e),this._strokeBorder(e,"rgb(255, 255, 255)",{lineWidth:this.options.lineWidth})):(this._strokeBorder(e,"rgb(0, 0, 0)",{lineDashWidth:t}),this._strokeBorder(e,"rgb(255, 255, 255)",{lineDashWidth:t,lineDashOffset:r})),e.scale(1/a,1/l)},_render:function(e){this.callSuper("_render",e),this._renderCropzone(e)},_fillOuterRect:function(e,t){var r=this._getCoordinates(),n=r.x,o=r.y;console.log("_fillOuterRect",n,o),e.save(),e.fillStyle=t,e.beginPath(),e.moveTo(n[1],o[1]),e.lineTo(n[1],o[2]),e.lineTo(n[2],o[2]),e.lineTo(n[2],o[1]),e.lineTo(n[1],o[1]),e.closePath(),e.fill(),e.restore()},_fillInnerRect:function(e){var t=this._getCoordinates(),r=t.x,n=t.y,o=this._caculateInnerPosition(r,(r[2]-r[1])/3),a=this._caculateInnerPosition(n,(n[2]-n[1])/3);e.save(),e.strokeStyle="rgba(255, 255, 255, 0.7)",e.lineWidth=this.options.lineWidth,e.beginPath(),e.moveTo(o[0],a[1]),e.lineTo(o[3],a[1]),e.moveTo(o[0],a[2]),e.lineTo(o[3],a[2]),e.moveTo(o[1],a[0]),e.lineTo(o[1],a[3]),e.moveTo(o[2],a[0]),e.lineTo(o[2],a[3]),e.stroke(),e.closePath(),e.restore()},_caculateInnerPosition:function(e,t){var r=[];return r[0]=e[1],r[1]=e[1]+t,r[2]=e[1]+t*2,r[3]=e[2],r},_getCoordinates:function(){var e=this.canvas,t=this.width,r=this.height,n=this.left,o=this.top,a=t/2,l=r/2,v=e.getHeight(),f=e.getWidth();return{x:[-(a+n),-a,a,a+(f-n-t)].map(Math.ceil),y:[-(l+o),-l,l,l+(v-o-r)].map(Math.ceil)}},_strokeBorder:function(e,t,r){var n=r.lineDashWidth,o=r.lineDashOffset,a=r.lineWidth,l=this.width/2,v=this.height/2;e.save(),e.strokeStyle=t,e.setLineDash&&e.setLineDash([n,n]),o&&(e.lineDashOffset=o),a&&(e.lineWidth=a),e.beginPath(),e.moveTo(-l,-v),e.lineTo(l,-v),e.lineTo(l,v),e.lineTo(-l,v),e.lineTo(-l,-v),e.stroke(),e.restore()},_onMoving:function(){var e=this.height,t=this.width,r=this.left,n=this.top,o=this.canvas.getWidth()-t,a=this.canvas.getHeight()-e;this.left=te(r,0,o),this.top=te(n,0,a),this.canvasEventTrigger[ce.OBJECT_MOVED](this)},_onScaling:function(e){var t=e.transform.corner,r=this.canvas.getPointer(e.e),n=this._calcScalingSizeFromPointer(r,t);this.scale(1).set(n),this.canvasEventTrigger[ce.OBJECT_SCALED](this)},_calcScalingSizeFromPointer:function(e,t){var r=Qt(t);return r&&this._resizeCropZone(e,t)},adjustRatioCropzoneSize:function(e){var t=e.width,r=e.height,n=e.leftMaker,o=e.topMaker,a=e.maxWidth,l=e.maxHeight,v=e.scaleTo;if(t=a?te(t,1,a):t,r=l?te(r,1,l):r,!this.presetRatio)return this._withShiftKey&&(t>r?r=t:r>t&&(t=r)),{width:t,height:r,left:n(t),top:o(r)};v==="width"?r=t/this.presetRatio:t=r*this.presetRatio;var f=Math.min(a/t,l/r);if(f<=1){var u=[t,r].map(function(p){return p*f}),h=ae()(u,2);t=h[0],r=h[1]}return{width:t,height:r,left:n(t),top:o(r)}},_getCropzoneRectInfo:function(){var e=this.canvas,t=e.width,r=e.height,n=this.getBoundingRect(!1,!0),o=n.top,a=n.left,l=n.width,v=n.height;return{rectTop:o,rectLeft:a,rectWidth:l,rectHeight:v,rectRight:a+l,rectBottom:o+v,canvasWidth:t,canvasHeight:r}},_resizeCropZone:function(e,t){var r=e.x,n=e.y,o=this._getCropzoneRectInfo(),a=o.rectWidth,l=o.rectHeight,v=o.rectTop,f=o.rectLeft,u=o.rectBottom,h=o.rectRight,p=o.canvasWidth,x=o.canvasHeight,R={tl:{width:h-r,height:u-n,leftMaker:function(s){return h-s},topMaker:function(s){return u-s},maxWidth:h,maxHeight:u,scaleTo:We(f-r,v-n)},tr:{width:r-f,height:u-n,leftMaker:function(){return f},topMaker:function(s){return u-s},maxWidth:p-f,maxHeight:u,scaleTo:We(r-h,v-n)},mt:{width:a,height:u-n,leftMaker:function(){return f},topMaker:function(s){return u-s},maxWidth:p-f,maxHeight:u,scaleTo:"height"},ml:{width:h-r,height:l,leftMaker:function(s){return h-s},topMaker:function(){return v},maxWidth:h,maxHeight:x-v,scaleTo:"width"},mr:{width:r-f,height:l,leftMaker:function(){return f},topMaker:function(){return v},maxWidth:p-f,maxHeight:x-v,scaleTo:"width"},mb:{width:a,height:n-v,leftMaker:function(){return f},topMaker:function(){return v},maxWidth:p-f,maxHeight:x-v,scaleTo:"height"},bl:{width:h-r,height:n-v,leftMaker:function(s){return h-s},topMaker:function(){return v},maxWidth:h,maxHeight:x-v,scaleTo:We(f-r,n-u)},br:{width:r-f,height:n-v,leftMaker:function(){return f},topMaker:function(){return v},maxWidth:p-f,maxHeight:x-v,scaleTo:We(r-h,n-u)}};return this.adjustRatioCropzoneSize(R[t])},isValid:function(){return this.left>=0&&this.top>=0&&this.width>0&&this.height>0},_onKeyDown:function(e){var t=e.keyCode;t===He.SHIFT&&(this._withShiftKey=!0)},_onKeyUp:function(e){var t=e.keyCode;t===He.SHIFT&&(this._withShiftKey=!1)}}),er=qt,tr=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.onChange,a=function(v){o&&o(v)};return(0,i.jsx)(H,{content:(0,i.jsxs)("div",{className:"tie-image-editor_tool-crop-pop",children:[(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-done",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:function(){return a(!0)}})}),(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-clear",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:function(){return a(!1)}})})]}),placement:"bottom",open:n,children:(0,i.jsx)("div",{children:t})})},rr=tr,nr=10,ar=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.canvasIsRender,a=e.currentMenu,l=e.wrapperInstanceRef,v=e.historyRef,f=e.unSaveHistory,u=(0,g.useRef)(null),h=(0,g.useRef)(0),p=(0,g.useRef)(0),x=(0,g.useRef)(!1),R=(0,g.useCallback)(function(_,j){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,O=t.current;if(O){var E=O.getWidth(),D=O.getHeight(),B=h.current,Z=p.current,$=te(_,0,B),re=te(j,0,Z),q=te(_,B,E)-$,Y=te(j,Z,D)-re;return x.current&&!k?(q>Y?Y=q:Y>q&&(q=Y),B>=_&&($=B-q),Z>=j&&(re=Z-Y)):k&&(Y=q/k,B>=_&&($=te(B-q,0,E)),Z>=j&&(re=te(Z-Y,0,D)),re+Y>D&&(Y=D-re,q=Y*k,B>=_&&($=te(B-q,0,E)),Z>=j&&(re=te(Z-Y,0,D)))),{left:$,top:re,width:q,height:Y}}},[]),C=(0,g.useCallback)(function(_){r.current===c.crop&&_.keyCode===He.SHIFT&&(x.current=!0)},[]),s=(0,g.useCallback)(function(_){r.current===c.crop&&_.keyCode===He.SHIFT&&(x.current=!1)},[]),m=(0,g.useCallback)(function(_){var j=t.current;if(j&&r.current===c.crop){var k=j.getPointer(_.e),O=k.x,E=k.y,D=u.current;D&&Math.abs(O-h.current)+Math.abs(E-p.current)>nr&&(j.remove(D),D.set(R(O,E,D.presetRatio)),j.add(D),j.setActiveObject(D))}},[o]),M=(0,g.useCallback)(function(){var _=t.current;if(_&&r.current===c.crop){var j=u.current;_.setActiveObject(j),_.off("mouse:move",m),_.off("mouse:up",M)}},[o]),S=(0,g.useCallback)(function(_){if(!_.target){var j=t.current;if(j&&r.current===c.crop){j.selection=!1;var k=j.getPointer(_.e);h.current=k.x,p.current=k.y,j.on("mouse:move",m),j.on("mouse:up",M)}}},[o]),A=(0,g.useCallback)(function(){var _=t.current;!_||!o||u.current||(f.current=!0,_.getObjects().forEach(function(j){j.evented=!1}),u.current=new er(t.current,{left:0,top:0,width:.5,height:.5,strokeWidth:0,cornerSize:16,cornerColor:"blue",fill:"transparent",hasRotatingPoint:!1,hasBorders:!1,lockScalingFlip:!0,lockRotation:!0,lockSkewingX:!0,lockSkewingY:!0,cornerStyle:"circle",cornerStrokeColor:"blue",transparentCorners:!1,lineWidth:2,borderColor:"blue"}),_.discardActiveObject(),_.add(u.current),_.on("mouse:down",S),_.selection=!1,_.defaultCursor="crosshair",P.fabric.util.addListener(document,"keydown",C),P.fabric.util.addListener(document,"keyup",s))},[o]),T=(0,g.useCallback)(function(){var _=t.current;if(_){var j=u.current;j&&(_.remove(j),_.selection=!0,_.defaultCursor="default",_.off("mouse:down",S),_.off("mouse:move",m),_.off("mouse:up",M),_.forEachObject(function(k){k.evented=!0}),u.current=null,P.fabric.util.removeListener(document,"keydown",C),P.fabric.util.removeListener(document,"keyup",s),f.current=!1)}},[o]),N=function(){r.current!==c.crop?A():T(),n(r.current!==c.crop?c.crop:c.default)},F=function(){var j=u.current;return!j||!j.isValid()?null:{left:j.left,top:j.top,width:j.width,height:j.height}},J=function(){var j=t.current;if(j){var k=j.contains(u.current),O=F();if(!O)return null;k&&j.remove(u.current);var E={imageName:Je,url:j.toDataURL(O)};return k&&j.add(u.current),E}},G=function(j){var k=t.current;if(k)if(!j)T(),A();else{var O=J();if(!O||!O.url.includes("base64"))return;k.clear(),k.setBackgroundImage(O.url,function(){var E=k.backgroundImage,D=l.current.getBoundingClientRect(),B=D.height,Z=k.getCenter(),$=E.height;E.scale(B/$),E.set({left:Z.left-E.width*(B/$)/2,top:Z.top-E.height*(B/$)/2}),E.selectable=!1,E.id=Le,k.renderAll(),T(),v.current.updateCanvasState(U.add),A()})}};return(0,g.useEffect)(function(){a!==c.crop&&u.current&&T()},[a]),{handleCropTrigger:N,handleCropChange:G,currentMenu:a}},ir=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=ar(),o=n.handleCropTrigger,a=n.handleCropChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-crop",w()({},"tie-image-editor_tool-item--checked",l===c.crop)),children:(0,i.jsx)(rr,{open:l===c.crop,onChange:a,children:(0,i.jsx)(H,{content:K.crop[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})})})},or=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasEl,n=e.onDownLoad,o=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;console.log("heheh");var v=t.current;if(!v||!r.current)return Promise.reject();var f=v.toDataURL(),u=Date.now()+Je,h,p;if(n)return n({downLoadUrl:f}),Promise.resolve({downLoadUrl:f});if(!l)return Promise.resolve({downLoadUrl:f});if(st()&&window.saveAs)h=ct(f),p=h.type.split("/")[1],u.split(".").pop()!==p&&(u+=".".concat(p)),window.saveAs(h,u);else{u.split(".").pop()!==p&&(u+=".png");var x=document.createElement("a");x.href=f,x.download=u,document.body.appendChild(x),x.click(),x.remove()}return Promise.resolve({downLoadUrl:f})};return{handleDownload:o}},Ze=(0,g.forwardRef)(function(d,e){var t=(0,g.useContext)(I),r=t.lang,n=r===void 0?y.en:r,o=or(),a=o.handleDownload;return(0,g.useImperativeHandle)(e,function(){return{download:a}},[a]),(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-download",children:(0,i.jsx)(H,{content:K.download[n],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:function(){return a(!0)}})})})});Ze.displayName="Download";var sr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.wrapperInstanceRef,n=e.canvasIsRender,o=e.currentMenu,a=e.setCurrentMenu,l=(0,g.useRef)(!1);(0,g.useEffect)(function(){l.current=o===c.drag},[a,o]);var v=function(){var s=t.current;s&&(s.selection=!1,s.defaultCursor="grab",s.getObjects().forEach(function(m){m.selectable=!1}),s.requestRenderAll())},f=function(){var s=t.current;s&&(console.log("startDring"),a(c.drag),s.defaultCursor="grab",s.renderAll())},u=function(){var s=t.current;s&&(a(c.default),s.defaultCursor="default",s.isDragging=!1,s.selection=!1,s.renderAll())},h=function(){var s=t.current;s&&(s.on("mouse:down",function(m){var M=m.e;(M.altKey||l.current)&&(s.defaultCursor="grabbing",s.discardActiveObject(),v(),s.selection=!1,s.isDragging=!0,s.lastPosX=M.clientX,s.lastPosY=M.clientY,s.requestRenderAll())}),s.on("mouse:move",function(m){if(s.isDragging){s.discardActiveObject(),s.defaultCursor="grabbing";var M=m.e;if(!s.viewportTransform)return;var S=s.viewportTransform;S[4]+=M.clientX-s.lastPosX,S[5]+=M.clientY-s.lastPosY,s.lastPosX=M.clientX,s.lastPosY=M.clientY,s.requestRenderAll()}}),s.on("mouse:up",function(){!s.viewportTransform||!l.current||(s.setViewportTransform(this.viewportTransform),s.isDragging=!1,s.selection=!0,s.getObjects().forEach(function(m){m.id!==Le&&m.hasControls&&(m.selectable=!0)}),s.defaultCursor="default",s.requestRenderAll())}))},p=function(s){var m=t.current;s.keyCode===32&&m&&!l.current&&f(),s.preventDefault()},x=function(s){var m=t.current;s.keyCode===32&&m&&u()};(0,g.useEffect)(function(){return t.current&&n&&(h(),r.current.tabIndex=1e3,r.current.addEventListener("keydown",p,!1),r.current.addEventListener("keyup",x,!1)),function(){var C=t.current;if(C&&r.current){var s,m;(s=r.current)===null||s===void 0||s.removeEventListener("keydown",p,!1),(m=r.current)===null||m===void 0||m.removeEventListener("keyup",x,!1)}}},[t,n]);var R=function(){a(o!==c.drag?c.drag:c.default)};return{handleMoving:R,currentMenu:o}},cr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=sr(),o=n.handleMoving,a=n.currentMenu;return(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-hand",w()({},"tie-image-editor_tool-item--checked",a===c.drag)),children:(0,i.jsx)(H,{content:K.drag[r],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:o})})})},lr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.currentMenu,a=(0,g.useRef)({color:X.colors[0],size:X.sizes[0]}),l=function(){var h=t.current;if(h){h.freeDrawingBrush=new P.fabric.PencilBrush(h);var p=h.freeDrawingBrush;p.color=a.current.color,p.getPatternSrc&&(p.source=p.getPatternSrc.call(p)),p.width=a.current.size,p.shadow=new P.fabric.Shadow({blur:a.current.size,offsetX:0,offsetY:0,affectStroke:!0,color:"#333"})}},v=function(){var h=t.current;h&&(r.current!==c.draw?(h.isDrawingMode=!0,l()):h.isDrawingMode=!1,n(r.current!==c.draw?c.draw:c.default))},f=function(h,p){if(t.current){var x=t.current,R=x.getActiveObjects()[0];h===se.color?(a.current.color=p,R&&R.set("fill",p)):(a.current.size=p,R&&R.set("width",p)),x.renderAll(),l()}};return{handleDrawTrigger:v,handlePaintChange:f,currentMenu:o}},ur=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=lr(),o=n.handleDrawTrigger,a=n.handlePaintChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-draw",w()({},"tie-image-editor_tool-item--checked",l===c.draw)),children:(0,i.jsx)(de,{open:l===c.draw,onChange:a,children:(0,i.jsx)(H,{content:K.draw[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})})})},dr=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.onChange,a=(0,g.useState)(!1),l=ae()(a,2),v=l[0],f=l[1],u=(0,g.useState)(!1),h=ae()(u,2),p=h[0],x=h[1],R=function(s,m){s===Fe.flipX?f(m):x(m),o&&o(s,m)};return(0,i.jsx)(H,{content:(0,i.jsxs)("div",{className:"tie-image-editor_tool-flip-pop",children:[(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-flipX",onClick:function(){return R(Fe.flipX,!v)},children:(0,i.jsx)("i",{className:"tie-image-editor_icon"})}),(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-flipY",onClick:function(){return R(Fe.flipY,!p)},children:(0,i.jsx)("i",{className:"tie-image-editor_icon"})})]}),placement:"bottom",open:n,children:(0,i.jsx)("div",{children:t})})},fr=dr,vr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.canvasIsRender,a=e.currentMenu,l=e.historyRef;(0,g.useEffect)(function(){var u=t.current},[o]);var v=function(){n(r.current!==c.flip?c.flip:c.default)},f=function(h,p){var x=t.current;if(x){x.getObjects().forEach(function(s){s.originalPoint=s.originalPoint||{left:s.left,top:s.top};var m=w()({},h,p);h===Fe.flipX?p?m=W()(W()({},m),{},{left:x.width-s.originalPoint.left-s.width}):m=W()(W()({},m),{},{left:s.originalPoint.left}):p?m=W()(W()({},m),{},{top:x.height-s.originalPoint.top-s.height}):m=W()(W()({},m),{},{top:s.originalPoint.top}),s.set(m).rotate(parseFloat((s.angle*-1).toString())).setCoords()});var R=x.backgroundImage,C=R.angle;p&&(C*=-1),R.set(w()({},h,p)),R.rotate(parseFloat(C)).setCoords(),R.setCoords(),x.renderAll(),l.current.updateCanvasState(U.add)}};return{handleFlipTrigger:v,handleFlipChange:f,currentMenu:a}},hr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=vr(),o=n.handleFlipTrigger,a=n.handleFlipChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-flip",w()({},"tie-image-editor_tool-item--checked",l===c.flip)),children:(0,i.jsx)(fr,{open:l===c.flip,onChange:a,children:(0,i.jsx)(H,{content:K.flip[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})})})},gr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.currentMenuRef,o=e.initCanvasJson,a=e.unSaveHistory,l=(0,g.useState)([]),v=ae()(l,2),f=v[0],u=v[1],h=(0,g.useState)(""),p=ae()(h,2),x=p[0],R=p[1],C=(0,g.useCallback)(function(T){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!(!t.current||a.current)){var J=t.current;try{var G=J.toJSON(Be),_=JSON.stringify(G),j=Date.now()+"_"+Math.floor(Math.random()*1e4),k=f.findIndex(function(E){var D=E.id,B=D===void 0?"":D;return B===x}),O=f.slice(0,k+1-+N).concat(F||!N&&!F?[{id:j,data:_,type:T!==U.delete?n.current:c.default,action:T}]:[]);u(O.slice(Math.max(0,f.length-nt))),R(j)}catch(E){console.error(E)}}},[f,x]),s=(0,g.useCallback)(function(T){T.target.id===Le||T.action===void 0&&T.e||C(U.modified)},[C]),m=(0,g.useCallback)(function(T){T.action===void 0&&T.e||C(U.add)},[C]);(0,g.useEffect)(function(){var T=t.current;if(T)return T&&r&&(T.on("object:modified",s),T.on("object:added",m)),function(){T.off("object:modified",s),T.off("object:added",m)}},[t,r,s,m]);var M=(0,g.useCallback)(function(){var T,N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",F=t.current;if(F&&N!==x){var J=((T=f.find(function(G){var _=G.id;return _===N}))===null||T===void 0?void 0:T.data)||o.current;a.current=!0,F.loadFromJSON(J,function(){F.renderAll(),a.current=!1}),R(N)}},[x,f]),S=(0,g.useCallback)(function(){if(!(!t.current||!f.length)){var T="";if(x)f.forEach(function(F,J){var G=F.id;if(G===x){var _;T=(_=f[J+1])===null||_===void 0?void 0:_.id}});else{var N;T=(N=f[0])===null||N===void 0?void 0:N.id}M(T)}},[x,f]),A=(0,g.useCallback)(function(){if(!(!t.current||!f.length)){var T="";f.forEach(function(N,F){var J=N.id;if(J===x){var G;T=(G=f[F-1])===null||G===void 0?void 0:G.id}}),M(T)}},[x,f]);return{history:f,currentId:x,renderNewCanvas:M,handleRedo:S,handleUndo:A,updateCanvasState:C}},Qe=(0,g.forwardRef)(function(d,e){var t,r,n=(0,g.useContext)(I),o=n.lang,a=o===void 0?y.en:o,l=gr(),v=l.history,f=l.currentId,u=l.renderNewCanvas,h=l.handleRedo,p=l.handleUndo,x=l.updateCanvasState;return(0,g.useImperativeHandle)(e,function(){return{updateCanvasState:x}}),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-history",{"tie-image-editor_tool-item--disabled":!v.length}),children:(0,i.jsx)(H,{content:(0,i.jsxs)("div",{className:"tie-image-editor-history_pop",children:[!!v.length&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"tie-image-editor-history_pop-title",children:[ue.title[a],(0,i.jsxs)("span",{className:"tie-image-editor-history_pop-len",children:["\uFF08",v.length,"\uFF09"]})]}),(0,i.jsxs)("div",{onClick:function(){return u("")},className:z()("tie-image-editor-history_pop-item",{"tie-image-editor-history_pop-item--checked":!f}),children:[(0,i.jsx)("span",{className:"tie-image-editor-history_pop-item-num",children:"1."}),ue.init[a],!f&&(0,i.jsx)("i",{className:"tie-image-editor-history_pop-item-icon"})]})]}),!v.length&&(0,i.jsx)("span",{children:ue.placeholder[a]}),v.map(function(R,C){var s=R.action,m=s===void 0?"":s,M=R.id,S=R.type;return(0,i.jsxs)("div",{onClick:function(){return u(M)},className:z()("tie-image-editor-history_pop-item",{"tie-image-editor-history_pop-item--checked":M===f}),children:[(0,i.jsxs)("span",{className:"tie-image-editor-history_pop-item-num",children:[C+2,"."]}),!!ue[m]&&ue[m][a]," ",!!K[S]&&K[S][a],M===f&&(0,i.jsx)("i",{className:"tie-image-editor-history_pop-item-icon"})]},M)})]}),placement:"bottom",className:"tie-image-editor-history_target",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon")})})}),(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-redo",{"tie-image-editor_tool-item--disabled":!v.length||f===((t=v[v.length-1])===null||t===void 0?void 0:t.id)}),children:(0,i.jsx)(H,{content:K.redo[a],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:!v.length||f===((r=v[v.length-1])===null||r===void 0?void 0:r.id)?void 0:h})})}),(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-undo",{"tie-image-editor_tool-item--disabled":!v.length||!f}),children:(0,i.jsx)(H,{content:K.undo[a],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:!v.length||!f?void 0:p})})})]})});Qe.displayName="History";var mr=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.onChange,a=function(v){o&&o(v)};return(0,i.jsx)(H,{content:(0,i.jsx)("div",{className:"tie-image-editor_tool-crop-pop",children:(0,i.jsx)("div",{className:"tie-image-editor_tool-paint-size-wrapper",children:X.mosaicSizes.map(function(l,v){return(0,i.jsx)("div",{onClick:function(){return a(l)},className:"tie-image-editor_tool-paint-size",style:{width:10+v*5,height:10+v*5}},l)})})}),placement:"bottom",open:n,children:(0,i.jsx)("div",{children:t})})},pr=mr,fe=X.mosaicSizes[0],Cr=function(e){var t=e.data,r=e.height,n=e.width,o,a,l,v,f,u,h,p,x,R,C;for(a=0;a<r;a+=fe)for(l=0;l<n;l+=fe)for(o=a*4*n+l*4,v=t[o],f=t[o+1],u=t[o+2],h=t[o+3],R=Math.min(a+fe,r),C=Math.min(l+fe,n),p=a;p<R;p++)for(x=l;x<C;x++)o=p*4*n+x*4,t[o]=v,t[o+1]=f,t[o+2]=u,t[o+3]=h},xr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.currentMenu,o=e.currentMenuRef,a=e.setCurrentMenu,l=(0,g.useRef)(null),v=(0,g.useCallback)(function(){var h=t.current;h&&(l.current=new P.fabric.PatternBrush(h),l.current.getPatternSrc=function(){var p={left:0,top:0,width:h.width,height:h.height},x=h.toCanvasElement(1,p),R=x.getContext("2d"),C=R.getImageData(0,0,x.width,x.height);Cr(C),R.putImageData(C,0,0);var s=P.fabric.document.createElement("canvas"),m=s.getContext("2d");return s.width=h.width||0,s.height=h.height||0,m.drawImage(x,0,0,x.width,x.height,p.left,p.top,p.width,p.height),s})},[]);(0,g.useEffect)(function(){r&&v()},[r]);var f=(0,g.useCallback)(function(){var h=t.current;if(h){if(o.current!==c.mosaic){h.isDrawingMode=!0,h.freeDrawingBrush=l.current;var p=h.freeDrawingBrush;p.getPatternSrc&&(p.source=p.getPatternSrc.call(p)),p.width=30,p.shadow=new P.fabric.Shadow({blur:0,offsetX:0,offsetY:0,affectStroke:!0})}else h.isDrawingMode=!1;a(o.current===c.mosaic?c.default:c.mosaic)}},[v]),u=function(p){var x=t.current;if(x){fe=p;var R=x.freeDrawingBrush;R.getPatternSrc&&(R.source=R.getPatternSrc.call(R))}};return{currentMenu:n,handleMosaicTrigger:f,handleSizeChange:u}},Rr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=xr(),o=n.currentMenu,a=n.handleMosaicTrigger,l=n.handleSizeChange;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-mosaic",w()({},"tie-image-editor_tool-item--checked",o===c.mosaic)),children:(0,i.jsx)(pr,{open:o===c.mosaic,onChange:l,children:(0,i.jsx)(H,{content:K.mosaic[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:a})})})})})},wr=Rr,Mr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.canvasIsRender,o=e.currentMenu,a=e.historyRef,l=e.setCurrentMenu,v=(0,g.useRef)(!1),f=(0,g.useRef)({x:9,y:0}),u=(0,g.useRef)(null),h=(0,g.useRef)({color:X.colors[0],size:X.sizes[0]}),p=function(){var s=t.current;s&&(s.on("mouse:down",function(m){if(s.getActiveObject()||r.current!==c.rect)return!1;v.current=!0;var M=s.getPointer(m.e);f.current.x=M.x,f.current.y=M.y,u.current=new P.fabric.Rect({left:f.current.x,top:f.current.y,originX:"left",originY:"top",width:M.x-f.current.x,height:M.y-f.current.y,angle:0,fill:"rgba(255,0,0,0)",stroke:h.current.color,strokeWidth:h.current.size,transparentCorners:!1}),s.add(u.current)}),s.on("mouse:move",function(m){if(!s.getActiveObject()&&r.current===c.rect&&s.setCursor(le.crosshair),!v.current||!u.current||r.current!==c.rect){s.renderAll();return}var M=s.getPointer(m.e);f.current.x>M.x&&u.current.set({left:Math.abs(M.x)}),f.current.y>M.y&&u.current.set({top:Math.abs(M.y)}),u.current.set({width:Math.abs(f.current.x-M.x)}),u.current.set({height:Math.abs(f.current.y-M.y)}),s.setCursor(le.crosshair),s.renderAll()}),s.on("mouse:up",function(m){if(!(!u.current||r.current!==c.rect)){var M=s.getPointer(m.e);M.x===u.current.left&&M.y===u.current.top?(s.remove(u.current),s.requestRenderAll(),a.current.updateCanvasState(U.add,!0,!1)):(s.setActiveObject(u.current),a.current.updateCanvasState(U.add,!0,!0)),v.current=!1,u.current=null}}))};(0,g.useEffect)(function(){t.current&&n&&p()},[t,n]);var x=function(){var s=r.current===c.rect?c.default:c.rect;console.log("currentMenuRef.current",s,r.current),l(s)},R=function(s,m){if(t.current){var M=t.current,S=M.getActiveObjects()[0];s===se.color?(h.current.color=m,S&&S.set("stroke",m)):(h.current.size=m,S&&S.set("strokeWidth",m)),M.renderAll()}};return{handleDrawRect:x,handlePaintChange:R,currentMenu:o}},yr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=Mr(),o=n.handleDrawRect,a=n.handlePaintChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-rect",w()({},"tie-image-editor_tool-item--checked",l===c.rect)),children:(0,i.jsx)(de,{open:l===c.rect,onChange:a,children:(0,i.jsx)(H,{content:K.rect[r],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:o})})})})})},_r=function(){var e=(0,g.useContext)(I),t=e.setCurrentMenu,r=e.currentMenuRef,n=e.canvasInstanceRef,o=e.historyRef,a=function(){r.current!==c.reset&&t(c.reset);var v=n.current;if(v){v.getObjects().forEach(function(h){h!==v.backgroundImage&&v.remove(h)});var f=v.getCenter();v.zoomToPoint(new P.fabric.Point(f.left,f.top),1);var u=v.viewportTransform;u[4]=0,u[5]=0,v.setViewportTransform(u),v.renderAll(),o.current.updateCanvasState(U.add)}};return{handleReset:a}},jr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=_r(),o=n.handleReset;return(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-reset",children:(0,i.jsx)(H,{content:K.reset[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})},Tr=b(15560),Kr=b(39843),Sr=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.onChange,a=(0,g.useState)(X.rotates[0]),l=ae()(a,2),v=l[0],f=l[1],u=function(p){f(+p),o&&o(+p)};return(0,i.jsx)(H,{content:(0,i.jsx)("div",{className:"tie-image-editor_tool-rotate-pop-content",children:(0,i.jsx)(Tr.Z,{min:X.rotates[0],max:X.rotates[X.rotates.length-1],onChange:u,value:v,marks:X.rotates.reduce(function(h,p){return W()(W()({},h),{},w()({},p,p+"\xB0"))},{})})}),placement:"bottom-end",open:n,children:(0,i.jsx)("div",{children:t})})},kr=Sr,br=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.canvasIsRender,a=e.currentMenu,l=e.historyRef;(0,g.useEffect)(function(){var u=t.current},[o]);var v=function(){n(r.current!==c.rotate?c.rotate:c.default)},f=function(h){var p=t.current;if(p){p.getObjects().forEach(function(R){R.originalPoint=R.originalPoint||new P.fabric.Point(R.left,R.top);var C=P.fabric.util.rotatePoint(R.originalPoint,p.getVpCenter(),P.fabric.util.degreesToRadians(h));R.set({left:C.x,top:C.y,angle:h})});var x=p.backgroundImage;x.rotate(h),x.setCoords(),p.requestRenderAll(),l.current.updateCanvasState(U.add)}};return{handleRotateTrigger:v,handleRotateChange:f,currentMenu:a}},Er=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=br(),o=n.handleRotateTrigger,a=n.handleRotateChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-rotate",w()({},"tie-image-editor_tool-item--checked",l===c.rotate)),children:(0,i.jsx)(kr,{open:l===c.rotate,onChange:a,children:(0,i.jsx)(H,{content:K.rotate[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})})})},Ir=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.zoom,a=o===void 0?1:o,l=e.resetText,v=l===void 0?"":l,f=e.onScaleUp,u=e.onScaleDown,h=e.onReset,p=e.onOpenChange;return(0,i.jsx)(H,{content:(0,i.jsxs)("div",{className:"tie-image-editor_tool-scale-pop-content",children:[(0,i.jsxs)("div",{className:"tie-image-editor_tool-scale-pop-zoom",children:[+(a*100).toFixed(0),"%"]}),(0,i.jsxs)("div",{className:"tie-image-editor_tool-scale-pop-icons",children:[(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-subtract",children:(0,i.jsx)("i",{className:"tie-image-editor_tool-scale-pop-icon tie-image-editor_icon",onClick:u})}),(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-add",children:(0,i.jsx)("i",{className:"tie-image-editor_tool-scale-pop-icon tie-image-editor_icon",onClick:f})})]}),(0,i.jsx)("button",{onClick:h,children:v})]}),placement:"bottom-end",open:n,showArrow:!1,trigger:"click",children:(0,i.jsx)("div",{children:t})})},Pr=Ir,Dr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.currentMenu,o=e.currentMenuRef,a=e.zoom,l=e.setZoom,v=e.setCurrentMenu;(0,g.useEffect)(function(){var R=t.current;R&&r&&R.on("mouse:wheel",function(C){var s=C.e.deltaY,m=R.getZoom();m*=Math.pow(.999,s),m>20&&(m=20),m<.01&&(m=.01),l(m),R.requestRenderAll(),C.e.preventDefault(),C.e.stopPropagation()})},[t,r]),(0,g.useEffect)(function(){var R=t.current;if(R){var C=R.getCenter();R.zoomToPoint(new P.fabric.Point(C.left,C.top),a<0?.01:a),o.current!==c.scale&&v(c.scale)}},[a]);var f=function(){if(t.current){var C=t.current,s=C.getZoom();s+=.05,l(s)}},u=function(){if(t.current){var C=t.current,s=C.getZoom();s-=.05,l(s)}},h=function(){v(o.current===c.scale?c.default:c.scale)},p=function(){l(1)},x=(0,g.useCallback)(function(R){v(R?c.scale:c.default)},[]);return{zoom:a,handleScaleUp:f,handleScaleDown:u,handleScaleTrigger:h,handleReset:p,handleOpenChange:x}},Nr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=e.currentMenu,o=Dr(),a=o.zoom,l=o.handleScaleDown,v=o.handleScaleUp,f=o.handleScaleTrigger,u=o.handleReset,h=o.handleOpenChange;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-zoomIn",w()({},"tie-image-editor_tool-item--checked",n===c.scale)),children:(0,i.jsx)(Pr,{open:n===c.scale,zoom:a,onScaleDown:l,onScaleUp:v,onReset:u,onOpenChange:h,resetText:K.reset[r],children:(0,i.jsx)(H,{content:K.scale[r],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:f})})})})})},Or=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.canvasIsRender,a=e.currentMenu,l=(0,g.useRef)({color:X.colors[0],size:X.fontSizes[0]}),v=(0,g.useRef)(!1),f=(0,g.useCallback)(function(x){var R=t.current;if(!(!R||x.target)){if(v.current){v.current=!1;return}if(!(R.getActiveObject()||r.current!==c.text)){var C=R.getPointer(x.e),s=new P.fabric.IText("\u8F93\u5165\u5185\u5BB9",{left:C.x,top:C.y,fontSize:l.current.size,id:Math.random()*4+"_"+Date.now(),fill:l.current.color});R.add(s),R.setActiveObject(s),v.current=!0,R.renderAll()}}},[]),u=function(){var R=t.current;R&&R.on("mouse:up",f)};(0,g.useEffect)(function(){var x=t.current;if(!(!x||!o))return u(),function(){x.off("mouse:up",f)}},[o]);var h=function(){n(r.current!==c.text?c.text:c.default)},p=function(R,C){if(t.current){var s=t.current,m=s.getActiveObjects()[0];R===se.color?(l.current.color=C,m&&m.set("fill",C)):(l.current.size=C,m&&m.set("fontSize",C)),s.renderAll()}};return{handleTextTrigger:h,handlePaintChange:p,currentMenu:a}},zr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=Or(),o=n.handleTextTrigger,a=n.handlePaintChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-text",w()({},"tie-image-editor_tool-item--checked",l===c.text)),children:(0,i.jsx)(de,{open:l===c.text,onChange:a,type:c.text,children:(0,i.jsx)(H,{content:K.text[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})})})},Ar=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasEl,n=e.currentMenuRef,o=e.historyRef,a=e.setCurrentMenu,l=e.initBackGroundImage,v=function(u){var h,p=t.current;if(!(!p||!r.current||!u.target.files.length||!((h=u.target.files[0])!==null&&h!==void 0&&(h=h.type)!==null&&h!==void 0&&h.includes("image")))){n.current!==c.upload&&a(c.upload);var x=new FileReader;x.onload=function(R){if(!(!R||!R.target)){var C=new Image;C.src=R.target.result,l(R.target.result,!0,function(){o.current.updateCanvasState(U.add)})}},x.readAsDataURL(u.target.files[0])}};return{handleUpload:v}},Fr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?y.en:t,n=Ar(),o=n.handleUpload;return(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-upload",children:(0,i.jsx)(H,{content:K.upload[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",children:(0,i.jsx)("input",{onChange:o,type:"file",className:"tie-image-editor_tool-upload-input",accept:"image/*"})})})})},Lr=function(e){var t=e.url,r=(0,g.useRef)(null),n=(0,g.useRef)(),o=(0,g.useRef)(),a=(0,g.useRef)(null),l=(0,g.useState)(!1),v=ae()(l,2),f=v[0],u=v[1],h=(0,g.useState)(c.default),p=ae()(h,2),x=p[0],R=p[1],C=(0,g.useRef)(c.default),s=(0,g.useRef)("{}"),m=(0,g.useRef)(!1),M=(0,g.useRef)({updateCanvasState:function(){}}),S=(0,g.useRef)({downLoad:function(){return Promise.resolve({})}}),A=(0,g.useState)(1),T=ae()(A,2),N=T[0],F=T[1],J=function(k){console.log("setCurrentMenu",k),R(k),C.current=k;var O=o.current;O&&([c.draw,c.mosaic].includes(k)||(O.isDrawingMode=!1),[c.rect,c.circle,c.arrow].includes(k)?O.setCursor(le.crosshair):[c.rect,c.circle,c.arrow].includes(C.current)&&O.setCursor(le.default),O.renderAll())},G=function(){if(a.current&&r.current)try{var k=a.current.getBoundingClientRect(),O=k.width,E=k.height,D=new P.fabric.Canvas(r.current,{containerClass:"tie-image-editor_canvas",width:O,height:E});o.current=D,u(!0);try{s.current=JSON.stringify(D.toJSON(Be))}catch(B){console.error("initCanvasJson \u521D\u59CB\u5316\u5931\u8D25")}}catch(B){console.error(B)}},_=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,E=arguments.length>2?arguments[2]:void 0,D=o.current;if(k.trim()&&D&&a.current){var B=a.current.getBoundingClientRect(),Z=B.height;n.current=P.fabric.Image.fromURL(k,function($){var re=D.getCenter(),q=$.height;if($.scale(Z/q),$.set({left:re.left-$.width*(Z/q)/2,top:re.top-$.height*(Z/q)/2}),$.selectable=!1,$.id=Le,D.setBackgroundImage($,D.renderAll.bind(D)),O){E&&E();return}try{s.current=JSON.stringify(D.toJSON(Be))}catch(Y){console.error("initCanvasJson \u521D\u59CB\u5316\u5931\u8D25")}E&&E()},{crossOrigin:"anonymous"})}};return(0,g.useEffect)(function(){G()},[r,a]),(0,g.useEffect)(function(){_(t)},[t,o,a]),{canvasEl:r,imageInstanceRef:n,canvasInstanceRef:o,wrapperInstanceRef:a,currentMenu:x,setCurrentMenu:J,currentMenuRef:C,canvasIsRender:f,initCanvasJson:s,unSaveHistory:m,historyRef:M,initBackGroundImage:_,downloadRef:S,zoom:N,setZoom:F}},qe=(0,g.forwardRef)(function(d,e){var t=d.url,r=t===void 0?at:t,n=d.style,o=d.menus,a=o===void 0?it:o,l=d.onDownLoad,v=d.lang,f=v===void 0?y.en:v,u=Lr({url:r}),h=u.canvasEl,p=u.canvasInstanceRef,x=u.wrapperInstanceRef,R=u.currentMenu,C=u.setCurrentMenu,s=u.currentMenuRef,m=u.canvasIsRender,M=u.initCanvasJson,S=u.unSaveHistory,A=u.historyRef,T=u.initBackGroundImage,N=u.downloadRef,F=u.zoom,J=u.setZoom;return(0,g.useImperativeHandle)(e,function(){return{downloadRef:N}},[]),(0,i.jsx)(I.Provider,{value:{canvasInstanceRef:p,wrapperInstanceRef:x,currentMenuRef:s,currentMenu:R,setCurrentMenu:C,canvasIsRender:m,canvasEl:h,url:r,onDownLoad:l,initCanvasJson:M,unSaveHistory:S,historyRef:A,initBackGroundImage:T,zoom:F,setZoom:J,lang:f},children:(0,i.jsxs)("div",{className:"tie-image-editor",style:n,children:[(0,i.jsx)(Bt,{}),(0,i.jsxs)("div",{className:"tie-image-editor_tool clearfix",children:[(!a.length||a.includes(c.rect))&&(0,i.jsx)(yr,{}),(!a.length||a.includes(c.circle))&&(0,i.jsx)(Lt,{}),(!a.length||a.includes(c.arrow))&&(0,i.jsx)(At,{}),(!a.length||a.includes(c.draw))&&(0,i.jsx)(ur,{}),(!a.length||a.includes(c.text))&&(0,i.jsx)(zr,{}),(!a.length||a.includes(c.mosaic))&&(0,i.jsx)(wr,{}),(!a.length||a.includes(c.crop))&&(0,i.jsx)(ir,{}),(!a.length||a.includes(c.download))&&(0,i.jsx)(Ze,{ref:N}),(!a.length||a.includes(c.upload))&&(0,i.jsx)(Fr,{}),(!a.length||a.includes(c.drag))&&(0,i.jsx)(cr,{}),(!a.length||a.includes(c.reset))&&(0,i.jsx)(jr,{}),(!a.length||a.includes(c.rotate))&&(0,i.jsx)(Er,{}),(!a.length||a.includes(c.flip))&&(0,i.jsx)(hr,{}),(!a.length||a.includes(c.scale))&&(0,i.jsx)(Nr,{}),(!a.length||a.includes(c.history))&&(0,i.jsx)(Qe,{ref:A})]}),(0,i.jsx)("div",{ref:x,className:"tie-image-editor_modal__wrapper",children:(0,i.jsx)("canvas",{ref:h})})]})})});qe.displayName="Editor";var Hr=b.p+"static/basic.1cfbd9e1.jpg",Wr=function(){return(0,i.jsx)("div",{children:(0,i.jsx)(qe,{url:Hr})})},Br=Wr},24960:function(){},26759:function(){},56272:function(){}}]);
