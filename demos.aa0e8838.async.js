(self.webpackChunktiny_image_editor=self.webpackChunktiny_image_editor||[]).push([[433],{72511:function(Hr,Le,b){"use strict";b.r(Le),b.d(Le,{default:function(){return zr}});var g=b(67294),Ke=b(38416),w=b.n(Ke),he,ge,me,pe,Ce,xe,Re,we,Me,ye,_e,je,Te,Se,ke,be,Ee,J,le,se={OBJECT_ACTIVATED:"objectActivated",OBJECT_MOVED:"objectMoved",OBJECT_SCALED:"objectScaled",OBJECT_CREATED:"objectCreated",TEXT_EDITING:"textEditing",TEXT_CHANGED:"textChanged",ICON_CREATE_RESIZE:"iconCreateResize",ICON_CREATE_END:"iconCreateEnd",ADD_TEXT:"addText",ADD_OBJECT:"addObject",ADD_OBJECT_AFTER:"addObjectAfter",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove",REDO_STACK_CHANGED:"redoStackChanged",UNDO_STACK_CHANGED:"undoStackChanged",SELECTION_CLEARED:"selectionCleared",SELECTION_CREATED:"selectionCreated"},c=function(d){return d.crop="crop",d.history="history",d.download="download",d.draw="draw",d.flip="flip",d.reset="reset",d.rotate="rotate",d.rect="rect",d.circle="circle",d.text="text",d.upload="upload",d.drag="drag",d.scale="scale",d.arrow="arrow",d.mosaic="mosaic",d.undo="undo",d.redo="redo",d.default="",d}({}),_=function(d){return d.zh="zh",d.en="en",d}({}),V=(J={},w()(J,c.crop,(he={},w()(he,_.zh,"\u88C1\u526A"),w()(he,_.en,c.crop),he)),w()(J,c.history,(ge={},w()(ge,_.zh,"\u5386\u53F2\u8BB0\u5F55"),w()(ge,_.en,c.history),ge)),w()(J,c.download,(me={},w()(me,_.zh,"\u4E0B\u8F7D"),w()(me,_.en,c.download),me)),w()(J,c.draw,(pe={},w()(pe,_.zh,"\u753B\u7B14"),w()(pe,_.en,c.draw),pe)),w()(J,c.flip,(Ce={},w()(Ce,_.zh,"\u7FFB\u8F6C"),w()(Ce,_.en,c.flip),Ce)),w()(J,c.reset,(xe={},w()(xe,_.zh,"\u91CD\u7F6E"),w()(xe,_.en,c.reset),xe)),w()(J,c.rotate,(Re={},w()(Re,_.zh,"\u65CB\u8F6C"),w()(Re,_.en,c.rotate),Re)),w()(J,c.rect,(we={},w()(we,_.zh,"\u77E9\u5F62"),w()(we,_.en,c.rect),we)),w()(J,c.circle,(Me={},w()(Me,_.zh,"\u5706\u5F62"),w()(Me,_.en,c.circle),Me)),w()(J,c.text,(ye={},w()(ye,_.zh,"\u6587\u672C"),w()(ye,_.en,c.text),ye)),w()(J,c.upload,(_e={},w()(_e,_.zh,"\u4E0A\u4F20"),w()(_e,_.en,c.upload),_e)),w()(J,c.drag,(je={},w()(je,_.zh,"\u62D6\u62FD"),w()(je,_.en,c.drag),je)),w()(J,c.scale,(Te={},w()(Te,_.zh,"\u7F29\u653E"),w()(Te,_.en,c.scale),Te)),w()(J,c.arrow,(Se={},w()(Se,_.zh,"\u7BAD\u5934"),w()(Se,_.en,c.arrow),Se)),w()(J,c.mosaic,(ke={},w()(ke,_.zh,"\u9A6C\u8D5B\u514B"),w()(ke,_.en,c.mosaic),ke)),w()(J,c.redo,(be={},w()(be,_.zh,"\u524D\u8FDB"),w()(be,_.en,c.redo),be)),w()(J,c.undo,(Ee={},w()(Ee,_.zh,"\u540E\u9000"),w()(Ee,_.en,c.undo),Ee)),J),ce=function(d){return d.default="default",d.crosshair="crosshair",d.pointer="pointer",d.move="move",d.grab="grab",d.grabbing="grabbing",d.zoomIn="zoom-in",d.zoomOut="zoom-out",d}({}),K=function(d){return d.add="add",d.modified="modified",d.delete="delete",d}({}),Ge=(le={},w()(le,K.add,"\u6DFB\u52A0"),w()(le,K.modified,"\u4FEE\u6539"),w()(le,K.delete,"\u5220\u9664"),le),Ie=function(d){return d.flipX="flipX",d.flipY="flipY",d}({}),Pe="workspace",oe=function(d){return d.size="size",d.color="color",d}({}),Y={sizes:[5,10,20],colors:["red","orange","yellow","green","blue","white"],fontSizes:[30,60,90],rotates:[0,45,90,135,180,225,270,315,360],mosaicSizes:[10,20,30]},De={Z:90,Y:89,SHIFT:16,BACKSPACE:8,DEL:46},He="tie_image_editor",Wr=8,Oe=["id","gradientAngle","selectable","hasControls","source","editable"],Ze=30,Qe="",qe=[],et=["onChange","loadData","onClick","onSelect","options","name","value","defaultValue","values","defaultValues","placeholder","large","small","iconRender","icon","activeIndex","swipeAble","fixedArrows","error","onVisibleChange"],I=g.createContext({canvasInstanceRef:{current:null},wrapperInstanceRef:{current:null},currentMenuRef:{current:c.default},currentMenu:c.default,setCurrentMenu:function(){},canvasIsRender:!1,canvasEl:{current:null},initCanvasJson:{current:null},unSaveHistory:{current:null},historyRef:{current:function(){}},initBackGroundImage:function(){},zoom:1,setZoom:function(){}}),tt=function(){return!!(window.File&&window.FileList&&window.FileReader)},rt=function(e){var t=/data:(image\/.+);base64,/,r="",n,o,a;n=e.replace(t,function(v,f){return r=f,""}),n=atob(n);var l=n.length;for(o=new Uint8Array(l),a=0;a<l;a+=1)o[a]=n.charCodeAt(a);return new Blob([o],{type:r})},te=function(e,t,r){if(t>r){var n=[r,t];t=n[0],r=n[1]}return Math.max(t,Math.min(e,r))},nt=function(e,t){var r=Object.assign({},e);return t.forEach(function(n){delete r[n]}),r};function at(d){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e=e.concat(et),nt(d,e)}var Br=function(){if(navigator){var e=navigator.userAgent,t=e.indexOf("Trident")>-1&&e.indexOf("rv:11.0")>-1;if(t)return 11;var r=navigator.appVersion.split(";")[1];if(!r)return;var n=r.replace(/[ ]/g,""),o=/MSIE(\d+)\./.exec(n);if(o)return parseInt(o[1])}},it=b(94184),z=b.n(it),ot=b(42122),W=b.n(ot),st=b(861),ct=b.n(st),lt=b(70215),ut=b.n(lt),dt=b(27424),ae=b.n(dt),ft=b(70614),vt=b(81385),ht=b(63351),gt=b(56690),mt=b.n(gt),pt=b(89728),Ct=b.n(pt),xt=b(66115),We=b.n(xt),Rt=b(61655),wt=b.n(Rt),Mt=b(26389),yt=b.n(Mt),_t=b(73935),jt=function(d){wt()(t,d);var e=yt()(t);function t(r){var n;return mt()(this,t),n=e.call(this,r),w()(We()(n),"container",null),n.container=null,n.getContainer=n.getContainer.bind(We()(n)),n}return Ct()(t,[{key:"componentDidMount",value:function(){var n=this;this.container=this.props.container||document.body,this.forceUpdate(function(){n.props.onRendered&&n.props.onRendered()})}},{key:"componentDidUpdate",value:function(n){n.container!==this.props.container&&(this.container=this.props.container||null)}},{key:"getContainer",value:function(){return this.container}},{key:"render",value:function(){var n=this.props.children;return this.container&&n?_t.createPortal(n,this.container):null}}]),t}(g.Component),i=b(85893),Tt=["className","style","children","trigger","visible","popoverClassName","popoverStyle","showArrow","content","placement","usePortal","portalContainer","positionFixed","modifiers","outlineColor","backgroundColor","scheduleUpdate","onOpenChange","maskClosable"],St=function(e){return(0,i.jsx)("div",{className:"popper__arrow",style:w()({},"border"+(((e==null?void 0:e.arrowPlacement[0])||"").toLocaleUpperCase()+(e.arrowPlacement||"").substring(1))+"Color",e.backgroundColor),children:e.children})},Be=function(e){var t=(0,g.useRef)(null),r=(0,g.useRef)(null),n=(0,g.useState)(e.open),o=ae()(n,2),a=o[0],l=o[1],v=e.className,f=e.style,u=e.children,h=e.trigger,p=e.visible,x=e.popoverClassName,R=e.popoverStyle,C=e.showArrow,s=e.content,m=e.placement,M=e.usePortal,S=e.portalContainer,A=e.positionFixed,T=e.modifiers,N=e.outlineColor,F=e.backgroundColor,X=e.scheduleUpdate,G=e.onOpenChange,y=e.maskClosable,j=y===void 0?!0:y,k=ut()(e,Tt),O=at(k,["popoverClassName","popoverStyle","showArrow","content","usePortal","positionFixed","outlineColor","backgroundColor","getPopoverRef","onOpenChange"]),E=function(L){G&&G(L),e.open!==void 0?l(e.open):l(L)},D=function(L){var ee,ie;!t||!r||(ee=t.current)!==null&&ee!==void 0&&ee.contains(L.target)||(ie=r.current)!==null&&ie!==void 0&&ie.contains(L.target)||j&&E(!1)},B=function(){var L=e.open,ee=e.onOpenChange;L!==void 0&&ee===void 0||h==="hover"&&E(!0)},Z=function(){var L=e.open,ee=e.onOpenChange;L!==void 0&&ee===void 0||h==="hover"&&E(!1)},U=function(L){if(L.nativeEvent.stopImmediatePropagation(),h==="click"){E(!a);return}h==="focus"&&E(!0)};(0,g.useEffect)(function(){e.getPopoverRef&&e.getPopoverRef(t)},[]),(0,g.useEffect)(function(){return(h==="click"||h==="focus")&&document.body.addEventListener("click",D,!1),function(){document.body.removeEventListener("click",D,!1)}},[j,e.open]),(0,g.useEffect)(function(){e.open!==void 0&&E(e.open)},[e.open]);var re=function(){var L=A?"fixed":"absolute",ee=[{name:"computeStyles",options:{gpuAcceleration:!1}},{name:"offset",options:{offset:[0,10]}}],ie=function(ne){if(ne)return ne.split("-")[0].toString().replace(/^\S/,function(Fe){return Fe.toUpperCase()})},Q=function(ne){if(ne==="content"&&N)return{borderColor:N};if(ne==="arrow"&&N)return w()({},"border".concat(ie(m),"Color"),N)},fe=function(){if(F)return{color:"#fff",background:F}},ve=m.split("-")[0],Je=a&&(0,i.jsx)(ft.r,{placement:m,modifiers:[].concat(ee,ct()(T||[])),strategy:L,children:function(ne){var Fe=ne.ref,Ar=ne.style,Fr=ne.placement,Ve=ne.arrowProps,Lr=ne.update;return(0,g.useEffect)(function(){a&&Lr()},[X]),(0,i.jsx)("div",{className:z()("tie-popover__popper",x,{"tie-popover__popper-background":F}),style:W()(W()(W()(W()({},Ar),R),Q("content")),fe()),ref:Fe,"x-placement":Fr,onMouseEnter:B,onMouseLeave:Z,children:(0,i.jsxs)("div",{ref:t,children:[a&&(0,i.jsx)("div",{className:"tie-popover__content",children:(0,i.jsx)("span",{children:s})}),C&&(0,i.jsx)(St,{arrowPlacement:ve,backgroundColor:F,children:(0,i.jsx)("div",{"data-popper-arrow":!0,className:"tie-popper__arrow popper__arrow","x-arrow":"true",style:W()(W()({},Ve.style),Q("arrow")),ref:Ve.ref})})]})})}});return M?(0,i.jsx)(jt,{container:S,children:Je}):Je},q=function(L){if(L.type.__BRICKS_BUTTON&&L.props.disabled){var ee=L.props.style&&L.props.style.display?L.props.style.display:"inline-block",ie=g.cloneElement(L,{style:W()(W()({},L.props.style),{},{pointerEvents:"none"})});return(0,i.jsx)("span",{style:{display:ee,cursor:"not-allowed"},children:ie})}return L};return(0,i.jsx)(i.Fragment,{children:p?(0,i.jsx)("div",W()(W()({className:z()("tie-popover",v)},O),{},{style:f,children:(0,i.jsxs)(vt.dK,{children:[(0,i.jsx)(ht.s,{children:function(L){var ee=L.ref;return(0,i.jsx)("div",{ref:r,className:"tie-popover__target",children:(0,i.jsx)("div",{ref:ee,children:g.Children.map(u,function(ie){var Q=ie;return Q=q(Q),h==="click"?g.cloneElement(Q,{onClick:function(ve){U(ve),Q.props.onClick&&Q.props.onClick()}}):h==="focus"?g.cloneElement(Q,{onFocus:function(ve){U(ve),Q.props.onFocus&&Q.props.onFocus()}}):h==="hover"?g.cloneElement(Q,{onMouseEnter:function(){B(),Q.props.onMouseEnter&&Q.props.onMouseEnter()},onMouseLeave:function(){Z(),Q.props.onMouseLeave&&Q.props.onMouseLeave()}}):Q})})})}}),re()]})})):u})};Be.defaultProps={visible:!0,trigger:"hover",placement:"bottom",showArrow:!0,usePortal:!0,modifiers:[]};var H=Be,kt=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.type,a=e.onChange,l=function(f,u){a&&a(f,u)};return(0,i.jsx)(H,{content:(0,i.jsxs)("div",{className:"tie-image-editor_tool-paint-content",children:[(0,i.jsx)("div",{className:"tie-image-editor_tool-paint-size-wrapper",children:(o===c.text?Y.fontSizes:Y.sizes).map(function(v,f){return(0,i.jsx)("div",{onClick:function(){return l(oe.size,v)},className:"tie-image-editor_tool-paint-size",style:{width:10+f*5,height:10+f*5}},v)})}),(0,i.jsx)("div",{className:"tie-image-editor_tool-paint-color-wrapper",children:Y.colors.map(function(v){return(0,i.jsx)("div",{onClick:function(){return l(oe.color,v)},className:"tie-image-editor_tool-paint-color",style:{background:v}},v)})})]}),placement:"bottom",open:n,children:(0,i.jsx)("div",{children:t})})},ue=kt,P=b(32777),Ue=P.fabric.util.createClass(P.fabric.Line,{type:"arrow",superType:"drawing",initialize:function(e,t){if(!e){var r=t,n=r.x1,o=r.x2,a=r.y1,l=r.y2;e=[n,a,o,l]}t=t||{},this.callSuper("initialize",e,t)},_render:function(e){this.callSuper("_render",e),e.save();var t=this.x2-this.x1,r=this.y2-this.y1,n=Math.atan2(r,t);e.translate((this.x2-this.x1)/2,(this.y2-this.y1)/2),e.rotate(n),e.beginPath(),e.moveTo(this.strokeWidth*2,0),e.lineTo(-this.strokeWidth*2,this.strokeWidth*2),e.lineTo(-this.strokeWidth*2,-this.strokeWidth*2),e.closePath(),e.fillStyle=this.stroke,e.fill(),e.restore()}});Ue.fromObject=function(d,e){var t=d.x1,r=d.x2,n=d.y1,o=d.y2;return e(new P.fabric.Arrow([t,n,r,o],d))};var bt=Ue,Et=function(){var e=(0,g.useContext)(I),t=e.currentMenu,r=e.setCurrentMenu,n=e.canvasInstanceRef,o=e.canvasIsRender,a=e.currentMenuRef,l=e.historyRef,v=(0,g.useRef)(!1),f=(0,g.useRef)({x:0,y:0}),u=(0,g.useRef)([]),h=(0,g.useRef)(null),p=(0,g.useRef)({color:Y.colors[0],size:Y.sizes[0]}),x=function(){var m=n.current;m&&(m.on("mouse:down",function(M){if(!(m.getActiveObject()||a.current!==c.arrow)){m.discardActiveObject(),m.getObjects().forEach(function(A){A.selectable=!1,A.hasControls=!1}),m.requestRenderAll(),v.current=!0,f.current=m.getPointer(M.e),u.current=[f.current.x,f.current.y,f.current.x,f.current.y];var S=new bt(u.current,{strokeWidth:p.current.size,stroke:p.current.color,id:new Date().valueOf()+"_"+Math.random()*4});S.strokeUniform=!0,h.current=S,m.add(S)}}),m.on("mouse:move",function(M){if(!m.getActiveObject()&&a.current===c.rect&&m.setCursor(ce.crosshair),m.getActiveObject()||a.current!==c.arrow||!v.current||!h.current){m.renderAll();return}if(f.current=m.getPointer(M.e),M.e.shiftKey){var S=u.current[0],A=u.current[1],T=f.current.x-S,N=f.current.y-A,F=Math.sqrt(T*T+N*N),X=Math.atan2(N,T)/Math.PI*180;X=parseInt(""+(X+7.5)%360/15)*15;var G=F*Math.cos(X*Math.PI/180),y=F*Math.sin(X*Math.PI/180);h.current.set({x2:G+S,y2:y+A})}else{if(!h.current)return;h.current.set({x2:f.current.x,y2:f.current.y})}m.renderAll()}),m.on("mouse:up",function(){a.current!==c.arrow||!h.current||!v.current||(h.current.setCoords(),v.current=!1,f.current.x===u.current[0]&&f.current.y===u.current[1]?(m.remove(h.current),m.requestRenderAll(),l.current.updateCanvasState(K.add,!0,!1)):(m.setActiveObject(h.current),l.current.updateCanvasState(K.add,!0,!0)))}))};(0,g.useEffect)(function(){n.current&&o&&x()},[n,o]);var R=function(){r(t===c.arrow?c.default:c.arrow)},C=function(m,M){if(n.current){var S=n.current,A=S.getActiveObjects()[0];m===oe.color?(p.current.color=M,A&&A.set("stroke",M)):(p.current.size=M,A&&A.set("strokeWidth",M)),S.renderAll()}};return{handleArrowTrigger:R,handlePaintChange:C,currentMenu:t}},It=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=Et(),o=n.handleArrowTrigger,a=n.handlePaintChange,l=n.currentMenu;return(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-arrow",w()({},"tie-image-editor_tool-item--checked",l===c.arrow)),children:(0,i.jsx)(ue,{open:l===c.arrow,onChange:a,children:(0,i.jsx)(H,{content:V.arrow[r],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:o})})})})},Pt=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.canvasIsRender,a=e.currentMenu,l=e.historyRef,v=(0,g.useRef)(!1),f=(0,g.useRef)({x:9,y:0}),u=(0,g.useRef)(null),h=(0,g.useRef)({color:Y.colors[0],size:Y.sizes[0]}),p=function(){var s=t.current;s&&(s.on("mouse:down",function(m){if(!(s.getActiveObject()||r.current!==c.circle)){v.current=!0;var M=s.getPointer(m.e);f.current.x=M.x,f.current.y=M.y,u.current=new P.fabric.Circle({left:f.current.x,top:f.current.y,originX:"left",originY:"top",radius:M.x-f.current.x,angle:0,fill:"",stroke:h.current.color,strokeWidth:h.current.size}),s.add(u.current)}}),s.on("mouse:move",function(m){if(!s.getActiveObject()&&r.current===c.circle&&s.setCursor(ce.crosshair),!v.current||r.current!==c.circle){s.renderAll();return}var M=s.getPointer(m.e),S=Math.max(Math.abs(f.current.y-M.y),Math.abs(f.current.x-M.x))/2;S>u.current.strokeWidth&&(S-=u.current.strokeWidth/2),u.current.set({radius:S}),f.current.x>M.x?u.current.set({originX:"right"}):u.current.set({originX:"left"}),f.current.y>M.y?u.current.set({originY:"bottom"}):u.current.set({originY:"top"}),s.renderAll()}),s.on("mouse:up",function(m){if(!(!u.current||r.current!==c.circle)){var M=s.getPointer(m.e);M.x===u.current.left&&M.y===u.current.top?(s.remove(u.current),s.requestRenderAll(),l.current.updateCanvasState(K.add,!0,!1)):(s.setActiveObject(u.current),l.current.updateCanvasState(K.add,!0,!0)),v.current=!1,u.current=null}}))};(0,g.useEffect)(function(){var C=t.current;C&&o&&p()},[t,o]);var x=function(){n(r.current===c.circle?c.default:c.circle)},R=function(s,m){if(t.current){var M=t.current,S=M.getActiveObjects()[0];s===oe.color?(h.current.color=m,S&&S.set("stroke",m)):(h.current.size=m,S&&S.set("strokeWidth",m)),M.renderAll()}};return{handleDrawCircle:x,handlePaintChange:R,currentMenu:a}},Dt=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=Pt(),o=n.handleDrawCircle,a=n.handlePaintChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-circle",w()({},"tie-image-editor_tool-item--checked",l===c.circle)),children:(0,i.jsx)(ue,{open:l===c.circle,onChange:a,children:(0,i.jsx)(H,{content:V.circle[r],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:o})})})})})},Nt="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E",Ot=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.historyRef,o=function(){var l=document.createElement("img");l.src=Nt,P.fabric.Object.prototype.transparentCorners=!1,P.fabric.Object.prototype.cornerColor="blue",P.fabric.Object.prototype.cornerStyle="circle";function v(u,h){var p=h.target,x=p.canvas;return x.remove(p),x.requestRenderAll(),n.current.updateCanvasState(K.delete),!0}function f(u,h,p,x,R){var C=24;u.save(),u.translate(h,p),u.rotate(P.fabric.util.degreesToRadians(R.angle)),u.drawImage(l,-C/2,-C/2,C,C),u.restore()}P.fabric.Object.prototype.controls.deleteControl=new P.fabric.Control({x:.5,y:-.5,offsetY:16,cursorStyle:"pointer",mouseUpHandler:v,render:f})};(0,g.useEffect)(function(){t.current&&r&&o()},[t,r])},zt=function(){return Ot(),(0,i.jsx)(i.Fragment,{})},At="tl",Ft="tr",Lt="mt",Ht="ml",Wt="mr",Bt="mb",Ut="bl",$t="br",Yt=[At,Ft,Lt,Ht,Wt,Bt,Ut,$t],ze=function(){};function Xt(d){return Yt.indexOf(d)>=0}function Ne(d,e){return d>e?"width":"height"}var Jt=P.fabric.util.createClass(P.fabric.Rect,{initialize:function(e,t,r){t=W()(W()({},t),r),t.type="cropzone",this.callSuper("initialize",t),this._addEventHandler(),this.canvas=e,this.options=t},canvasEventDelegation:function(e){var t="unregistered",r=this.canvasEventTrigger[e]!==ze;return r?t="registered":[se.OBJECT_MOVED,se.OBJECT_SCALED].indexOf(e)<0&&(t="none"),t},canvasEventRegister:function(e,t){this.canvasEventTrigger[e]=t},_addEventHandler:function(){var e;this.canvasEventTrigger=(e={},w()(e,se.OBJECT_MOVED,ze),w()(e,se.OBJECT_SCALED,ze),e),this.on({moving:this._onMoving.bind(this),scaling:this._onScaling.bind(this)}),P.fabric.util.addListener(document,"keydown",this._onKeyDown.bind(this)),P.fabric.util.addListener(document,"keyup",this._onKeyUp.bind(this))},_renderCropzone:function(e){var t=7,r=7,n=this.flipX?-1:1,o=this.flipY?-1:1,a=n/this.scaleX,l=o/this.scaleY;e.scale(a,l),this._fillOuterRect(e,"rgba(0, 0, 0, 0.5)"),this.options.lineWidth?(this._fillInnerRect(e),this._strokeBorder(e,"rgb(255, 255, 255)",{lineWidth:this.options.lineWidth})):(this._strokeBorder(e,"rgb(0, 0, 0)",{lineDashWidth:t}),this._strokeBorder(e,"rgb(255, 255, 255)",{lineDashWidth:t,lineDashOffset:r})),e.scale(1/a,1/l)},_render:function(e){this.callSuper("_render",e),this._renderCropzone(e)},_fillOuterRect:function(e,t){var r=this._getCoordinates(),n=r.x,o=r.y;console.log("_fillOuterRect",n,o),e.save(),e.fillStyle=t,e.beginPath(),e.moveTo(n[1],o[1]),e.lineTo(n[1],o[2]),e.lineTo(n[2],o[2]),e.lineTo(n[2],o[1]),e.lineTo(n[1],o[1]),e.closePath(),e.fill(),e.restore()},_fillInnerRect:function(e){var t=this._getCoordinates(),r=t.x,n=t.y,o=this._caculateInnerPosition(r,(r[2]-r[1])/3),a=this._caculateInnerPosition(n,(n[2]-n[1])/3);e.save(),e.strokeStyle="rgba(255, 255, 255, 0.7)",e.lineWidth=this.options.lineWidth,e.beginPath(),e.moveTo(o[0],a[1]),e.lineTo(o[3],a[1]),e.moveTo(o[0],a[2]),e.lineTo(o[3],a[2]),e.moveTo(o[1],a[0]),e.lineTo(o[1],a[3]),e.moveTo(o[2],a[0]),e.lineTo(o[2],a[3]),e.stroke(),e.closePath(),e.restore()},_caculateInnerPosition:function(e,t){var r=[];return r[0]=e[1],r[1]=e[1]+t,r[2]=e[1]+t*2,r[3]=e[2],r},_getCoordinates:function(){var e=this.canvas,t=this.width,r=this.height,n=this.left,o=this.top,a=t/2,l=r/2,v=e.getHeight(),f=e.getWidth();return{x:[-(a+n),-a,a,a+(f-n-t)].map(Math.ceil),y:[-(l+o),-l,l,l+(v-o-r)].map(Math.ceil)}},_strokeBorder:function(e,t,r){var n=r.lineDashWidth,o=r.lineDashOffset,a=r.lineWidth,l=this.width/2,v=this.height/2;e.save(),e.strokeStyle=t,e.setLineDash&&e.setLineDash([n,n]),o&&(e.lineDashOffset=o),a&&(e.lineWidth=a),e.beginPath(),e.moveTo(-l,-v),e.lineTo(l,-v),e.lineTo(l,v),e.lineTo(-l,v),e.lineTo(-l,-v),e.stroke(),e.restore()},_onMoving:function(){var e=this.height,t=this.width,r=this.left,n=this.top,o=this.canvas.getWidth()-t,a=this.canvas.getHeight()-e;this.left=te(r,0,o),this.top=te(n,0,a),this.canvasEventTrigger[se.OBJECT_MOVED](this)},_onScaling:function(e){var t=e.transform.corner,r=this.canvas.getPointer(e.e),n=this._calcScalingSizeFromPointer(r,t);this.scale(1).set(n),this.canvasEventTrigger[se.OBJECT_SCALED](this)},_calcScalingSizeFromPointer:function(e,t){var r=Xt(t);return r&&this._resizeCropZone(e,t)},adjustRatioCropzoneSize:function(e){var t=e.width,r=e.height,n=e.leftMaker,o=e.topMaker,a=e.maxWidth,l=e.maxHeight,v=e.scaleTo;if(t=a?te(t,1,a):t,r=l?te(r,1,l):r,!this.presetRatio)return this._withShiftKey&&(t>r?r=t:r>t&&(t=r)),{width:t,height:r,left:n(t),top:o(r)};v==="width"?r=t/this.presetRatio:t=r*this.presetRatio;var f=Math.min(a/t,l/r);if(f<=1){var u=[t,r].map(function(p){return p*f}),h=ae()(u,2);t=h[0],r=h[1]}return{width:t,height:r,left:n(t),top:o(r)}},_getCropzoneRectInfo:function(){var e=this.canvas,t=e.width,r=e.height,n=this.getBoundingRect(!1,!0),o=n.top,a=n.left,l=n.width,v=n.height;return{rectTop:o,rectLeft:a,rectWidth:l,rectHeight:v,rectRight:a+l,rectBottom:o+v,canvasWidth:t,canvasHeight:r}},_resizeCropZone:function(e,t){var r=e.x,n=e.y,o=this._getCropzoneRectInfo(),a=o.rectWidth,l=o.rectHeight,v=o.rectTop,f=o.rectLeft,u=o.rectBottom,h=o.rectRight,p=o.canvasWidth,x=o.canvasHeight,R={tl:{width:h-r,height:u-n,leftMaker:function(s){return h-s},topMaker:function(s){return u-s},maxWidth:h,maxHeight:u,scaleTo:Ne(f-r,v-n)},tr:{width:r-f,height:u-n,leftMaker:function(){return f},topMaker:function(s){return u-s},maxWidth:p-f,maxHeight:u,scaleTo:Ne(r-h,v-n)},mt:{width:a,height:u-n,leftMaker:function(){return f},topMaker:function(s){return u-s},maxWidth:p-f,maxHeight:u,scaleTo:"height"},ml:{width:h-r,height:l,leftMaker:function(s){return h-s},topMaker:function(){return v},maxWidth:h,maxHeight:x-v,scaleTo:"width"},mr:{width:r-f,height:l,leftMaker:function(){return f},topMaker:function(){return v},maxWidth:p-f,maxHeight:x-v,scaleTo:"width"},mb:{width:a,height:n-v,leftMaker:function(){return f},topMaker:function(){return v},maxWidth:p-f,maxHeight:x-v,scaleTo:"height"},bl:{width:h-r,height:n-v,leftMaker:function(s){return h-s},topMaker:function(){return v},maxWidth:h,maxHeight:x-v,scaleTo:Ne(f-r,n-u)},br:{width:r-f,height:n-v,leftMaker:function(){return f},topMaker:function(){return v},maxWidth:p-f,maxHeight:x-v,scaleTo:Ne(r-h,n-u)}};return this.adjustRatioCropzoneSize(R[t])},isValid:function(){return this.left>=0&&this.top>=0&&this.width>0&&this.height>0},_onKeyDown:function(e){var t=e.keyCode;t===De.SHIFT&&(this._withShiftKey=!0)},_onKeyUp:function(e){var t=e.keyCode;t===De.SHIFT&&(this._withShiftKey=!1)}}),Vt=Jt,Kt=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.onChange,a=function(v){o&&o(v)};return(0,i.jsx)(H,{content:(0,i.jsxs)("div",{className:"tie-image-editor_tool-crop-pop",children:[(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-done",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:function(){return a(!0)}})}),(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-clear",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:function(){return a(!1)}})})]}),placement:"bottom",open:n,children:(0,i.jsx)("div",{children:t})})},Gt=Kt,Zt=10,Qt=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.canvasIsRender,a=e.currentMenu,l=e.wrapperInstanceRef,v=e.historyRef,f=e.unSaveHistory,u=(0,g.useRef)(null),h=(0,g.useRef)(0),p=(0,g.useRef)(0),x=(0,g.useRef)(!1),R=(0,g.useCallback)(function(y,j){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,O=t.current;if(O){var E=O.getWidth(),D=O.getHeight(),B=h.current,Z=p.current,U=te(y,0,B),re=te(j,0,Z),q=te(y,B,E)-U,$=te(j,Z,D)-re;return x.current&&!k?(q>$?$=q:$>q&&(q=$),B>=y&&(U=B-q),Z>=j&&(re=Z-$)):k&&($=q/k,B>=y&&(U=te(B-q,0,E)),Z>=j&&(re=te(Z-$,0,D)),re+$>D&&($=D-re,q=$*k,B>=y&&(U=te(B-q,0,E)),Z>=j&&(re=te(Z-$,0,D)))),{left:U,top:re,width:q,height:$}}},[]),C=(0,g.useCallback)(function(y){r.current===c.crop&&y.keyCode===De.SHIFT&&(x.current=!0)},[]),s=(0,g.useCallback)(function(y){r.current===c.crop&&y.keyCode===De.SHIFT&&(x.current=!1)},[]),m=(0,g.useCallback)(function(y){var j=t.current;if(j&&r.current===c.crop){var k=j.getPointer(y.e),O=k.x,E=k.y,D=u.current;D&&Math.abs(O-h.current)+Math.abs(E-p.current)>Zt&&(j.remove(D),D.set(R(O,E,D.presetRatio)),j.add(D),j.setActiveObject(D))}},[o]),M=(0,g.useCallback)(function(){var y=t.current;if(y&&r.current===c.crop){var j=u.current;y.setActiveObject(j),y.off("mouse:move",m),y.off("mouse:up",M)}},[o]),S=(0,g.useCallback)(function(y){if(!y.target){var j=t.current;if(j&&r.current===c.crop){j.selection=!1;var k=j.getPointer(y.e);h.current=k.x,p.current=k.y,j.on("mouse:move",m),j.on("mouse:up",M)}}},[o]),A=(0,g.useCallback)(function(){var y=t.current;!y||!o||u.current||(f.current=!0,y.getObjects().forEach(function(j){j.evented=!1}),u.current=new Vt(t.current,{left:0,top:0,width:.5,height:.5,strokeWidth:0,cornerSize:16,cornerColor:"blue",fill:"transparent",hasRotatingPoint:!1,hasBorders:!1,lockScalingFlip:!0,lockRotation:!0,lockSkewingX:!0,lockSkewingY:!0,cornerStyle:"circle",cornerStrokeColor:"blue",transparentCorners:!1,lineWidth:2,borderColor:"blue"}),y.discardActiveObject(),y.add(u.current),y.on("mouse:down",S),y.selection=!1,y.defaultCursor="crosshair",P.fabric.util.addListener(document,"keydown",C),P.fabric.util.addListener(document,"keyup",s))},[o]),T=(0,g.useCallback)(function(){var y=t.current;if(y){var j=u.current;j&&(y.remove(j),y.selection=!0,y.defaultCursor="default",y.off("mouse:down",S),y.off("mouse:move",m),y.off("mouse:up",M),y.forEachObject(function(k){k.evented=!0}),u.current=null,P.fabric.util.removeListener(document,"keydown",C),P.fabric.util.removeListener(document,"keyup",s),f.current=!1)}},[o]),N=function(){r.current!==c.crop?A():T(),n(r.current!==c.crop?c.crop:c.default)},F=function(){var j=u.current;return!j||!j.isValid()?null:{left:j.left,top:j.top,width:j.width,height:j.height}},X=function(){var j=t.current;if(j){var k=j.contains(u.current),O=F();if(!O)return null;k&&j.remove(u.current);var E={imageName:He,url:j.toDataURL(O)};return k&&j.add(u.current),E}},G=function(j){var k=t.current;if(k)if(!j)T(),A();else{var O=X();if(!O||!O.url.includes("base64"))return;k.clear(),k.setBackgroundImage(O.url,function(){var E=k.backgroundImage,D=l.current.getBoundingClientRect(),B=D.height,Z=k.getCenter(),U=E.height;E.scale(B/U),E.set({left:Z.left-E.width*(B/U)/2,top:Z.top-E.height*(B/U)/2}),E.selectable=!1,E.id=Pe,k.renderAll(),T(),v.current.updateCanvasState(K.add),A()})}};return(0,g.useEffect)(function(){a!==c.crop&&u.current&&T()},[a]),{handleCropTrigger:N,handleCropChange:G,currentMenu:a}},qt=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=Qt(),o=n.handleCropTrigger,a=n.handleCropChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-crop",w()({},"tie-image-editor_tool-item--checked",l===c.crop)),children:(0,i.jsx)(Gt,{open:l===c.crop,onChange:a,children:(0,i.jsx)(H,{content:V.crop[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})})})},er=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasEl,n=e.onDownLoad,o=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;console.log("heheh");var v=t.current;if(!v||!r.current)return Promise.reject();var f=v.toDataURL(),u=Date.now()+He,h,p;if(n)return n({downLoadUrl:f}),Promise.resolve({downLoadUrl:f});if(!l)return Promise.resolve({downLoadUrl:f});if(tt()&&window.saveAs)h=rt(f),p=h.type.split("/")[1],u.split(".").pop()!==p&&(u+=".".concat(p)),window.saveAs(h,u);else{u.split(".").pop()!==p&&(u+=".png");var x=document.createElement("a");x.href=f,x.download=u,document.body.appendChild(x),x.click(),x.remove()}return Promise.resolve({downLoadUrl:f})};return{handleDownload:o}},$e=(0,g.forwardRef)(function(d,e){var t=(0,g.useContext)(I),r=t.lang,n=r===void 0?_.en:r,o=er(),a=o.handleDownload;return(0,g.useImperativeHandle)(e,function(){return{download:a}},[a]),(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-download",children:(0,i.jsx)(H,{content:V.download[n],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:function(){return a(!0)}})})})});$e.displayName="Download";var tr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.wrapperInstanceRef,n=e.canvasIsRender,o=e.currentMenu,a=e.setCurrentMenu,l=(0,g.useRef)(!1);(0,g.useEffect)(function(){l.current=o===c.drag},[a,o]);var v=function(){var s=t.current;s&&(s.selection=!1,s.defaultCursor="grab",s.getObjects().forEach(function(m){m.selectable=!1}),s.requestRenderAll())},f=function(){var s=t.current;s&&(console.log("startDring"),a(c.drag),s.defaultCursor="grab",s.renderAll())},u=function(){var s=t.current;s&&(a(c.default),s.defaultCursor="default",s.isDragging=!1,s.selection=!1,s.renderAll())},h=function(){var s=t.current;s&&(s.on("mouse:down",function(m){var M=m.e;(M.altKey||l.current)&&(s.defaultCursor="grabbing",s.discardActiveObject(),v(),s.selection=!1,s.isDragging=!0,s.lastPosX=M.clientX,s.lastPosY=M.clientY,s.requestRenderAll())}),s.on("mouse:move",function(m){if(s.isDragging){s.discardActiveObject(),s.defaultCursor="grabbing";var M=m.e;if(!s.viewportTransform)return;var S=s.viewportTransform;S[4]+=M.clientX-s.lastPosX,S[5]+=M.clientY-s.lastPosY,s.lastPosX=M.clientX,s.lastPosY=M.clientY,s.requestRenderAll()}}),s.on("mouse:up",function(){!s.viewportTransform||!l.current||(s.setViewportTransform(this.viewportTransform),s.isDragging=!1,s.selection=!0,s.getObjects().forEach(function(m){m.id!==Pe&&m.hasControls&&(m.selectable=!0)}),s.defaultCursor="default",s.requestRenderAll())}))},p=function(s){var m=t.current;s.keyCode===32&&m&&!l.current&&f(),s.preventDefault()},x=function(s){var m=t.current;s.keyCode===32&&m&&u()};(0,g.useEffect)(function(){return t.current&&n&&(h(),r.current.tabIndex=1e3,r.current.addEventListener("keydown",p,!1),r.current.addEventListener("keyup",x,!1)),function(){var C=t.current;if(C&&r.current){var s,m;(s=r.current)===null||s===void 0||s.removeEventListener("keydown",p,!1),(m=r.current)===null||m===void 0||m.removeEventListener("keyup",x,!1)}}},[t,n]);var R=function(){a(o!==c.drag?c.drag:c.default)};return{handleMoving:R,currentMenu:o}},rr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=tr(),o=n.handleMoving,a=n.currentMenu;return(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-hand",w()({},"tie-image-editor_tool-item--checked",a===c.drag)),children:(0,i.jsx)(H,{content:V.drag[r],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:o})})})},nr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.currentMenu,a=(0,g.useRef)({color:Y.colors[0],size:Y.sizes[0]}),l=function(){var h=t.current;if(h){h.freeDrawingBrush=new P.fabric.PencilBrush(h);var p=h.freeDrawingBrush;p.color=a.current.color,p.getPatternSrc&&(p.source=p.getPatternSrc.call(p)),p.width=a.current.size,p.shadow=new P.fabric.Shadow({blur:a.current.size,offsetX:0,offsetY:0,affectStroke:!0,color:"#333"})}},v=function(){var h=t.current;h&&(r.current!==c.draw?(h.isDrawingMode=!0,l()):h.isDrawingMode=!1,n(r.current!==c.draw?c.draw:c.default))},f=function(h,p){if(t.current){var x=t.current,R=x.getActiveObjects()[0];h===oe.color?(a.current.color=p,R&&R.set("fill",p)):(a.current.size=p,R&&R.set("width",p)),x.renderAll(),l()}};return{handleDrawTrigger:v,handlePaintChange:f,currentMenu:o}},ar=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=nr(),o=n.handleDrawTrigger,a=n.handlePaintChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-draw",w()({},"tie-image-editor_tool-item--checked",l===c.draw)),children:(0,i.jsx)(ue,{open:l===c.draw,onChange:a,children:(0,i.jsx)(H,{content:V.draw[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})})})},ir=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.onChange,a=(0,g.useState)(!1),l=ae()(a,2),v=l[0],f=l[1],u=(0,g.useState)(!1),h=ae()(u,2),p=h[0],x=h[1],R=function(s,m){s===Ie.flipX?f(m):x(m),o&&o(s,m)};return(0,i.jsx)(H,{content:(0,i.jsxs)("div",{className:"tie-image-editor_tool-flip-pop",children:[(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-flipX",onClick:function(){return R(Ie.flipX,!v)},children:(0,i.jsx)("i",{className:"tie-image-editor_icon"})}),(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-flipY",onClick:function(){return R(Ie.flipY,!p)},children:(0,i.jsx)("i",{className:"tie-image-editor_icon"})})]}),placement:"bottom",open:n,children:(0,i.jsx)("div",{children:t})})},or=ir,sr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.canvasIsRender,a=e.currentMenu,l=e.historyRef;(0,g.useEffect)(function(){var u=t.current},[o]);var v=function(){n(r.current!==c.flip?c.flip:c.default)},f=function(h,p){var x=t.current;if(x){x.getObjects().forEach(function(s){s.originalPoint=s.originalPoint||{left:s.left,top:s.top};var m=w()({},h,p);h===Ie.flipX?p?m=W()(W()({},m),{},{left:x.width-s.originalPoint.left-s.width}):m=W()(W()({},m),{},{left:s.originalPoint.left}):p?m=W()(W()({},m),{},{top:x.height-s.originalPoint.top-s.height}):m=W()(W()({},m),{},{top:s.originalPoint.top}),s.set(m).rotate(parseFloat((s.angle*-1).toString())).setCoords()});var R=x.backgroundImage,C=R.angle;p&&(C*=-1),R.set(w()({},h,p)),R.rotate(parseFloat(C)).setCoords(),R.setCoords(),x.renderAll(),l.current.updateCanvasState(K.add)}};return{handleFlipTrigger:v,handleFlipChange:f,currentMenu:a}},cr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=sr(),o=n.handleFlipTrigger,a=n.handleFlipChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-flip",w()({},"tie-image-editor_tool-item--checked",l===c.flip)),children:(0,i.jsx)(or,{open:l===c.flip,onChange:a,children:(0,i.jsx)(H,{content:V.flip[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})})})},lr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.currentMenuRef,o=e.initCanvasJson,a=e.unSaveHistory,l=(0,g.useState)([]),v=ae()(l,2),f=v[0],u=v[1],h=(0,g.useState)(""),p=ae()(h,2),x=p[0],R=p[1],C=(0,g.useCallback)(function(T){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!(!t.current||a.current)){var X=t.current;try{var G=X.toJSON(Oe),y=JSON.stringify(G),j=Date.now()+"_"+Math.floor(Math.random()*1e4),k=f.findIndex(function(E){var D=E.id,B=D===void 0?"":D;return B===x}),O=f.slice(0,k+1-+N).concat(F||!N&&!F?[{id:j,data:y,type:T!==K.delete?n.current:c.default,action:T}]:[]);u(O.slice(Math.max(0,f.length-Ze))),R(j)}catch(E){console.error(E)}}},[f,x]),s=(0,g.useCallback)(function(T){T.target.id===Pe||T.action===void 0&&T.e||C(K.modified)},[C]),m=(0,g.useCallback)(function(T){T.action===void 0&&T.e||C(K.add)},[C]);(0,g.useEffect)(function(){var T=t.current;if(T)return T&&r&&(T.on("object:modified",s),T.on("object:added",m)),function(){T.off("object:modified",s),T.off("object:added",m)}},[t,r,s,m]);var M=(0,g.useCallback)(function(){var T,N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",F=t.current;if(F&&N!==x){var X=((T=f.find(function(G){var y=G.id;return y===N}))===null||T===void 0?void 0:T.data)||o.current;a.current=!0,F.loadFromJSON(X,function(){F.renderAll(),a.current=!1}),R(N)}},[x,f]),S=(0,g.useCallback)(function(){if(!(!t.current||!f.length)){var T="";if(x)f.forEach(function(F,X){var G=F.id;if(G===x){var y;T=(y=f[X+1])===null||y===void 0?void 0:y.id}});else{var N;T=(N=f[0])===null||N===void 0?void 0:N.id}M(T)}},[x,f]),A=(0,g.useCallback)(function(){if(!(!t.current||!f.length)){var T="";f.forEach(function(N,F){var X=N.id;if(X===x){var G;T=(G=f[F-1])===null||G===void 0?void 0:G.id}}),M(T)}},[x,f]);return{history:f,currentId:x,renderNewCanvas:M,handleRedo:S,handleUndo:A,updateCanvasState:C}},Ye=(0,g.forwardRef)(function(d,e){var t,r,n=(0,g.useContext)(I),o=n.lang,a=o===void 0?_.en:o,l=lr(),v=l.history,f=l.currentId,u=l.renderNewCanvas,h=l.handleRedo,p=l.handleUndo,x=l.updateCanvasState;return(0,g.useImperativeHandle)(e,function(){return{updateCanvasState:x}}),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-history",{"tie-image-editor_tool-item--disabled":!v.length}),children:(0,i.jsx)(H,{content:(0,i.jsxs)("div",{className:"tie-image-editor-history_pop",children:[!!v.length&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"tie-image-editor-history_pop-title",children:["\u5386\u53F2",(0,i.jsxs)("span",{className:"tie-image-editor-history_pop-len",children:["\uFF08",v.length,"\uFF09"]})]}),(0,i.jsxs)("div",{onClick:function(){return u("")},className:z()("tie-image-editor-history_pop-item",{"tie-image-editor-history_pop-item--checked":!f}),children:[(0,i.jsx)("span",{className:"tie-image-editor-history_pop-item-num",children:"1."}),"\u521D\u59CB\u5316",!f&&(0,i.jsx)("i",{className:"tie-image-editor-history_pop-item-icon"})]})]}),!v.length&&(0,i.jsx)("span",{children:"\u6682\u65E0\u5386\u53F2"}),v.map(function(R,C){var s=R.action,m=s===void 0?"":s,M=R.id,S=R.type;return(0,i.jsxs)("div",{onClick:function(){return u(M)},className:z()("tie-image-editor-history_pop-item",{"tie-image-editor-history_pop-item--checked":M===f}),children:[(0,i.jsxs)("span",{className:"tie-image-editor-history_pop-item-num",children:[C+2,"."]}),Ge[m],!!V[S]&&V[S][a],M===f&&(0,i.jsx)("i",{className:"tie-image-editor-history_pop-item-icon"})]},M)})]}),placement:"bottom",className:"tie-image-editor-history_target",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon")})})}),(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-redo",{"tie-image-editor_tool-item--disabled":!v.length||f===((t=v[v.length-1])===null||t===void 0?void 0:t.id)}),children:(0,i.jsx)(H,{content:V.redo[a],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:!v.length||f===((r=v[v.length-1])===null||r===void 0?void 0:r.id)?void 0:h})})}),(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-undo",{"tie-image-editor_tool-item--disabled":!v.length||!f}),children:(0,i.jsx)(H,{content:V.undo[a],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:!v.length||!f?void 0:p})})})]})});Ye.displayName="History";var ur=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.onChange,a=function(v){o&&o(v)};return(0,i.jsx)(H,{content:(0,i.jsx)("div",{className:"tie-image-editor_tool-crop-pop",children:(0,i.jsx)("div",{className:"tie-image-editor_tool-paint-size-wrapper",children:Y.mosaicSizes.map(function(l,v){return(0,i.jsx)("div",{onClick:function(){return a(l)},className:"tie-image-editor_tool-paint-size",style:{width:10+v*5,height:10+v*5}},l)})})}),placement:"bottom",open:n,children:(0,i.jsx)("div",{children:t})})},dr=ur,de=Y.mosaicSizes[0],fr=function(e){var t=e.data,r=e.height,n=e.width,o,a,l,v,f,u,h,p,x,R,C;for(a=0;a<r;a+=de)for(l=0;l<n;l+=de)for(o=a*4*n+l*4,v=t[o],f=t[o+1],u=t[o+2],h=t[o+3],R=Math.min(a+de,r),C=Math.min(l+de,n),p=a;p<R;p++)for(x=l;x<C;x++)o=p*4*n+x*4,t[o]=v,t[o+1]=f,t[o+2]=u,t[o+3]=h},vr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.currentMenu,o=e.currentMenuRef,a=e.setCurrentMenu,l=(0,g.useRef)(null),v=(0,g.useCallback)(function(){var h=t.current;h&&(l.current=new P.fabric.PatternBrush(h),l.current.getPatternSrc=function(){var p={left:0,top:0,width:h.width,height:h.height},x=h.toCanvasElement(1,p),R=x.getContext("2d"),C=R.getImageData(0,0,x.width,x.height);fr(C),R.putImageData(C,0,0);var s=P.fabric.document.createElement("canvas"),m=s.getContext("2d");return s.width=h.width||0,s.height=h.height||0,m.drawImage(x,0,0,x.width,x.height,p.left,p.top,p.width,p.height),s})},[]);(0,g.useEffect)(function(){r&&v()},[r]);var f=(0,g.useCallback)(function(){var h=t.current;if(h){if(o.current!==c.mosaic){h.isDrawingMode=!0,h.freeDrawingBrush=l.current;var p=h.freeDrawingBrush;p.getPatternSrc&&(p.source=p.getPatternSrc.call(p)),p.width=30,p.shadow=new P.fabric.Shadow({blur:0,offsetX:0,offsetY:0,affectStroke:!0})}else h.isDrawingMode=!1;a(o.current===c.mosaic?c.default:c.mosaic)}},[v]),u=function(p){var x=t.current;if(x){de=p;var R=x.freeDrawingBrush;R.getPatternSrc&&(R.source=R.getPatternSrc.call(R))}};return{currentMenu:n,handleMosaicTrigger:f,handleSizeChange:u}},hr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=vr(),o=n.currentMenu,a=n.handleMosaicTrigger,l=n.handleSizeChange;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-mosaic",w()({},"tie-image-editor_tool-item--checked",o===c.mosaic)),children:(0,i.jsx)(dr,{open:o===c.mosaic,onChange:l,children:(0,i.jsx)(H,{content:V.mosaic[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:a})})})})})},gr=hr,mr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.canvasIsRender,o=e.currentMenu,a=e.historyRef,l=e.setCurrentMenu,v=(0,g.useRef)(!1),f=(0,g.useRef)({x:9,y:0}),u=(0,g.useRef)(null),h=(0,g.useRef)({color:Y.colors[0],size:Y.sizes[0]}),p=function(){var s=t.current;s&&(s.on("mouse:down",function(m){if(s.getActiveObject()||r.current!==c.rect)return!1;v.current=!0;var M=s.getPointer(m.e);f.current.x=M.x,f.current.y=M.y,u.current=new P.fabric.Rect({left:f.current.x,top:f.current.y,originX:"left",originY:"top",width:M.x-f.current.x,height:M.y-f.current.y,angle:0,fill:"rgba(255,0,0,0)",stroke:h.current.color,strokeWidth:h.current.size,transparentCorners:!1}),s.add(u.current)}),s.on("mouse:move",function(m){if(!s.getActiveObject()&&r.current===c.rect&&s.setCursor(ce.crosshair),!v.current||!u.current||r.current!==c.rect){s.renderAll();return}var M=s.getPointer(m.e);f.current.x>M.x&&u.current.set({left:Math.abs(M.x)}),f.current.y>M.y&&u.current.set({top:Math.abs(M.y)}),u.current.set({width:Math.abs(f.current.x-M.x)}),u.current.set({height:Math.abs(f.current.y-M.y)}),s.setCursor(ce.crosshair),s.renderAll()}),s.on("mouse:up",function(m){if(!(!u.current||r.current!==c.rect)){var M=s.getPointer(m.e);M.x===u.current.left&&M.y===u.current.top?(s.remove(u.current),s.requestRenderAll(),a.current.updateCanvasState(K.add,!0,!1)):(s.setActiveObject(u.current),a.current.updateCanvasState(K.add,!0,!0)),v.current=!1,u.current=null}}))};(0,g.useEffect)(function(){t.current&&n&&p()},[t,n]);var x=function(){var s=r.current===c.rect?c.default:c.rect;console.log("currentMenuRef.current",s,r.current),l(s)},R=function(s,m){if(t.current){var M=t.current,S=M.getActiveObjects()[0];s===oe.color?(h.current.color=m,S&&S.set("stroke",m)):(h.current.size=m,S&&S.set("strokeWidth",m)),M.renderAll()}};return{handleDrawRect:x,handlePaintChange:R,currentMenu:o}},pr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=mr(),o=n.handleDrawRect,a=n.handlePaintChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-rect",w()({},"tie-image-editor_tool-item--checked",l===c.rect)),children:(0,i.jsx)(ue,{open:l===c.rect,onChange:a,children:(0,i.jsx)(H,{content:V.rect[r],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon"),onClick:o})})})})})},Cr=function(){var e=(0,g.useContext)(I),t=e.setCurrentMenu,r=e.currentMenuRef,n=e.canvasInstanceRef,o=e.historyRef,a=function(){r.current!==c.reset&&t(c.reset);var v=n.current;if(v){v.getObjects().forEach(function(h){h!==v.backgroundImage&&v.remove(h)});var f=v.getCenter();v.zoomToPoint(new P.fabric.Point(f.left,f.top),1);var u=v.viewportTransform;u[4]=0,u[5]=0,v.setViewportTransform(u),v.renderAll(),o.current.updateCanvasState(K.add)}};return{handleReset:a}},xr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=Cr(),o=n.handleReset;return(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-reset",children:(0,i.jsx)(H,{content:V.reset[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})},Rr=b(15560),Ur=b(39843),wr=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.onChange,a=(0,g.useState)(Y.rotates[0]),l=ae()(a,2),v=l[0],f=l[1],u=function(p){f(+p),o&&o(+p)};return(0,i.jsx)(H,{content:(0,i.jsx)("div",{className:"tie-image-editor_tool-rotate-pop-content",children:(0,i.jsx)(Rr.Z,{min:Y.rotates[0],max:Y.rotates[Y.rotates.length-1],onChange:u,value:v,marks:Y.rotates.reduce(function(h,p){return W()(W()({},h),{},w()({},p,p+"\xB0"))},{})})}),placement:"bottom-end",open:n,children:(0,i.jsx)("div",{children:t})})},Mr=wr,yr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.canvasIsRender,a=e.currentMenu,l=e.historyRef;(0,g.useEffect)(function(){var u=t.current},[o]);var v=function(){n(r.current!==c.rotate?c.rotate:c.default)},f=function(h){var p=t.current;if(p){p.getObjects().forEach(function(R){R.originalPoint=R.originalPoint||new P.fabric.Point(R.left,R.top);var C=P.fabric.util.rotatePoint(R.originalPoint,p.getVpCenter(),P.fabric.util.degreesToRadians(h));R.set({left:C.x,top:C.y,angle:h})});var x=p.backgroundImage;x.rotate(h),x.setCoords(),p.requestRenderAll(),l.current.updateCanvasState(K.add)}};return{handleRotateTrigger:v,handleRotateChange:f,currentMenu:a}},_r=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=yr(),o=n.handleRotateTrigger,a=n.handleRotateChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-rotate",w()({},"tie-image-editor_tool-item--checked",l===c.rotate)),children:(0,i.jsx)(Mr,{open:l===c.rotate,onChange:a,children:(0,i.jsx)(H,{content:V.rotate[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})})})},jr=function(e){var t=e.children,r=e.open,n=r===void 0?!1:r,o=e.zoom,a=o===void 0?1:o,l=e.onScaleUp,v=e.onScaleDown,f=e.onReset,u=e.onOpenChange;return(0,i.jsx)(H,{content:(0,i.jsxs)("div",{className:"tie-image-editor_tool-scale-pop-content",children:[(0,i.jsxs)("div",{className:"tie-image-editor_tool-scale-pop-zoom",children:[+(a*100).toFixed(0),"%"]}),(0,i.jsxs)("div",{className:"tie-image-editor_tool-scale-pop-icons",children:[(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-subtract",children:(0,i.jsx)("i",{className:"tie-image-editor_tool-scale-pop-icon tie-image-editor_icon",onClick:v})}),(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-add",children:(0,i.jsx)("i",{className:"tie-image-editor_tool-scale-pop-icon tie-image-editor_icon",onClick:l})})]}),(0,i.jsx)("button",{onClick:f,children:"\u91CD\u7F6E"})]}),placement:"bottom-end",open:n,showArrow:!1,trigger:"click",children:(0,i.jsx)("div",{children:t})})},Tr=jr,Sr=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasIsRender,n=e.currentMenu,o=e.currentMenuRef,a=e.zoom,l=e.setZoom,v=e.setCurrentMenu;(0,g.useEffect)(function(){var R=t.current;R&&r&&R.on("mouse:wheel",function(C){var s=C.e.deltaY,m=R.getZoom();m*=Math.pow(.999,s),m>20&&(m=20),m<.01&&(m=.01),l(m),R.requestRenderAll(),C.e.preventDefault(),C.e.stopPropagation()})},[t,r]),(0,g.useEffect)(function(){var R=t.current;if(R){var C=R.getCenter();R.zoomToPoint(new P.fabric.Point(C.left,C.top),a<0?.01:a),o.current!==c.scale&&v(c.scale)}},[a]);var f=function(){if(t.current){var C=t.current,s=C.getZoom();s+=.05,l(s)}},u=function(){if(t.current){var C=t.current,s=C.getZoom();s-=.05,l(s)}},h=function(){v(o.current===c.scale?c.default:c.scale)},p=function(){l(1)},x=(0,g.useCallback)(function(R){v(R?c.scale:c.default)},[]);return{zoom:a,handleScaleUp:f,handleScaleDown:u,handleScaleTrigger:h,handleReset:p,handleOpenChange:x}},kr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=e.currentMenu,o=Sr(),a=o.zoom,l=o.handleScaleDown,v=o.handleScaleUp,f=o.handleScaleTrigger,u=o.handleReset,h=o.handleOpenChange;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-zoomIn",w()({},"tie-image-editor_tool-item--checked",n===c.scale)),children:(0,i.jsx)(Tr,{open:n===c.scale,zoom:a,onScaleDown:l,onScaleUp:v,onReset:u,onOpenChange:h,children:(0,i.jsx)(H,{content:V.scale[r],placement:"top",children:(0,i.jsx)("i",{className:z()("tie-image-editor_icon")})})})})})},br=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.currentMenuRef,n=e.setCurrentMenu,o=e.canvasIsRender,a=e.currentMenu,l=(0,g.useRef)({color:Y.colors[0],size:Y.fontSizes[0]}),v=(0,g.useRef)(!1),f=(0,g.useCallback)(function(x){var R=t.current;if(!(!R||x.target)){if(v.current){v.current=!1;return}if(!(R.getActiveObject()||r.current!==c.text)){var C=R.getPointer(x.e),s=new P.fabric.IText("\u8F93\u5165\u5185\u5BB9",{left:C.x,top:C.y,fontSize:l.current.size,id:Math.random()*4+"_"+Date.now(),fill:l.current.color});R.add(s),R.setActiveObject(s),v.current=!0,R.renderAll()}}},[]),u=function(){var R=t.current;R&&R.on("mouse:up",f)};(0,g.useEffect)(function(){var x=t.current;if(!(!x||!o))return u(),function(){x.off("mouse:up",f)}},[o]);var h=function(){n(r.current!==c.text?c.text:c.default)},p=function(R,C){if(t.current){var s=t.current,m=s.getActiveObjects()[0];R===oe.color?(l.current.color=C,m&&m.set("fill",C)):(l.current.size=C,m&&m.set("fontSize",C)),s.renderAll()}};return{handleTextTrigger:h,handlePaintChange:p,currentMenu:a}},Er=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=br(),o=n.handleTextTrigger,a=n.handlePaintChange,l=n.currentMenu;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:z()("tie-image-editor_tool-item tie-image-editor_tool-text",w()({},"tie-image-editor_tool-item--checked",l===c.text)),children:(0,i.jsx)(ue,{open:l===c.text,onChange:a,type:c.text,children:(0,i.jsx)(H,{content:V.text[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",onClick:o})})})})})},Ir=function(){var e=(0,g.useContext)(I),t=e.canvasInstanceRef,r=e.canvasEl,n=e.currentMenuRef,o=e.historyRef,a=e.setCurrentMenu,l=e.initBackGroundImage,v=function(u){var h,p=t.current;if(!(!p||!r.current||!u.target.files.length||!((h=u.target.files[0])!==null&&h!==void 0&&(h=h.type)!==null&&h!==void 0&&h.includes("image")))){n.current!==c.upload&&a(c.upload);var x=new FileReader;x.onload=function(R){if(!(!R||!R.target)){var C=new Image;C.src=R.target.result,l(R.target.result,!0,function(){o.current.updateCanvasState(K.add)})}},x.readAsDataURL(u.target.files[0])}};return{handleUpload:v}},Pr=function(){var e=(0,g.useContext)(I),t=e.lang,r=t===void 0?_.en:t,n=Ir(),o=n.handleUpload;return(0,i.jsx)("div",{className:"tie-image-editor_tool-item tie-image-editor_tool-upload",children:(0,i.jsx)(H,{content:V.upload[r],placement:"top",children:(0,i.jsx)("i",{className:"tie-image-editor_icon",children:(0,i.jsx)("input",{onChange:o,type:"file",className:"tie-image-editor_tool-upload-input",accept:"image/*"})})})})},Dr=function(e){var t=e.url,r=(0,g.useRef)(null),n=(0,g.useRef)(),o=(0,g.useRef)(),a=(0,g.useRef)(null),l=(0,g.useState)(!1),v=ae()(l,2),f=v[0],u=v[1],h=(0,g.useState)(c.default),p=ae()(h,2),x=p[0],R=p[1],C=(0,g.useRef)(c.default),s=(0,g.useRef)("{}"),m=(0,g.useRef)(!1),M=(0,g.useRef)({updateCanvasState:function(){}}),S=(0,g.useRef)({downLoad:function(){return Promise.resolve({})}}),A=(0,g.useState)(1),T=ae()(A,2),N=T[0],F=T[1],X=function(k){console.log("setCurrentMenu",k),R(k),C.current=k;var O=o.current;O&&([c.draw,c.mosaic].includes(k)||(O.isDrawingMode=!1),[c.rect,c.circle,c.arrow].includes(k)?O.setCursor(ce.crosshair):[c.rect,c.circle,c.arrow].includes(C.current)&&O.setCursor(ce.default),O.renderAll())},G=function(){if(a.current&&r.current)try{var k=a.current.getBoundingClientRect(),O=k.width,E=k.height,D=new P.fabric.Canvas(r.current,{containerClass:"tie-image-editor_canvas",width:O,height:E});o.current=D,u(!0);try{s.current=JSON.stringify(D.toJSON(Oe))}catch(B){console.error("initCanvasJson \u521D\u59CB\u5316\u5931\u8D25")}}catch(B){console.error(B)}},y=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,E=arguments.length>2?arguments[2]:void 0,D=o.current;if(k.trim()&&D&&a.current){var B=a.current.getBoundingClientRect(),Z=B.height;n.current=P.fabric.Image.fromURL(k,function(U){var re=D.getCenter(),q=U.height;if(U.scale(Z/q),U.set({left:re.left-U.width*(Z/q)/2,top:re.top-U.height*(Z/q)/2}),U.selectable=!1,U.id=Pe,D.setBackgroundImage(U,D.renderAll.bind(D)),O){E&&E();return}try{s.current=JSON.stringify(D.toJSON(Oe))}catch($){console.error("initCanvasJson \u521D\u59CB\u5316\u5931\u8D25")}E&&E()},{crossOrigin:"anonymous"})}};return(0,g.useEffect)(function(){G()},[r,a]),(0,g.useEffect)(function(){y(t)},[t,o,a]),{canvasEl:r,imageInstanceRef:n,canvasInstanceRef:o,wrapperInstanceRef:a,currentMenu:x,setCurrentMenu:X,currentMenuRef:C,canvasIsRender:f,initCanvasJson:s,unSaveHistory:m,historyRef:M,initBackGroundImage:y,downloadRef:S,zoom:N,setZoom:F}},Xe=(0,g.forwardRef)(function(d,e){var t=d.url,r=t===void 0?Qe:t,n=d.style,o=d.menus,a=o===void 0?qe:o,l=d.onDownLoad,v=d.lang,f=v===void 0?_.en:v,u=Dr({url:r}),h=u.canvasEl,p=u.canvasInstanceRef,x=u.wrapperInstanceRef,R=u.currentMenu,C=u.setCurrentMenu,s=u.currentMenuRef,m=u.canvasIsRender,M=u.initCanvasJson,S=u.unSaveHistory,A=u.historyRef,T=u.initBackGroundImage,N=u.downloadRef,F=u.zoom,X=u.setZoom;return(0,g.useImperativeHandle)(e,function(){return{downloadRef:N}},[]),(0,i.jsx)(I.Provider,{value:{canvasInstanceRef:p,wrapperInstanceRef:x,currentMenuRef:s,currentMenu:R,setCurrentMenu:C,canvasIsRender:m,canvasEl:h,url:r,onDownLoad:l,initCanvasJson:M,unSaveHistory:S,historyRef:A,initBackGroundImage:T,zoom:F,setZoom:X,lang:f},children:(0,i.jsxs)("div",{className:"tie-image-editor",style:n,children:[(0,i.jsx)(zt,{}),(0,i.jsxs)("div",{className:"tie-image-editor_tool clearfix",children:[(!a.length||a.includes(c.rect))&&(0,i.jsx)(pr,{}),(!a.length||a.includes(c.circle))&&(0,i.jsx)(Dt,{}),(!a.length||a.includes(c.arrow))&&(0,i.jsx)(It,{}),(!a.length||a.includes(c.draw))&&(0,i.jsx)(ar,{}),(!a.length||a.includes(c.text))&&(0,i.jsx)(Er,{}),(!a.length||a.includes(c.mosaic))&&(0,i.jsx)(gr,{}),(!a.length||a.includes(c.crop))&&(0,i.jsx)(qt,{}),(!a.length||a.includes(c.download))&&(0,i.jsx)($e,{ref:N}),(!a.length||a.includes(c.upload))&&(0,i.jsx)(Pr,{}),(!a.length||a.includes(c.drag))&&(0,i.jsx)(rr,{}),(!a.length||a.includes(c.reset))&&(0,i.jsx)(xr,{}),(!a.length||a.includes(c.rotate))&&(0,i.jsx)(_r,{}),(!a.length||a.includes(c.flip))&&(0,i.jsx)(cr,{}),(!a.length||a.includes(c.scale))&&(0,i.jsx)(kr,{}),(!a.length||a.includes(c.history))&&(0,i.jsx)(Ye,{ref:A})]}),(0,i.jsx)("div",{ref:x,className:"tie-image-editor_modal__wrapper",children:(0,i.jsx)("canvas",{ref:h})})]})})});Xe.displayName="Editor";var Nr=b.p+"static/basic.1cfbd9e1.jpg",Or=function(){return(0,i.jsx)("div",{children:(0,i.jsx)(Xe,{url:Nr})})},zr=Or},24960:function(){},26759:function(){},56272:function(){}}]);
